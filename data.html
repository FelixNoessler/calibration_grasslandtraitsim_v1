<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data of the Biodiversity Exploratories – Calibration of GrasslandTraitSim.jl v1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2486e1f0a3ee9ee1fc393803a1361cdb.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-29dedaace5d8918e049944c60b75f171.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./data.html">Data of the Biodiversity Exploratories</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Calibration of <code>GrasslandTraitSim.jl</code> v1</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Data of the Biodiversity Exploratories</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calibration_details.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Technical details on the calibration</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Parameter</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parameter_fixed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fixed parameter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parameter_optimized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Optimized parameter</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Calibration results</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calibration_results_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calibration_results_sites.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sites</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calibration_results_patterns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Patterns</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calibration_results_scenario.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scenario analysis</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#where-to-get-the-data" id="toc-where-to-get-the-data" class="nav-link active" data-scroll-target="#where-to-get-the-data"><span class="header-section-number">1</span> Where to get the data</a></li>
  <li><a href="#input-data" id="toc-input-data" class="nav-link" data-scroll-target="#input-data"><span class="header-section-number">2</span> Input data</a>
  <ul class="collapse">
  <li><a href="#traits-of-species" id="toc-traits-of-species" class="nav-link" data-scroll-target="#traits-of-species"><span class="header-section-number">2.1</span> Traits of species</a></li>
  <li><a href="#daily-abiotic-conditions" id="toc-daily-abiotic-conditions" class="nav-link" data-scroll-target="#daily-abiotic-conditions"><span class="header-section-number">2.2</span> Daily abiotic conditions</a></li>
  <li><a href="#daily-management-variables" id="toc-daily-management-variables" class="nav-link" data-scroll-target="#daily-management-variables"><span class="header-section-number">2.3</span> Daily management variables</a></li>
  <li><a href="#raw-time-invariant-site-variables" id="toc-raw-time-invariant-site-variables" class="nav-link" data-scroll-target="#raw-time-invariant-site-variables"><span class="header-section-number">2.4</span> Raw time invariant site variables</a></li>
  <li><a href="#water-holding-capacity-and-permanent-wilting-point" id="toc-water-holding-capacity-and-permanent-wilting-point" class="nav-link" data-scroll-target="#water-holding-capacity-and-permanent-wilting-point"><span class="header-section-number">2.5</span> Water holding capacity and permanent wilting point</a></li>
  </ul></li>
  <li><a href="#calibration-data" id="toc-calibration-data" class="nav-link" data-scroll-target="#calibration-data"><span class="header-section-number">3</span> Calibration data</a>
  <ul class="collapse">
  <li><a href="#biomass-and-vegetation-height" id="toc-biomass-and-vegetation-height" class="nav-link" data-scroll-target="#biomass-and-vegetation-height"><span class="header-section-number">3.1</span> Biomass and vegetation height</a></li>
  <li><a href="#community-weighted-mean-traits" id="toc-community-weighted-mean-traits" class="nav-link" data-scroll-target="#community-weighted-mean-traits"><span class="header-section-number">3.2</span> Community weighted mean traits</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data of the Biodiversity Exploratories</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="where-to-get-the-data" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="where-to-get-the-data"><span class="header-section-number">1</span> Where to get the data</h2>
<p>The data from the Biodiversity Exploraties can be downloaded from the <a href="https://www.bexis.uni-jena.de/ddm/publicsearch/index">BExIS data base</a>. Also the metadata for all datasets is available there.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Script for downloading all data sets from BExIS">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Script for downloading all data sets from BExIS
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The following R-script downloads all data sets from the Biodiversity Exploratories data base:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>download_bexis.R</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="download_bexis.R"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install with:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("BEXIS2/rBExIS", subdir = "rBExIS")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rBExIS) </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>download_bexis_dataset <span class="ot">&lt;-</span> <span class="cf">function</span>(id, name, output_dir){</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(<span class="st">"data/"</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    api_url <span class="ot">&lt;-</span> rBExIS<span class="sc">:::</span><span class="fu">get_api_url</span>(<span class="st">"/data/"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    table_data <span class="ot">&lt;-</span> <span class="fu">content</span>(rBExIS<span class="sc">:::</span><span class="fu">get_response</span>(<span class="st">"GET"</span>, <span class="fu">paste0</span>(api_url, id)))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(table_data, <span class="fu">paste0</span>(output_dir, name, <span class="st">".csv"</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">bexis.options</span>(<span class="st">"base_url"</span> <span class="ot">=</span> <span class="st">"https://www.bexis.uni-jena.de/"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">=</span> <span class="st">"data/"</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="do">## approximate (public) coordinates </span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">1000</span>, <span class="at">name =</span> <span class="st">"approx_site_coordinates"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="do">## management input for grazing and mowing</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">31715</span>, <span class="at">name =</span> <span class="st">"management_input"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">25086</span>, <span class="at">name =</span> <span class="st">"LUI_tool_input"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="do">## cut biomass (botany core)</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">16209</span>, <span class="at">name =</span> <span class="st">"biomass_2009"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">12706</span>, <span class="at">name =</span> <span class="st">"biomass_2010"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">14346</span>, <span class="at">name =</span> <span class="st">"biomass_2011"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="do">## cut biomass (sade)</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">19812</span>, <span class="at">name =</span> <span class="st">"biomass_2015_sade"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">23506</span>, <span class="at">name =</span> <span class="st">"biomass_2017_sade"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="do">## cut biomass (hedge II)</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">31138</span>, <span class="at">name =</span> <span class="st">"biomass_2017_hainich_hedgeII"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">31139</span>, <span class="at">name =</span> <span class="st">"biomass_2018_alb_hedgeII"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="do">## vegetation</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">31389</span>, <span class="at">name =</span> <span class="st">"vegetation_2008_2022"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="do">## vegetation header data</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">6340</span>, <span class="at">name =</span> <span class="st">"vegetation_header_data_2009"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">13486</span>, <span class="at">name =</span> <span class="st">"vegetation_header_data_2010"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">14326</span>, <span class="at">name =</span> <span class="st">"vegetation_header_data_2011"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">15588</span>, <span class="at">name =</span> <span class="st">"vegetation_header_data_2012"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">16826</span>, <span class="at">name =</span> <span class="st">"vegetation_header_data_2013"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">19807</span>, <span class="at">name =</span> <span class="st">"vegetation_header_data_2014"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">19809</span>, <span class="at">name =</span> <span class="st">"vegetation_header_data_2015"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">21187</span>, <span class="at">name =</span> <span class="st">"vegetation_header_data_2016"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">31466</span>, <span class="at">name =</span> <span class="st">"vegetation_header_data_2017"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">24166</span>, <span class="at">name =</span> <span class="st">"vegetation_header_data_2018"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">26151</span>, <span class="at">name =</span> <span class="st">"vegetation_header_data_2019"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">27426</span>, <span class="at">name =</span> <span class="st">"vegetation_header_data_2020"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">31180</span>, <span class="at">name =</span> <span class="st">"vegetation_header_data_2021"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">31387</span>, <span class="at">name =</span> <span class="st">"vegetation_header_data_2022"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="do">## leaf traits</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">24807</span>, <span class="at">name =</span> <span class="st">"leaf_traits"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="do">## root traits</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">26546</span>, <span class="at">name =</span> <span class="st">"root_traits"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="do">## soil nutrients</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">14446</span>, <span class="at">name =</span> <span class="st">"soilnutrients_2011"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">18787</span>, <span class="at">name =</span> <span class="st">"soilnutrients_2014"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">23846</span>, <span class="at">name =</span> <span class="st">"soilnutrients_2017"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">31210</span>, <span class="at">name =</span> <span class="st">"soilnutrients_2021"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="do">## soil texture</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">14686</span>, <span class="at">name =</span> <span class="st">"soiltexture_2011"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="do">## soil organic matter content</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">14446</span>, <span class="at">name =</span> <span class="st">"soilorganicmatter_2011"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="do">## soil bulk density</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">17086</span>, <span class="at">name =</span> <span class="st">"soilbulkdensity_2011"</span>, <span class="at">output_dir =</span> data_dir)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="do">## rooting depth</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="fu">download_bexis_dataset</span>(<span class="at">id =</span> <span class="dv">4761</span>, <span class="at">name =</span> <span class="st">"rootingdepth_2008"</span>, <span class="at">output_dir =</span> data_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Script for downloading PET data from DWD">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Script for downloading PET data from DWD
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The following script downloads files for the potential evapotranspiration from the DWD:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>download_pet.jl</strong></pre>
</div>
<div class="sourceCode" id="cb2" data-filename="download_pet.jl"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> <span class="st">"../data/"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># https://opendata.dwd.de/climate_environment/CDC/derived_germany/soil/daily/historical/</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 164 - Angermünde = SCH</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 3402 - Münsingen-Apfelstetten = ALB</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 6305 - Mühlhausen = HAI</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>ids <span class="op">=</span> [</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"164"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"3402"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"6305"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> id <span class="kw">in</span> ids</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> url <span class="op">=</span> <span class="st">"https://opendata.dwd.de/climate_environment/CDC/derived_germany/soil/daily/historical/derived_germany_soil_daily_historical_</span><span class="sc">$</span>(id)<span class="st">.txt.gz"</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> <span class="st">"pet_</span><span class="sc">$</span>(id)<span class="st">.txt.gz"</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download</span>(url, <span class="fu">joinpath</span>(data_dir, filename))</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Processing PAR data from Google Earth Engine">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Processing PAR data from Google Earth Engine
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The photosynthetic active radiation was processed with the following script on Google Earth Engine:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>par_extract.js</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-filename="par_extract.js"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">bufferPoints</span>(radius<span class="op">,</span> bounds) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">function</span>(pt) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        pt <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(pt)<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> bounds <span class="op">?</span> pt<span class="op">.</span><span class="fu">buffer</span>(radius)<span class="op">.</span><span class="fu">bounds</span>() <span class="op">:</span> pt<span class="op">.</span><span class="fu">buffer</span>(radius)<span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">zonalStats</span>(ic<span class="op">,</span> fc<span class="op">,</span> params) {</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize internal params dictionary.</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> _params <span class="op">=</span> {</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">scale</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">crs</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bands</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bandsRename</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">imgProps</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">imgPropsRename</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">datetimeName</span><span class="op">:</span> <span class="st">'datetime'</span><span class="op">,</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">datetimeFormat</span><span class="op">:</span> <span class="st">'YYYY-MM-dd HH:mm:ss'</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Replace initialized params with provided params.</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (params) {</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">var</span> param <span class="kw">in</span> params) {</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    _params[param] <span class="op">=</span> params[param] <span class="op">||</span> _params[param]<span class="op">;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Set default parameters based on an image representative.</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imgRep <span class="op">=</span> ic<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> nonSystemImgProps <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(<span class="kw">null</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">copyProperties</span>(imgRep)<span class="op">.</span><span class="fu">propertyNames</span>()<span class="op">;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>_params<span class="op">.</span><span class="at">bands</span>) _params<span class="op">.</span><span class="at">bands</span> <span class="op">=</span> imgRep<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>_params<span class="op">.</span><span class="at">bandsRename</span>) _params<span class="op">.</span><span class="at">bandsRename</span> <span class="op">=</span> _params<span class="op">.</span><span class="at">bands</span><span class="op">;</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>_params<span class="op">.</span><span class="at">imgProps</span>) _params<span class="op">.</span><span class="at">imgProps</span> <span class="op">=</span> nonSystemImgProps<span class="op">;</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>_params<span class="op">.</span><span class="at">imgPropsRename</span>) _params<span class="op">.</span><span class="at">imgPropsRename</span> <span class="op">=</span> _params<span class="op">.</span><span class="at">imgProps</span><span class="op">;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="co">// Map the reduceRegions function over the image collection.</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> results <span class="op">=</span> ic<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(img) {</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Select bands (optionally rename), set a datetime &amp; timestamp property.</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(img<span class="op">.</span><span class="fu">select</span>(_params<span class="op">.</span><span class="at">bands</span><span class="op">,</span> _params<span class="op">.</span><span class="at">bandsRename</span>))</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">set</span>(_params<span class="op">.</span><span class="at">datetimeName</span><span class="op">,</span> img<span class="op">.</span><span class="fu">date</span>()<span class="op">.</span><span class="fu">format</span>(_params<span class="op">.</span><span class="at">datetimeFormat</span>))</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">set</span>(<span class="st">'timestamp'</span><span class="op">,</span> img<span class="op">.</span><span class="fu">get</span>(<span class="st">'system:time_start'</span>))<span class="op">;</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Define final image property dictionary to set in output features.</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> propsFrom <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>(_params<span class="op">.</span><span class="at">imgProps</span>)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">cat</span>(ee<span class="op">.</span><span class="fu">List</span>([_params<span class="op">.</span><span class="at">datetimeName</span><span class="op">,</span> <span class="st">'timestamp'</span>]))<span class="op">;</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> propsTo <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>(_params<span class="op">.</span><span class="at">imgPropsRename</span>)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">cat</span>(ee<span class="op">.</span><span class="fu">List</span>([_params<span class="op">.</span><span class="at">datetimeName</span><span class="op">,</span> <span class="st">'timestamp'</span>]))<span class="op">;</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> imgProps <span class="op">=</span> img<span class="op">.</span><span class="fu">toDictionary</span>(propsFrom)<span class="op">.</span><span class="fu">rename</span>(propsFrom<span class="op">,</span> propsTo)<span class="op">;</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Subset points that intersect the given image.</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> fcSub <span class="op">=</span> fc<span class="op">.</span><span class="fu">filterBounds</span>(img<span class="op">.</span><span class="fu">geometry</span>())<span class="op">;</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Reduce the image by regions.</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> img<span class="op">.</span><span class="fu">reduceRegions</span>({</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    <span class="dt">collection</span><span class="op">:</span> fcSub<span class="op">,</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> _params<span class="op">.</span><span class="at">reducer</span><span class="op">,</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> _params<span class="op">.</span><span class="at">scale</span><span class="op">,</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    <span class="dt">crs</span><span class="op">:</span> _params<span class="op">.</span><span class="at">crs</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add metadata to each feature.</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(f) {</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> f<span class="op">.</span><span class="fu">set</span>(imgProps)<span class="op">;</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">flatten</span>()<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">notNull</span>(_params<span class="op">.</span><span class="at">bandsRename</span>))<span class="op">;</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> results<span class="op">;</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="co">// -----------------------------------</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> start_year <span class="op">=</span> <span class="dv">2006</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> end_year <span class="op">=</span> <span class="dv">2022</span> </span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MODIS_PAR <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'MODIS/061/MCD18C2'</span>)</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>                    ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>                    start_year <span class="op">+</span> <span class="st">'-01-01'</span><span class="op">,</span> </span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>                    end_year <span class="op">+</span> <span class="st">'-12-31'</span>))<span class="op">;</span>            </span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="co">// -----------------------------------</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> pts <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>([</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    ee<span class="op">.</span><span class="fu">Feature</span>(ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="fl">13.75</span><span class="op">,</span> <span class="fl">52.96</span>])<span class="op">,</span> {<span class="dt">plot_id</span><span class="op">:</span> <span class="st">'SCH'</span>})<span class="op">,</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>    ee<span class="op">.</span><span class="fu">Feature</span>(ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="fl">10.37</span><span class="op">,</span> <span class="fl">51.25</span>])<span class="op">,</span> {<span class="dt">plot_id</span><span class="op">:</span> <span class="st">'HAI'</span>})<span class="op">,</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    ee<span class="op">.</span><span class="fu">Feature</span>(ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="fl">9.41</span><span class="op">,</span> <span class="fl">48.43</span>])<span class="op">,</span> {<span class="dt">plot_id</span><span class="op">:</span> <span class="st">'ALB'</span>})</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ptsExplo <span class="op">=</span> pts<span class="op">.</span><span class="fu">map</span>(<span class="fu">bufferPoints</span>(<span class="dv">10000</span><span class="op">,</span> <span class="kw">false</span>))<span class="op">;</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="co">// -----------------------------------</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> params <span class="op">=</span> {</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">median</span>()<span class="op">,</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>    <span class="dt">crs</span><span class="op">:</span> <span class="st">'EPSG:5243'</span><span class="op">,</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bands</span><span class="op">:</span> [<span class="st">'GMT_0000_PAR'</span><span class="op">,</span> <span class="st">'GMT_0300_PAR'</span><span class="op">,</span> <span class="st">'GMT_0600_PAR'</span><span class="op">,</span> <span class="st">'GMT_0900_PAR'</span><span class="op">,</span> <span class="st">'GMT_1200_PAR'</span><span class="op">,</span> <span class="st">'GMT_1500_PAR'</span><span class="op">,</span> <span class="st">'GMT_1800_PAR'</span><span class="op">,</span> <span class="st">'GMT_2100_PAR'</span>]<span class="op">,</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bandsRename</span><span class="op">:</span> [<span class="st">'PAR_00'</span><span class="op">,</span> <span class="st">'PAR_03'</span><span class="op">,</span> <span class="st">'PAR_06'</span><span class="op">,</span> <span class="st">'PAR_09'</span><span class="op">,</span> <span class="st">'PAR_12'</span><span class="op">,</span> <span class="st">'PAR_15'</span><span class="op">,</span> <span class="st">'PAR_18'</span><span class="op">,</span> <span class="st">'PAR_21'</span>]<span class="op">,</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    <span class="dt">datetimeName</span><span class="op">:</span> <span class="st">'date'</span><span class="op">,</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>    <span class="dt">datetimeFormat</span><span class="op">:</span> <span class="st">'YYYY-MM-dd'</span></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ptsModisStats <span class="op">=</span> <span class="fu">zonalStats</span>(MODIS_PAR<span class="op">,</span> ptsExplo<span class="op">,</span> params)<span class="op">;</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a><span class="co">// -----------------------------------</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> removeGeometry <span class="op">=</span> <span class="kw">function</span>(feature) {</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> feature<span class="op">.</span><span class="fu">setGeometry</span>(<span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> final_output <span class="op">=</span> ptsModisStats<span class="op">.</span><span class="fu">map</span>(removeGeometry)<span class="op">;</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a><span class="co">// -----------------------------------</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">table</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>    <span class="dt">collection</span><span class="op">:</span> final_output<span class="op">,</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>    <span class="dt">folder</span><span class="op">:</span> <span class="st">'GEE'</span><span class="op">,</span> </span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>    <span class="dt">description</span><span class="op">:</span> <span class="st">'PAR_'</span> <span class="op">+</span> start_year <span class="op">+</span> <span class="st">'_'</span> <span class="op">+</span> end_year<span class="op">,</span></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fileFormat</span><span class="op">:</span> <span class="st">'CSV'</span></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Script for downloading temperature and precipitation data from DWD">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Script for downloading temperature and precipitation data from DWD
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The following script downloads files for the potential evapotranspiration from the DWD:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>download_temperature_precipitation_dwd.jl</strong></pre>
</div>
<div class="sourceCode" id="cb4" data-filename="download_temperature_precipitation_dwd.jl"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> <span class="st">"../data/"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>base_url <span class="op">=</span> <span class="st">"https://opendata.dwd.de/climate_environment/CDC/observations_germany/climate/daily/kl/historical/"</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> [</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tageswerte_KL_00164_19080517_20231231_hist.zip"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tageswerte_KL_03402_19460101_20231231_hist.zip"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tageswerte_KL_06305_20041201_20231231_hist.zip"</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>txt_names <span class="op">=</span> [</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"produkt_klima_tag_19080517_20231231_00164.txt"</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"produkt_klima_tag_19460101_20231231_03402.txt"</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"produkt_klima_tag_20041201_20231231_06305.txt"</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>ids <span class="op">=</span> [<span class="fl">164</span>, <span class="fl">3402</span>, <span class="fl">6305</span>]</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(files)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> my_url <span class="op">=</span> base_url <span class="op">*</span> files[i]</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download</span>(my_url, <span class="st">"data.zip"</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> my_file <span class="op">=</span> txt_names[i]</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">run</span>(<span class="fu">pipeline</span>(<span class="ss">`unzip -p data.zip $my_file`</span>, <span class="cn">stdout</span> <span class="op">=</span> <span class="st">"</span><span class="sc">$</span>(data_dir)<span class="st">/temperature_precipitation_</span><span class="sc">$</span>(ids[i])<span class="st">.csv"</span>))</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="st">"data.zip"</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="How to download temperature and precipitation data from BExIS">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How to download temperature and precipitation data from BExIS
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The data can be manually downloaded from the BExIS data base with the <a href="https://www.bexis.uni-jena.de/TCD/PublicClimateData/export">climate tool</a>, see <span class="citation" data-cites="explo19007v6">Wöllauer et al. (<a href="#ref-explo19007v6" role="doc-biblioref">2023</a>)</span>.</p>
<p>The following yaml file shows which options were used for downloading:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>temperature_precipitation_processing_settings.yaml</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename="temperature_precipitation_processing_settings.yaml"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">creation date</span><span class="kw">:</span><span class="at"> </span><span class="st">'2023-08-28T10:00:34.207273'</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tubedb version</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.23.1</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">region</span><span class="kw">:</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">id</span><span class="kw">:</span><span class="at"> BE</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Exploratories</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">groups</span><span class="kw">:</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> AEG</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Schwäbische Alb Grünland</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> HEG</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Hainich-Dün Grünland</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> SEG</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Schorfheide Grünland</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plots</span><span class="kw">:</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG01</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG02</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG03</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG04</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG05</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG06</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG07</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG08</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG09</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG10</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG11</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG12</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG13</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG14</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG15</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG16</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG17</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG18</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG19</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG20</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG21</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG22</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG23</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG24</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG25</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG26</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG27</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG28</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG29</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG30</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG31</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG32</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG33</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG34</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG35</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG36</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG37</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG38</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG39</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG40</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG41</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG42</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG43</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG44</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG45</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG46</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG47</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG48</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG49</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> AEG50</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG01</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG02</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG03</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG04</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG05</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG06</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG07</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG08</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG09</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG10</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG11</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG12</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG13</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG14</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG15</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG16</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG17</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG18</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG19</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG20</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG21</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG22</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG23</span></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG24</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG25</span></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG26</span></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG27</span></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG28</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG29</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG30</span></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG31</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG32</span></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG33</span></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG34</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG35</span></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG36</span></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG37</span></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG38</span></span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG39</span></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG40</span></span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG41</span></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG42</span></span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG43</span></span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG44</span></span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG45</span></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG46</span></span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG47</span></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG48</span></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG49</span></span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> HEG50</span></span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG01</span></span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG02</span></span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG03</span></span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG04</span></span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG05</span></span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG06</span></span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG07</span></span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG08</span></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG09</span></span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG10</span></span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG11</span></span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG12</span></span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG13</span></span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG14</span></span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG15</span></span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG16</span></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG17</span></span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG18</span></span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG19</span></span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG20</span></span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG21</span></span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG22</span></span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG23</span></span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG24</span></span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG25</span></span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG26</span></span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG27</span></span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG28</span></span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG29</span></span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG30</span></span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG31</span></span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG32</span></span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG33</span></span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG34</span></span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG35</span></span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG36</span></span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG37</span></span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG38</span></span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG39</span></span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG40</span></span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG41</span></span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG42</span></span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG43</span></span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG44</span></span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG45</span></span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG46</span></span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG47</span></span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG48</span></span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG49</span></span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> SEG50</span></span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a><span class="fu">sensors</span><span class="kw">:</span></span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> P_RT_NRT</span></span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> precipitation_radolan</span></span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> Ta_200</span></span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a><span class="fu">time interval</span><span class="kw">:</span></span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">start</span><span class="kw">:</span><span class="at"> </span><span class="st">'*'</span></span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">end</span><span class="kw">:</span><span class="at"> </span><span class="st">'*'</span></span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregation</span><span class="kw">:</span><span class="at"> day</span></span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a><span class="fu">quality check</span><span class="kw">:</span><span class="at"> empirical</span></span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a><span class="fu">interpolation</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a><span class="fu">data columns</span><span class="kw">:</span></span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> plotID</span></span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> datetime</span></span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> qualitycounter</span></span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a><span class="fu">data header</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a><span class="fu">all plots in one file</span><span class="kw">:</span><span class="at"> plots.csv</span></span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a><span class="fu">additional files</span><span class="kw">:</span></span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> sensor_description.csv</span></span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> plot_description.csv</span></span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> processing_settings.yaml</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Data sources for the species traits">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data sources for the species traits
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Parts of the traits data were download from BExIS from traits that were measured from plants in the field (specific leaf area, <span class="citation" data-cites="explo24807v2">Prati, Goßner, and Neff (<a href="#ref-explo24807v2" role="doc-biblioref">2021</a>)</span>) or in lab conditions (belowground traits, aboveground biomass per total biomass, <span class="citation" data-cites="explo26546v2">Bergmann and Rillig (<a href="#ref-explo26546v2" role="doc-biblioref">2022</a>)</span>). The potential plant height was taken from the LEDA trait database (<span class="citation" data-cites="LEDA">Kleyer et al. (<a href="#ref-LEDA" role="doc-biblioref">2008</a>)</span>). The leaf nitrogen content was downloaded from the TRY database (<span class="citation" data-cites="trydb">Kattge et al. (<a href="#ref-trydb" role="doc-biblioref">2020</a>)</span>).</p>
</div>
</div>
</div>
</section>
<section id="input-data" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="input-data"><span class="header-section-number">2</span> Input data</h2>
<section id="traits-of-species" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="traits-of-species"><span class="header-section-number">2.1</span> Traits of species</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 60%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Description</th>
<th>Data source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Specific leaf area [m² g⁻¹]</td>
<td><span class="citation" data-cites="explo24807v2">Prati, Goßner, and Neff (<a href="#ref-explo24807v2" role="doc-biblioref">2021</a>)</span></td>
</tr>
<tr class="even">
<td>Arbuscular mycorrhizal colonisation [-]</td>
<td><span class="citation" data-cites="explo26546v2">Bergmann and Rillig (<a href="#ref-explo26546v2" role="doc-biblioref">2022</a>)</span></td>
</tr>
<tr class="odd">
<td>Root surface area / aboveground biomass [m² g⁻¹]</td>
<td><span class="citation" data-cites="explo26546v2">Bergmann and Rillig (<a href="#ref-explo26546v2" role="doc-biblioref">2022</a>)</span></td>
</tr>
<tr class="even">
<td>Above ground biomass per total biomass (abp) [-]</td>
<td><span class="citation" data-cites="explo26546v2">Bergmann and Rillig (<a href="#ref-explo26546v2" role="doc-biblioref">2022</a>)</span></td>
</tr>
<tr class="odd">
<td>The leaf biomass per aboveground biomass [-]</td>
<td>set to 0.8 of abp</td>
</tr>
<tr class="even">
<td>Potential plant height [m]</td>
<td><span class="citation" data-cites="LEDA">Kleyer et al. (<a href="#ref-LEDA" role="doc-biblioref">2008</a>)</span></td>
</tr>
<tr class="odd">
<td>Leaf nitrogen / leaf mass [mg g⁻¹]</td>
<td><span class="citation" data-cites="trydb">Kattge et al. (<a href="#ref-trydb" role="doc-biblioref">2020</a>)</span></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled" title="Details on getting the species traits">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Details on getting the species traits
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The species traits were processed with the following script:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>1_input_traits.jl</strong></pre>
</div>
<div class="sourceCode" id="cb6" data-filename="1_input_traits.jl"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">include</span>(<span class="st">"0_functions_load_traits.jl"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">##### load tables</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>data_path <span class="op">=</span> <span class="st">"../data/"</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> <span class="st">"traits.csv"</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>df_leaf <span class="op">=</span> <span class="fu">bexis_leaf_traits</span>(data_path)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>df_root <span class="op">=</span> <span class="fu">bexis_root_traits</span>(data_path)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>df_leda <span class="op">=</span> <span class="fu">LEDA_height</span>(data_path)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>df_try <span class="op">=</span> <span class="fu">load_lnc_try</span>(data_path)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>df_maxheight <span class="op">=</span> CSV.<span class="fu">read</span>(data_path <span class="op">*</span> <span class="st">"maxheight_rothmaler.csv"</span>, DataFrame)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="pp">@transform</span>! df_maxheight <span class="op">:</span>maxheight <span class="op">=</span> <span class="op">:</span>maxheight <span class="op">.*</span> u<span class="st">"m"</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="pp">@select</span>! df_maxheight <span class="op">:</span>species <span class="op">:</span>maxheight</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">##### Add root data for Taraxacum officinale</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># https://groot-database.github.io/GRooT/</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/GRooT-Database/GRooT-Data/</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="fu">push!</span>(df_root, (<span class="st">"Taraxacum officinale"</span>, <span class="st">"-"</span>, <span class="fl">0.12</span>u<span class="st">"m^2/g"</span>, <span class="fl">0.7</span>, <span class="cn">missing</span>, <span class="fl">0.47</span>, <span class="fl">0.53</span>))</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">##### join tables</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>df_bexis <span class="op">=</span> <span class="fu">outerjoin</span>(df_leaf, df_root, on <span class="op">=</span> <span class="op">:</span>species, makeunique <span class="op">=</span> <span class="cn">true</span>)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="pp">@rtransform</span>! df_bexis <span class="op">:</span>sla <span class="op">=</span> <span class="fu">uconvert</span>(u<span class="st">"m^2 / g"</span>, <span class="fu">mean_missing</span>(<span class="op">:</span>sla1, <span class="op">:</span>sla2))</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="pp">@select</span>! df_bexis <span class="op">$</span>(<span class="fu">Not</span>([<span class="op">:</span>sla1, <span class="op">:</span>sla2, <span class="op">:</span>LA, <span class="op">:</span>LDM]))</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> <span class="fu">leftjoin</span>(df_bexis, df_leda, on <span class="op">=</span> <span class="op">:</span>species)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="fu">manual_height!</span>(df)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> <span class="fu">leftjoin</span>(df, df_try, on <span class="op">=</span> <span class="op">:</span>species)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">## export from try datasets citations:</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co"># try_dataset_references(df.species)</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co">##### write output without units</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>df_out <span class="op">=</span> <span class="pp">@chain</span> df1 <span class="cf">begin</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@orderby</span> <span class="op">:</span>species</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rename</span> <span class="op">:</span>rsa <span class="op">=</span> <span class="op">:</span>srsa</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rsubset</span> !<span class="fu">any</span>(<span class="fu">ismissing</span>.([<span class="op">:</span>rsa, <span class="op">:</span>amc, <span class="op">:</span>abp, <span class="op">:</span>bbp, <span class="op">:</span>sla, <span class="op">:</span>height, <span class="op">:</span>lnc]))</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rtransform</span> <span class="cf">begin</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>rsa <span class="op">=</span> <span class="fu">round</span>(<span class="fu">typeof</span>(<span class="op">:</span>rsa), <span class="op">:</span>rsa; digits <span class="op">=</span> <span class="fl">4</span>)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>amc <span class="op">=</span> <span class="fu">round</span>(<span class="op">:</span>amc; digits <span class="op">=</span> <span class="fl">3</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>abp <span class="op">=</span> <span class="fu">round</span>(<span class="op">:</span>abp; digits <span class="op">=</span> <span class="fl">3</span>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>bbp <span class="op">=</span> <span class="fu">round</span>(<span class="op">:</span>bbp; digits <span class="op">=</span> <span class="fl">3</span>)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>sla <span class="op">=</span> <span class="fu">round</span>(<span class="fu">typeof</span>(<span class="op">:</span>sla), <span class="op">:</span>sla; digits <span class="op">=</span> <span class="fl">5</span>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>height <span class="op">=</span> <span class="fu">round</span>(<span class="fu">typeof</span>(<span class="op">:</span>height), <span class="op">:</span>height; digits <span class="op">=</span> <span class="fl">4</span>)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>lnc <span class="op">=</span> <span class="fu">round</span>(<span class="fu">typeof</span>(<span class="op">:</span>lnc), <span class="op">:</span>lnc; digits <span class="op">=</span> <span class="fl">1</span>)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">innerjoin</span>(df_maxheight, on <span class="op">=</span> <span class="op">:</span>species)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># or : species .∉ Ref(["Phragmites australis", "Phalaris arundinacea"])</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span> <span class="op">:</span>maxheight <span class="op">.&lt;=</span> <span class="fl">2</span>u<span class="st">"m"</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@select</span> <span class="fu">Not</span>([<span class="op">:</span>leaf_species_orig, <span class="op">:</span>root_species_orig, <span class="op">:</span>species_leda, <span class="op">:</span>height, <span class="op">:</span>bbp])</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="co">### Poa annua has a very high SLA value, which is not realistic</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="co">### We will replace it with the mean of the other poa species</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="pp">@subset</span> df_out <span class="op">:</span>sla <span class="op">.&gt;</span> <span class="fl">0.03</span>u<span class="st">"m^2/g"</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="pp">@subset</span> df_out <span class="fu">startswith</span>.(<span class="op">:</span>species, <span class="st">"Poa"</span>)</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>([<span class="fl">0.001</span>, <span class="fl">0.014</span>, <span class="fl">0.018</span>])</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>df_out[df_out.species <span class="op">.==</span> <span class="st">"Poa annua"</span>, <span class="op">:</span>sla] <span class="op">.=</span> <span class="fl">0.011</span>u<span class="st">"m^2/g"</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="fu">disallowmissing!</span>(df_out)</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>df_out_wo_units <span class="op">=</span> <span class="pp">@rtransform</span> df_out <span class="cf">begin</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span>rsa <span class="op">=</span> <span class="fu">ustrip</span>(<span class="op">:</span>rsa)</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span>sla <span class="op">=</span> <span class="fu">ustrip</span>(<span class="op">:</span>sla)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span>maxheight <span class="op">=</span> <span class="fu">ustrip</span>(<span class="op">:</span>maxheight)</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span>lnc <span class="op">=</span> <span class="fu">ustrip</span>(<span class="op">:</span>lnc)</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(output_path, df_out_wo_units)</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="co">##### read file and add units</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a><span class="pp">@chain</span> CSV.<span class="fu">read</span>(output_path, DataFrame) <span class="cf">begin</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="cf">begin</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>srsa <span class="op">=</span> <span class="op">:</span>srsa <span class="op">*</span> u<span class="st">"m^2 / g"</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>sla <span class="op">=</span> <span class="op">:</span>sla <span class="op">*</span> u<span class="st">"m^2 / g"</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>height <span class="op">=</span> <span class="op">:</span>height <span class="op">*</span> u<span class="st">"m"</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>lnc <span class="op">=</span> <span class="op">:</span>lnc <span class="op">*</span> u<span class="st">"mg / g"</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The functions for loading the trait data are described in the following script:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>0_functions_load_traits.jl</strong></pre>
</div>
<div class="sourceCode" id="cb7" data-filename="0_functions_load_traits.jl"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">DataFramesMeta</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RCall</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">CSV</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">Dates</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">mean_missing</span>(x1, x2)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">ismissing</span>(x1)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x2</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elseif</span> <span class="fu">ismissing</span>(x2)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x1</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">mean</span>([x1, x2])</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">bexis_leaf_traits</span>(path)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@info</span> <span class="st">"Loading bexis leaf traits"</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span> <span class="st">"leaf_traits.csv"</span>, DataFrame;</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        missingstring<span class="op">=</span><span class="st">"NA"</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LA: leaf area [mm²]</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LFM: leaf fresh mass [g]</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LDM: leaf dry weight [g]</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>system <span class="op">.==</span> <span class="st">"grassland"</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="cf">begin</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>LA <span class="op">=</span> <span class="op">:</span>total_area <span class="op">*</span> u<span class="st">"mm^2"</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>LDM <span class="op">=</span> <span class="op">:</span>dry_weight <span class="op">*</span> u<span class="st">"g"</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>leaf_species_orig <span class="op">=</span> <span class="op">:</span>pl_species</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>leaf_species <span class="op">=</span> <span class="op">:</span>pl_species</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="op">:</span>plotID <span class="op">=</span> <span class="op">:</span>plotid_withzero</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>leaf_species <span class="op">.∉</span> <span class="fu">Ref</span>([<span class="st">"Crataegus sp"</span>, <span class="st">"Secale sp"</span>])</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>leaf_species <span class="op">:</span>leaf_species_orig <span class="op">:</span>LA <span class="op">:</span>LDM</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rsubset</span> !(<span class="fu">ismissing</span>(<span class="op">:</span>LA) <span class="op">||</span> <span class="fu">ismissing</span>(<span class="op">:</span>LDM))</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">disallowmissing!</span>(df)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    df[df.leaf_species <span class="op">.==</span> <span class="st">"Festuca pratensis"</span>, <span class="op">:</span>leaf_species] <span class="op">.=</span> <span class="st">"Lolium pratense (Huds.) Darbysh."</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    df[df.leaf_species <span class="op">.==</span> <span class="st">"Festuca arundinacea"</span>, <span class="op">:</span>leaf_species] <span class="op">.=</span> <span class="st">"Lolium arundinaceum (Schreb.) Darbysh."</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    df[df.leaf_species <span class="op">.==</span> <span class="st">"Taraxacum sp"</span>, <span class="op">:</span>leaf_species] <span class="op">.=</span> <span class="st">"Taraxacum officinale F.H.Wigg."</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    df[df.leaf_species <span class="op">.==</span> <span class="st">"Prunella sp"</span>, <span class="op">:</span>leaf_species] <span class="op">.=</span> <span class="st">"Prunella vulgaris L."</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    df[df.leaf_species <span class="op">.==</span> <span class="st">"Primula elatior veris agg"</span>, <span class="op">:</span>leaf_species] <span class="op">.=</span> <span class="st">"Primula elatior Hill"</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    df[df.leaf_species <span class="op">.==</span> <span class="st">"Bromus hordeaceus agg incl. B. commutatus"</span>, <span class="op">:</span>leaf_species] <span class="op">.=</span> <span class="st">"Bromus hordeaceus L."</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    df[df.leaf_species <span class="op">.==</span> <span class="st">"Rhinanthus agg"</span>, <span class="op">:</span>leaf_species] <span class="op">.=</span> <span class="st">"Rhinanthus minor L."</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    leaf_species <span class="op">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(df.leaf_species))</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># [println(s) for s in sort(unique(leaf_species))];</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rput</span> leaf_species</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    R<span class="st">"""</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="st">    library(TNRS)</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="st">    leaf_species_df&lt;- TNRS(leaf_species)</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="st">    NaN</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rget</span> leaf_species_df</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    leaf_species_df <span class="op">=</span> <span class="pp">@chain</span> leaf_species_df <span class="cf">begin</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>leaf_species <span class="op">=</span> <span class="op">:</span>Name_submitted</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>species <span class="op">=</span> <span class="op">:</span>Accepted_species</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>species <span class="op">:</span>leaf_species</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>        <span class="fu">leftjoin</span>(leaf_species_df, on <span class="op">=</span> <span class="op">:</span>leaf_species)</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@groupby</span> <span class="op">:</span>species</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@combine</span> <span class="cf">begin</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>leaf_species_orig <span class="op">=</span> <span class="fu">first</span>(<span class="op">:</span>leaf_species_orig)</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>LA <span class="op">=</span> <span class="fu">median</span>(<span class="op">:</span>LA)</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>LDM <span class="op">=</span> <span class="fu">median</span>(<span class="op">:</span>LDM)</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>species</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>sla1 <span class="op">=</span> <span class="op">:</span>LA <span class="op">./</span> <span class="op">:</span>LDM</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">bexis_root_traits</span>(path)</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@info</span> <span class="st">"Loading bexis root traits"</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> CSV.<span class="fu">read</span>(data_path <span class="op">*</span> <span class="st">"root_traits.csv"</span>, DataFrame;</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>        missingstring<span class="op">=</span><span class="st">"NA"</span>)</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="op">:</span>root_species_orig <span class="op">=</span> <span class="op">:</span>species</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>species <span class="op">=</span> <span class="fu">convert</span>.(<span class="dt">String</span>, <span class="op">:</span>root_species_orig)</span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>    df[df.species <span class="op">.==</span> <span class="st">"Festuca_pratensis"</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Lolium pratense (Huds.) Darbysh."</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>    df[df.species <span class="op">.==</span> <span class="st">"Festuca_arundinacea"</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Lolium arundinaceum (Schreb.) Darbysh."</span></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>    root_species <span class="op">=</span> df.species</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># [println(s) for s in root_species];</span></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rput</span> root_species</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>    R<span class="st">"""</span></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a><span class="st">    library(TNRS)</span></span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a><span class="st">    root_species_df&lt;- TNRS(root_species)</span></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a><span class="st">    NaN</span></span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rget</span> root_species_df</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># BA:</span></span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   below ground dry biomass / aboveground dry biomass</span></span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   [ratio area/mass]</span></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># SRSA:</span></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   root surface area / root dry biomass</span></span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   [m²/g]</span></span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># AMC:</span></span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   arbuscular mycorrhizal colonisation of the entire root system</span></span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   [fraction, 0 to 1]</span></span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="cf">begin</span></span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>species <span class="op">=</span> root_species_df.Accepted_species</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>ba <span class="op">=</span> <span class="op">:</span>biomass_allocation</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>srsa <span class="op">=</span> <span class="op">:</span>SRSA <span class="op">*</span> u<span class="st">"m^2 / g"</span></span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>amc <span class="op">=</span> <span class="op">:</span>col</span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>sla2 <span class="op">=</span> <span class="op">:</span>SLA <span class="op">*</span> u<span class="st">"cm^2 / g"</span></span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>abp <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">+</span> <span class="op">:</span>ba)</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>bbp <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="op">:</span>abp</span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>species</span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>species <span class="op">:</span>root_species_orig <span class="op">:</span>srsa <span class="op">:</span>amc <span class="op">:</span>sla2 <span class="op">:</span>abp <span class="op">:</span>bbp</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">LEDA_height</span>(path)</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">isfile</span>(path <span class="op">*</span>  <span class="st">"canopy_height_LEDA.csv"</span>)</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span>  <span class="st">"canopy_height_LEDA.csv"</span>, DataFrame)</span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span>! df <span class="op">:</span>height <span class="op">=</span> <span class="op">:</span>height <span class="op">*</span> u<span class="st">"m"</span></span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span>! df .! <span class="fu">ismissing</span>.(<span class="op">:</span>species)</span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@info</span> <span class="st">"Loading leada height"</span></span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">data_available</span>(data)</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a>        f <span class="op">=</span> <span class="fu">isa</span>.(data, <span class="dt">Number</span>)</span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a>        f[f] <span class="op">.=</span> .! <span class="fu">isnan</span>.(data[f]) <span class="op">.&amp;&amp;</span> <span class="cn">Inf</span> <span class="op">.&gt;</span> data[f] <span class="op">.&gt;</span> <span class="fl">0</span></span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> f</span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span>  <span class="st">"LEDA/canopy_height.txt"</span>, DataFrame;</span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a>        missingstring<span class="op">=</span>[<span class="st">""</span>, <span class="st">"NA"</span>],</span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a>        delim<span class="op">=</span><span class="st">";"</span>)</span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a>    df[!, <span class="op">:</span>height] <span class="op">.=</span> <span class="cn">NaN</span></span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a>    <span class="co">### Use single values</span></span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a>    f1 <span class="op">=</span> <span class="fu">data_available</span>(df[<span class="op">:</span>, <span class="st">"single value [m]"</span>])</span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a>    df[f1, <span class="op">:</span>height] <span class="op">.=</span> df[f1, <span class="st">"single value [m]"</span>]</span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a>    <span class="co">### even better mean values</span></span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a>    f1 <span class="op">=</span> <span class="fu">data_available</span>(df[<span class="op">:</span>, <span class="st">"mean CH [m]"</span>])</span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a>    df[f1, <span class="op">:</span>height] <span class="op">.=</span> df[f1, <span class="st">"mean CH [m]"</span>]</span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rename</span>! df <span class="op">:</span>species_leda <span class="op">=</span> <span class="op">$</span>(<span class="fu">Symbol</span>(<span class="st">"SBS name"</span>))</span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span>! df <span class="op">:</span>leda_species_orig <span class="op">=</span> <span class="op">:</span>species_leda</span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a>    df[df.species_leda <span class="op">.==</span> <span class="st">"Festuca pratensis"</span>, <span class="op">:</span>species_leda] <span class="op">.=</span> <span class="st">"Lolium pratense (Huds.) Darbysh."</span></span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a>    df[df.species_leda <span class="op">.==</span> <span class="st">"Festuca pratensis s. apennina"</span>, <span class="op">:</span>species_leda] <span class="op">.=</span> <span class="st">"Festuca pratensis subsp. apennina(De Not.) Hegi"</span></span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a>    df[df.species_leda <span class="op">.==</span> <span class="st">"Festuca arundinacea"</span>, <span class="op">:</span>species_leda] <span class="op">.=</span> <span class="st">"Lolium arundinaceum (Schreb.) Darbysh."</span></span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a>    df[df.species_leda <span class="op">.==</span> <span class="st">"Senecio jacobaea"</span>, <span class="op">:</span>species_leda] <span class="op">.=</span> <span class="st">"Senecio vulgaris L."</span></span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a>    df[df.species_leda <span class="op">.==</span> <span class="st">"Taraxacum Sec. Ruderalia"</span>, <span class="op">:</span>species_leda] <span class="op">.=</span> <span class="st">"Taraxacum officinale F.H.Wigg."</span></span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a>    leda_species <span class="op">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(df.species_leda))</span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rput</span> leda_species</span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a>    R<span class="st">"""</span></span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a><span class="st">    library(TNRS)</span></span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a><span class="st">    leda_species_df &lt;- TNRS(leda_species)</span></span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a><span class="st">    NaN</span></span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rget</span> leda_species_df</span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a>    leda_species_df <span class="op">=</span> <span class="pp">@chain</span> leda_species_df <span class="cf">begin</span></span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb7-176"><a href="#cb7-176" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>species_leda <span class="op">=</span> <span class="op">:</span>Name_submitted</span>
<span id="cb7-177"><a href="#cb7-177" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>species <span class="op">=</span> <span class="op">:</span>Accepted_species</span>
<span id="cb7-178"><a href="#cb7-178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-179"><a href="#cb7-179" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>species <span class="op">:</span>species_leda</span>
<span id="cb7-180"><a href="#cb7-180" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-181"><a href="#cb7-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-182"><a href="#cb7-182" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb7-183"><a href="#cb7-183" aria-hidden="true" tabindex="-1"></a>        <span class="fu">leftjoin</span>(leda_species_df, on <span class="op">=</span> <span class="op">:</span>species_leda)</span>
<span id="cb7-184"><a href="#cb7-184" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@groupby</span> <span class="op">:</span>species</span>
<span id="cb7-185"><a href="#cb7-185" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@combine</span> <span class="cf">begin</span></span>
<span id="cb7-186"><a href="#cb7-186" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>species_leda <span class="op">=</span> <span class="fu">first</span>(<span class="op">:</span>species_leda)</span>
<span id="cb7-187"><a href="#cb7-187" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>height <span class="op">=</span> <span class="fu">median</span>(<span class="op">:</span>height)</span>
<span id="cb7-188"><a href="#cb7-188" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-189"><a href="#cb7-189" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-190"><a href="#cb7-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-191"><a href="#cb7-191" aria-hidden="true" tabindex="-1"></a>    CSV.<span class="fu">write</span>(path <span class="op">*</span>  <span class="st">"LEDA/canopy_height_sub.csv"</span>, df)</span>
<span id="cb7-192"><a href="#cb7-192" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span>! df <span class="op">:</span>height <span class="op">=</span> <span class="op">:</span>height <span class="op">*</span> u<span class="st">"m"</span></span>
<span id="cb7-193"><a href="#cb7-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-194"><a href="#cb7-194" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb7-195"><a href="#cb7-195" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-196"><a href="#cb7-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-197"><a href="#cb7-197" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">manual_height!</span>(df)</span>
<span id="cb7-198"><a href="#cb7-198" aria-hidden="true" tabindex="-1"></a>    species_without_height <span class="op">=</span> [<span class="st">"Poa trivialis"</span>, <span class="st">"Helictotrichon pubescens"</span>,</span>
<span id="cb7-199"><a href="#cb7-199" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Veronica teucrium"</span>, <span class="st">"Tripleurospermum inodorum"</span>, <span class="st">"Rumex acetosella"</span>,</span>
<span id="cb7-200"><a href="#cb7-200" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Medicago falcata"</span>, <span class="st">"Carex vulpina"</span>]</span>
<span id="cb7-201"><a href="#cb7-201" aria-hidden="true" tabindex="-1"></a>    new_height <span class="op">=</span> [<span class="fl">0.3</span>, <span class="fl">0.6</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>]u<span class="st">"m"</span></span>
<span id="cb7-202"><a href="#cb7-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-203"><a href="#cb7-203" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(new_height)</span>
<span id="cb7-204"><a href="#cb7-204" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> species_without_height[i]</span>
<span id="cb7-205"><a href="#cb7-205" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> new_height[i]</span>
<span id="cb7-206"><a href="#cb7-206" aria-hidden="true" tabindex="-1"></a>        df[df.species <span class="op">.==</span> s, <span class="op">:</span>height] <span class="op">.=</span> v</span>
<span id="cb7-207"><a href="#cb7-207" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-208"><a href="#cb7-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-209"><a href="#cb7-209" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb7-210"><a href="#cb7-210" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-211"><a href="#cb7-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-212"><a href="#cb7-212" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">load_lnc_try</span>(path)</span>
<span id="cb7-213"><a href="#cb7-213" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@info</span> <span class="st">"Loading try lnc"</span></span>
<span id="cb7-214"><a href="#cb7-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-215"><a href="#cb7-215" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">isfile</span>(path <span class="op">*</span>  <span class="st">"Leaf_nitrogen_content_TRY.csv"</span>)</span>
<span id="cb7-216"><a href="#cb7-216" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span>  <span class="st">"Leaf_nitrogen_content_TRY.csv"</span>, DataFrame)</span>
<span id="cb7-217"><a href="#cb7-217" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span>! df <span class="op">:</span>lnc <span class="op">=</span> <span class="op">:</span>lnc <span class="op">*</span> u<span class="st">"mg/g"</span></span>
<span id="cb7-218"><a href="#cb7-218" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span>! df .! <span class="fu">ismissing</span>.(<span class="op">:</span>species)</span>
<span id="cb7-219"><a href="#cb7-219" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb7-220"><a href="#cb7-220" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-221"><a href="#cb7-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-222"><a href="#cb7-222" aria-hidden="true" tabindex="-1"></a>    try_df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span>  <span class="st">"TRY/33838.txt"</span>, DataFrame;</span>
<span id="cb7-223"><a href="#cb7-223" aria-hidden="true" tabindex="-1"></a>        missingstring<span class="op">=</span>[<span class="st">""</span>, <span class="st">"NA"</span>],</span>
<span id="cb7-224"><a href="#cb7-224" aria-hidden="true" tabindex="-1"></a>        delim<span class="op">=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb7-225"><a href="#cb7-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-226"><a href="#cb7-226" aria-hidden="true" tabindex="-1"></a>    try_sub_df <span class="op">=</span> <span class="pp">@chain</span> try_df <span class="cf">begin</span></span>
<span id="cb7-227"><a href="#cb7-227" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> .! <span class="fu">ismissing</span>.(<span class="op">:</span>AccSpeciesName)</span>
<span id="cb7-228"><a href="#cb7-228" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> .! <span class="fu">ismissing</span>.(<span class="op">:</span>TraitName)</span>
<span id="cb7-229"><a href="#cb7-229" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> .! <span class="fu">ismissing</span>.(<span class="op">:</span>StdValue)</span>
<span id="cb7-230"><a href="#cb7-230" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>AccSpeciesName <span class="op">:</span>StdValue <span class="op">:</span>TraitName</span>
<span id="cb7-231"><a href="#cb7-231" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-232"><a href="#cb7-232" aria-hidden="true" tabindex="-1"></a>    <span class="fu">disallowmissing!</span>(try_sub_df)</span>
<span id="cb7-233"><a href="#cb7-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-234"><a href="#cb7-234" aria-hidden="true" tabindex="-1"></a>    try_species <span class="op">=</span> <span class="fu">unique</span>(try_sub_df.AccSpeciesName)</span>
<span id="cb7-235"><a href="#cb7-235" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rput</span> try_species</span>
<span id="cb7-236"><a href="#cb7-236" aria-hidden="true" tabindex="-1"></a>    R<span class="st">"""</span></span>
<span id="cb7-237"><a href="#cb7-237" aria-hidden="true" tabindex="-1"></a><span class="st">    library(TNRS)</span></span>
<span id="cb7-238"><a href="#cb7-238" aria-hidden="true" tabindex="-1"></a><span class="st">    try_species_df&lt;- TNRS(try_species)</span></span>
<span id="cb7-239"><a href="#cb7-239" aria-hidden="true" tabindex="-1"></a><span class="st">    NaN</span></span>
<span id="cb7-240"><a href="#cb7-240" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb7-241"><a href="#cb7-241" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rget</span> try_species_df</span>
<span id="cb7-242"><a href="#cb7-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-243"><a href="#cb7-243" aria-hidden="true" tabindex="-1"></a>    try_species_sub_df <span class="op">=</span> <span class="pp">@chain</span> try_species_df <span class="cf">begin</span></span>
<span id="cb7-244"><a href="#cb7-244" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb7-245"><a href="#cb7-245" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>AccSpeciesName <span class="op">=</span> <span class="op">:</span>Name_submitted</span>
<span id="cb7-246"><a href="#cb7-246" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>species <span class="op">=</span> <span class="op">:</span>Accepted_species</span>
<span id="cb7-247"><a href="#cb7-247" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-248"><a href="#cb7-248" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>species</span>
<span id="cb7-249"><a href="#cb7-249" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>species <span class="op">:</span>AccSpeciesName</span>
<span id="cb7-250"><a href="#cb7-250" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-251"><a href="#cb7-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-252"><a href="#cb7-252" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="pp">@chain</span> try_sub_df <span class="cf">begin</span></span>
<span id="cb7-253"><a href="#cb7-253" aria-hidden="true" tabindex="-1"></a>        <span class="fu">leftjoin</span>(try_species_sub_df, on <span class="op">=</span> <span class="st">"AccSpeciesName"</span>)</span>
<span id="cb7-254"><a href="#cb7-254" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>TraitName <span class="op">.==</span> <span class="st">"Leaf nitrogen (N) content per leaf dry mass"</span></span>
<span id="cb7-255"><a href="#cb7-255" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@groupby</span> <span class="op">:</span>species</span>
<span id="cb7-256"><a href="#cb7-256" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@combine</span> <span class="op">:</span>lnc <span class="op">=</span> <span class="fu">median</span>(<span class="op">:</span>StdValue)</span>
<span id="cb7-257"><a href="#cb7-257" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> .! <span class="fu">ismissing</span>.(<span class="op">:</span>species)</span>
<span id="cb7-258"><a href="#cb7-258" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-259"><a href="#cb7-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-260"><a href="#cb7-260" aria-hidden="true" tabindex="-1"></a>    CSV.<span class="fu">write</span>(path <span class="op">*</span>  <span class="st">"TRY/33838_sub.csv"</span>, df)</span>
<span id="cb7-261"><a href="#cb7-261" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span>! df <span class="op">:</span>lnc <span class="op">=</span> <span class="op">:</span>lnc <span class="op">*</span> u<span class="st">"mg/g"</span></span>
<span id="cb7-262"><a href="#cb7-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-263"><a href="#cb7-263" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb7-264"><a href="#cb7-264" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-265"><a href="#cb7-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-266"><a href="#cb7-266" aria-hidden="true" tabindex="-1"></a><span class="co">### export citation from TRY</span></span>
<span id="cb7-267"><a href="#cb7-267" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">try_dataset_references</span>(species)</span>
<span id="cb7-268"><a href="#cb7-268" aria-hidden="true" tabindex="-1"></a>    try_df <span class="op">=</span> CSV.<span class="fu">read</span>(data_path <span class="op">*</span>  <span class="st">"TRY/33838.txt"</span>, DataFrame;</span>
<span id="cb7-269"><a href="#cb7-269" aria-hidden="true" tabindex="-1"></a>                    missingstring<span class="op">=</span>[<span class="st">""</span>, <span class="st">"NA"</span>], delim<span class="op">=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb7-270"><a href="#cb7-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-271"><a href="#cb7-271" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@chain</span> try_df <span class="cf">begin</span></span>
<span id="cb7-272"><a href="#cb7-272" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>species <span class="op">=</span> <span class="op">:</span>SpeciesName</span>
<span id="cb7-273"><a href="#cb7-273" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>species <span class="op">.∈</span> <span class="fu">Ref</span>(species)</span>
<span id="cb7-274"><a href="#cb7-274" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>TraitName <span class="op">.==</span> <span class="st">"Leaf nitrogen (N) content per leaf dry mass"</span></span>
<span id="cb7-275"><a href="#cb7-275" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@groupby</span> <span class="op">:</span>Dataset <span class="op">:</span>Reference</span>
<span id="cb7-276"><a href="#cb7-276" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@combine</span> <span class="cf">begin</span></span>
<span id="cb7-277"><a href="#cb7-277" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>n <span class="op">=</span> <span class="fu">length</span>(<span class="op">:</span>Dataset)</span>
<span id="cb7-278"><a href="#cb7-278" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>r <span class="op">=</span> <span class="fu">first</span>(<span class="op">:</span>Reference)</span>
<span id="cb7-279"><a href="#cb7-279" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-280"><a href="#cb7-280" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>n</span>
<span id="cb7-281"><a href="#cb7-281" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-282"><a href="#cb7-282" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-283"><a href="#cb7-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-284"><a href="#cb7-284" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">convert_id</span>(id)</span>
<span id="cb7-285"><a href="#cb7-285" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="fu">first</span>.(id, <span class="fl">3</span>)</span>
<span id="cb7-286"><a href="#cb7-286" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">chop</span>(id, head <span class="op">=</span> <span class="fl">3</span>, tail <span class="op">=</span> <span class="fl">0</span>)</span>
<span id="cb7-287"><a href="#cb7-287" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">lpad</span>(b, <span class="fl">2</span>, <span class="st">"0"</span>)</span>
<span id="cb7-288"><a href="#cb7-288" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> b</span>
<span id="cb7-289"><a href="#cb7-289" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-290"><a href="#cb7-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-291"><a href="#cb7-291" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">to_numeric</span>(d<span class="op">::</span><span class="dt">Dates.Date</span>)</span>
<span id="cb7-292"><a href="#cb7-292" aria-hidden="true" tabindex="-1"></a>    daysinyear <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">daysinyear</span>(<span class="bu">Dates</span>.<span class="fu">year</span>(d))</span>
<span id="cb7-293"><a href="#cb7-293" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Dates</span>.<span class="fu">year</span>(d) <span class="op">+</span> (<span class="bu">Dates</span>.<span class="fu">dayofyear</span>(d) <span class="op">-</span> <span class="fl">1</span>) <span class="op">/</span> daysinyear</span>
<span id="cb7-294"><a href="#cb7-294" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-295"><a href="#cb7-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-296"><a href="#cb7-296" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">load_veg_df</span>(path)</span>
<span id="cb7-297"><a href="#cb7-297" aria-hidden="true" tabindex="-1"></a>    veg_df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span> <span class="st">"vegetation_2008_2022.csv"</span>, DataFrame,</span>
<span id="cb7-298"><a href="#cb7-298" aria-hidden="true" tabindex="-1"></a>        missingstring <span class="op">=</span> [<span class="st">""</span>, <span class="st">"NA"</span>])</span>
<span id="cb7-299"><a href="#cb7-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-300"><a href="#cb7-300" aria-hidden="true" tabindex="-1"></a>    veg_df <span class="op">=</span> <span class="pp">@chain</span> veg_df <span class="cf">begin</span></span>
<span id="cb7-301"><a href="#cb7-301" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> .! <span class="fu">ismissing</span>.(<span class="op">:</span>Cover)</span>
<span id="cb7-302"><a href="#cb7-302" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>Cover <span class="op">.&gt;</span> <span class="fl">0</span></span>
<span id="cb7-303"><a href="#cb7-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-304"><a href="#cb7-304" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb7-305"><a href="#cb7-305" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>species <span class="op">=</span> <span class="op">:</span>Species</span>
<span id="cb7-306"><a href="#cb7-306" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>year <span class="op">=</span> <span class="op">:</span>Year</span>
<span id="cb7-307"><a href="#cb7-307" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>cover <span class="op">=</span> <span class="op">:</span>Cover</span>
<span id="cb7-308"><a href="#cb7-308" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>plotID <span class="op">=</span> <span class="op">:</span>Useful_EP_PlotID</span>
<span id="cb7-309"><a href="#cb7-309" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-310"><a href="#cb7-310" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>year <span class="op">:</span>species <span class="op">:</span>cover</span>
<span id="cb7-311"><a href="#cb7-311" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>plotID <span class="op">:</span>year <span class="op">:</span>species</span>
<span id="cb7-312"><a href="#cb7-312" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-313"><a href="#cb7-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-314"><a href="#cb7-314" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Festuca_pratensis"</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Lolium pratense (Huds.) Darbysh."</span></span>
<span id="cb7-315"><a href="#cb7-315" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Festuca_arundinacea"</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Lolium arundinaceum (Schreb.) Darbysh."</span></span>
<span id="cb7-316"><a href="#cb7-316" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Senecio_jacobaea"</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Jacobaea vulgaris Gaertn."</span></span>
<span id="cb7-317"><a href="#cb7-317" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Trifolium_campestre/dubium_aggr."</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Trifolium dubium Sibth."</span></span>
<span id="cb7-318"><a href="#cb7-318" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Vicia_cf_lathyroides"</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Vicia lathyroides L."</span></span>
<span id="cb7-319"><a href="#cb7-319" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Geum_rivale/urbanum_aggr."</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Geum urbanum L."</span></span>
<span id="cb7-320"><a href="#cb7-320" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Ononis_repens/spinosa_aggr."</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Ononis spinosa L."</span></span>
<span id="cb7-321"><a href="#cb7-321" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Geranium_cf_pusillum"</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Geranium pusillum L."</span></span>
<span id="cb7-322"><a href="#cb7-322" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Primula_elatior/veris/aggr."</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Primula elatior Hill"</span></span>
<span id="cb7-323"><a href="#cb7-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-324"><a href="#cb7-324" aria-hidden="true" tabindex="-1"></a>    veg_species <span class="op">=</span> <span class="fu">unique</span>(veg_df.species)</span>
<span id="cb7-325"><a href="#cb7-325" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rput</span> veg_species</span>
<span id="cb7-326"><a href="#cb7-326" aria-hidden="true" tabindex="-1"></a>    R<span class="st">"""</span></span>
<span id="cb7-327"><a href="#cb7-327" aria-hidden="true" tabindex="-1"></a><span class="st">    library(TNRS)</span></span>
<span id="cb7-328"><a href="#cb7-328" aria-hidden="true" tabindex="-1"></a><span class="st">    veg_species_df &lt;- TNRS(veg_species)</span></span>
<span id="cb7-329"><a href="#cb7-329" aria-hidden="true" tabindex="-1"></a><span class="st">    NaN</span></span>
<span id="cb7-330"><a href="#cb7-330" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb7-331"><a href="#cb7-331" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rget</span> veg_species_df</span>
<span id="cb7-332"><a href="#cb7-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-333"><a href="#cb7-333" aria-hidden="true" tabindex="-1"></a>    veg_species_df <span class="op">=</span> <span class="pp">@chain</span> veg_species_df <span class="cf">begin</span></span>
<span id="cb7-334"><a href="#cb7-334" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb7-335"><a href="#cb7-335" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>species <span class="op">=</span> <span class="op">:</span>Accepted_species</span>
<span id="cb7-336"><a href="#cb7-336" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>veg_orig_name <span class="op">=</span> <span class="op">:</span>Name_submitted</span>
<span id="cb7-337"><a href="#cb7-337" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-338"><a href="#cb7-338" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>species <span class="op">.!==</span> <span class="st">""</span></span>
<span id="cb7-339"><a href="#cb7-339" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>species <span class="op">:</span>veg_orig_name</span>
<span id="cb7-340"><a href="#cb7-340" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-341"><a href="#cb7-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-342"><a href="#cb7-342" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> veg_df, veg_species_df</span>
<span id="cb7-343"><a href="#cb7-343" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-344"><a href="#cb7-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-345"><a href="#cb7-345" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">load_vegetation_date_df</span>(path)</span>
<span id="cb7-346"><a href="#cb7-346" aria-hidden="true" tabindex="-1"></a>    ep_plots <span class="op">=</span> [<span class="st">"</span><span class="sc">$</span>(explo)<span class="st">"</span> <span class="op">*</span> <span class="fu">lpad</span>(i, <span class="fl">2</span>, <span class="st">"0"</span>) for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span> for explo <span class="kw">in</span> [<span class="st">"HEG"</span>, <span class="st">"SEG"</span>, <span class="st">"AEG"</span>]]</span>
<span id="cb7-347"><a href="#cb7-347" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="op">=</span> <span class="fu">DataFrame</span>(plotID <span class="op">=</span> ep_plots)</span>
<span id="cb7-348"><a href="#cb7-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-349"><a href="#cb7-349" aria-hidden="true" tabindex="-1"></a>    datasets <span class="op">=</span> [<span class="st">"vegetation_header_data_</span><span class="sc">$</span>y<span class="st">.csv"</span> for y <span class="kw">in</span> <span class="fl">2009</span><span class="op">:</span><span class="fl">2021</span>]</span>
<span id="cb7-350"><a href="#cb7-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-351"><a href="#cb7-351" aria-hidden="true" tabindex="-1"></a>    date_col <span class="op">=</span> [<span class="fu">fill</span>(<span class="op">:</span><span class="dt">Date</span>, <span class="fl">2</span>)<span class="op">...</span></span>
<span id="cb7-352"><a href="#cb7-352" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>date, <span class="fl">3</span>)<span class="op">...</span></span>
<span id="cb7-353"><a href="#cb7-353" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="cn">missing</span>, <span class="fl">4</span>)<span class="op">...</span></span>
<span id="cb7-354"><a href="#cb7-354" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>date_releves, <span class="fl">4</span>)<span class="op">...</span>]</span>
<span id="cb7-355"><a href="#cb7-355" aria-hidden="true" tabindex="-1"></a>    id_cols <span class="op">=</span> [<span class="op">:</span>EPID</span>
<span id="cb7-356"><a href="#cb7-356" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>EpPlotID, <span class="fl">8</span>)<span class="op">...</span></span>
<span id="cb7-357"><a href="#cb7-357" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>Ep_PlotID, <span class="fl">4</span>)<span class="op">...</span>]</span>
<span id="cb7-358"><a href="#cb7-358" aria-hidden="true" tabindex="-1"></a>    dfs <span class="op">=</span> []</span>
<span id="cb7-359"><a href="#cb7-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-360"><a href="#cb7-360" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i, file) <span class="kw">in</span> <span class="fu">enumerate</span>(datasets)</span>
<span id="cb7-361"><a href="#cb7-361" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span> file,</span>
<span id="cb7-362"><a href="#cb7-362" aria-hidden="true" tabindex="-1"></a>            DataFrame;</span>
<span id="cb7-363"><a href="#cb7-363" aria-hidden="true" tabindex="-1"></a>            missingstring <span class="op">=</span> [<span class="st">""</span>, <span class="st">"NA"</span>])</span>
<span id="cb7-364"><a href="#cb7-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-365"><a href="#cb7-365" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="fu">ismissing</span>(date_col[i])</span>
<span id="cb7-366"><a href="#cb7-366" aria-hidden="true" tabindex="-1"></a>            doy <span class="op">=</span> df.day_of_year</span>
<span id="cb7-367"><a href="#cb7-367" aria-hidden="true" tabindex="-1"></a>            doy[<span class="fu">ismissing</span>.(doy)] <span class="op">.=</span> <span class="fu">mean</span>(.!<span class="fu">ismissing</span>(doy))</span>
<span id="cb7-368"><a href="#cb7-368" aria-hidden="true" tabindex="-1"></a>            df.date <span class="op">=</span> @. <span class="bu">Dates</span>.<span class="fu">Date</span>(df.year) <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>(doy)</span>
<span id="cb7-369"><a href="#cb7-369" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb7-370"><a href="#cb7-370" aria-hidden="true" tabindex="-1"></a>            df.date <span class="op">=</span> df[<span class="op">:</span>, date_col[i]]</span>
<span id="cb7-371"><a href="#cb7-371" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-372"><a href="#cb7-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-373"><a href="#cb7-373" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb7-374"><a href="#cb7-374" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="op">:</span>plotID <span class="op">=</span> <span class="fu">convert_id</span>.(<span class="op">$</span>(id_cols[i]))</span>
<span id="cb7-375"><a href="#cb7-375" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>date</span>
<span id="cb7-376"><a href="#cb7-376" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rightjoin</span>(plot_df, on <span class="op">=</span> <span class="op">:</span>plotID)</span>
<span id="cb7-377"><a href="#cb7-377" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-378"><a href="#cb7-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-379"><a href="#cb7-379" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="fu">any</span>(<span class="fu">ismissing</span>.(df.date))</span>
<span id="cb7-380"><a href="#cb7-380" aria-hidden="true" tabindex="-1"></a>            selected_dates <span class="op">=</span> df[.!<span class="fu">ismissing</span>.(df.date), <span class="op">:</span>date]</span>
<span id="cb7-381"><a href="#cb7-381" aria-hidden="true" tabindex="-1"></a>            year <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">year</span>(selected_dates[<span class="fl">1</span>])</span>
<span id="cb7-382"><a href="#cb7-382" aria-hidden="true" tabindex="-1"></a>            mean_doy <span class="op">=</span> <span class="fu">Int</span>(<span class="fu">median</span>(<span class="bu">Dates</span>.<span class="fu">dayofyear</span>.(selected_dates)))</span>
<span id="cb7-383"><a href="#cb7-383" aria-hidden="true" tabindex="-1"></a>            df[<span class="fu">ismissing</span>.(df.date), <span class="op">:</span>date] <span class="op">.=</span> <span class="bu">Dates</span>.<span class="fu">Date</span>(year) <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>(mean_doy)</span>
<span id="cb7-384"><a href="#cb7-384" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-385"><a href="#cb7-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-386"><a href="#cb7-386" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unique!</span>(df, <span class="op">:</span>plotID)</span>
<span id="cb7-387"><a href="#cb7-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-388"><a href="#cb7-388" aria-hidden="true" tabindex="-1"></a>        <span class="co"># @show length(unique(df.plotID))</span></span>
<span id="cb7-389"><a href="#cb7-389" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(dfs, df)</span>
<span id="cb7-390"><a href="#cb7-390" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-391"><a href="#cb7-391" aria-hidden="true" tabindex="-1"></a>    date_df <span class="op">=</span> <span class="fu">vcat</span>(dfs<span class="op">...</span>)</span>
<span id="cb7-392"><a href="#cb7-392" aria-hidden="true" tabindex="-1"></a>    date_df.year <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">year</span>.(date_df.date)</span>
<span id="cb7-393"><a href="#cb7-393" aria-hidden="true" tabindex="-1"></a>    date_df.numeric_date <span class="op">=</span> <span class="fu">to_numeric</span>.(date_df.date)</span>
<span id="cb7-394"><a href="#cb7-394" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> date_df</span>
<span id="cb7-395"><a href="#cb7-395" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div id="2" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">GrasslandTraitSim</span> as sim</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">Dates</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">PairPlots</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">DataFramesMeta</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>traits <span class="op">=</span> sim.<span class="fu">input_traits</span>()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> <span class="fu">DataFrame</span>(traits)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">pairplot</span>( </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=&gt;</span> (</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        PairPlots.<span class="fu">Scatter</span>(color <span class="op">=</span> (<span class="op">:</span>blue, <span class="fl">0.5</span>), markersize <span class="op">=</span> <span class="fl">7</span>), </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        PairPlots.<span class="fu">Correlation</span>(; digits <span class="op">=</span> <span class="fl">2</span>, position<span class="op">=</span>PairPlots.Makie.<span class="fu">Point2f</span>(<span class="fl">0.2</span>, <span class="fl">1.0</span>)),</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        PairPlots.<span class="fu">MarginDensity</span>(),</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        PairPlots.<span class="fu">MarginHist</span>(color <span class="op">=</span> (<span class="op">:</span>black, <span class="fl">0.2</span>)),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        PairPlots.<span class="fu">MarginConfidenceLimits</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="data_files/figure-html/cell-2-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="daily-abiotic-conditions" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="daily-abiotic-conditions"><span class="header-section-number">2.2</span> Daily abiotic conditions</h3>
<p>For the first years from 2006 - 2008 no measurement directly from the sites were available. Therefore, the data was downloaded from the German Weather Service (DWD). The closest wheater station for each region (Schorfheife-Chorin, Hainich, Schwäbische Alb) was chosen. From 2009 to 2022, the data was used from the BExIS database mostly with measurements directly from the grassland sites (50 sites per region).</p>
<div class="callout callout-style-default callout-note callout-titled" title="Details on loading temperature and precipitation data from DWD">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Details on loading temperature and precipitation data from DWD
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The data was processed with the following script:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>temperature_precipitation_dwd.jl</strong></pre>
</div>
<div class="sourceCode" id="cb9" data-filename="temperature_precipitation_dwd.jl"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">CSV</span>, <span class="bu">Dates</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">DataFramesMeta</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">read_dwd_temp</span>(path; startyear <span class="op">=</span> <span class="fl">2006</span>, endyear <span class="op">=</span> <span class="fl">2008</span>, explo_str)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> CSV.<span class="fu">read</span>(path, DataFrame;</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                  types <span class="op">=</span> <span class="fu">Dict</span>(<span class="fl">2</span> <span class="op">=&gt;</span> <span class="bu">Dates</span>.<span class="dt">Date</span>),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                  dateformat<span class="op">=</span><span class="st">"yyyymmdd"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                  missingstring <span class="op">=</span> <span class="st">"-999"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                  delim <span class="op">=</span> <span class="st">";"</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                  stripwhitespace<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># TMK mean temperature of the air at 2m in °C</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RSK sum of precipitation in mm</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    df_sub <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>dwd_stations_id <span class="op">=</span> <span class="op">:</span>STATIONS_ID</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>date <span class="op">=</span> <span class="op">:</span>MESS_DATUM</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>temperature <span class="op">=</span> <span class="op">:</span>TMK</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>precipitation <span class="op">=</span> <span class="op">:</span>RSK</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>explo <span class="op">=</span> explo_str</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> endyear <span class="op">.&gt;=</span> <span class="bu">Dates</span>.<span class="fu">year</span>.(<span class="op">:</span>date) <span class="op">.&gt;=</span> startyear</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span>(<span class="op">:</span>explo, <span class="op">:</span>date, <span class="op">:</span>temperature, <span class="op">:</span>precipitation, <span class="op">:</span>dwd_stations_id)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">disallowmissing!</span>(df_sub)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_sub</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>data_path <span class="op">=</span> <span class="st">"../data"</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>sch_path <span class="op">=</span> <span class="st">"</span><span class="sc">$</span>data_path<span class="st">/temperature_precipitation_164.csv"</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>alb_path <span class="op">=</span> <span class="st">"</span><span class="sc">$</span>data_path<span class="st">/temperature_precipitation_3402.csv"</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>hai_path <span class="op">=</span> <span class="st">"</span><span class="sc">$</span>data_path<span class="st">/temperature_precipitation_6305.csv"</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>df_sch <span class="op">=</span> <span class="fu">read_dwd_temp</span>(sch_path; explo_str <span class="op">=</span> <span class="st">"SCH"</span>)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>df_alb <span class="op">=</span> <span class="fu">read_dwd_temp</span>(alb_path; explo_str <span class="op">=</span> <span class="st">"ALB"</span>)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>df_hai <span class="op">=</span> <span class="fu">read_dwd_temp</span>(hai_path; explo_str <span class="op">=</span> <span class="st">"HAI"</span>)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="co"># move the file to assets/data/input</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="fu">vcat</span>(df_sch, df_alb, df_hai) <span class="op">|&gt;</span> CSV.<span class="fu">write</span>(<span class="st">"temperature_precipitation_dwd.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Details on loading temperature and precipitation data from BExIS">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Details on loading temperature and precipitation data from BExIS
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The data was processed with the following script:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>temperature_precipitation_dwd.jl</strong></pre>
</div>
<div class="sourceCode" id="cb10" data-filename="temperature_precipitation_dwd.jl"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">CSV</span>, <span class="bu">Dates</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">DataFramesMeta</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>data_path <span class="op">=</span> <span class="st">"../data/"</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> CSV.<span class="fu">read</span>(data_path <span class="op">*</span> <span class="st">"exploratories_climate/plots.csv"</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    DataFrame,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    missingstring <span class="op">=</span> [<span class="st">"NA"</span>],</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    dateformat <span class="op">=</span> <span class="st">"dd/mm/yyyy"</span>,)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>df.explo <span class="op">=</span> <span class="fu">first</span>.(df.plotID)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>median_temp <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span> .!<span class="fu">ismissing</span>.(<span class="op">:</span>Ta_200)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">groupby</span>(_, [<span class="op">:</span>explo, <span class="op">:</span>datetime])</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@combine</span> <span class="op">:</span>median_Ta_200 <span class="op">=</span> <span class="fu">median</span>(<span class="op">:</span>Ta_200)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>df_sub <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leftjoin</span>(_, median_temp, on <span class="op">=</span> [<span class="op">:</span>explo, <span class="op">:</span>datetime])</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rtransform</span> <span class="op">:</span>precipitation <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>P_RT_NRT) ? <span class="op">:</span>precipitation_radolan <span class="op">:</span> <span class="op">:</span>P_RT_NRT</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">## just for the day 2020-02-06</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rtransform</span> <span class="op">:</span>precipitation <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>precipitation) ? <span class="fl">0.0</span> <span class="op">:</span> <span class="op">:</span>precipitation</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rtransform</span> <span class="op">:</span>Ta_200 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>Ta_200) ? <span class="op">:</span>median_Ta_200 <span class="op">:</span> <span class="op">:</span>Ta_200</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>date <span class="op">=</span> <span class="op">:</span>datetime</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>temperature <span class="op">=</span> <span class="op">:</span>Ta_200</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="cf">begin</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>year <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">year</span>.(<span class="op">:</span>date)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>doy <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">dayofyear</span>.(<span class="op">:</span>date)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>temperature <span class="op">=</span> <span class="fu">round</span>.(<span class="op">:</span>temperature, digits <span class="op">=</span> <span class="fl">1</span>)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>precipitation <span class="op">=</span> <span class="fu">round</span>.(<span class="op">:</span>precipitation, digits <span class="op">=</span> <span class="fl">1</span>)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span> <span class="fl">2009</span> <span class="op">.&lt;=</span> <span class="op">:</span>year <span class="op">.&lt;=</span> <span class="fl">2022</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@orderby</span> <span class="op">:</span>date</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@select</span>(<span class="op">:</span>plotID, <span class="op">:</span>date, <span class="op">:</span>year, <span class="op">:</span>doy, <span class="op">:</span>temperature, <span class="op">:</span>precipitation)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="fu">disallowmissing!</span>(df_sub)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co">## values look plausible!</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="co"># using CairoMakie</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="co"># display(hist(df_sub.temperature; bins=100))</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="co"># display(hist(df_sub.soiltemperature; bins=100))</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="co"># display(hist(df_sub.precipitation; bins=100))</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="co"># move file to assets/data/input</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(<span class="st">"temperature_precipitation.csv"</span>, df_sub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Estimates of the photosynthetically active radiation (PAR) are available with a three hours resolution. A quadratic regression was fitted to the data and used to estimate the daily sum of PAR. The daily PAR equals the area under the quadratic regression curve. The spatial resolution of the gridded data set is not high enough to describes differences on the plot level, therefore the daily PAR values were calculated per region (Exploratories: Schorfheide-Chorin, Hainich, Schwäbische Alb).</p>
<div class="callout callout-style-default callout-note callout-titled" title="Details on deriving the PAR">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Details on deriving the PAR
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A quadratic regression was fitted to the data with the following script:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>par.jl</strong></pre>
</div>
<div class="sourceCode" id="cb11" data-filename="par.jl"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">DataFramesMeta</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Polynomials</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">CSV</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">Dates</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">PAR_data</span>(path; startyear <span class="op">=</span> <span class="fl">2006</span>, endyear <span class="op">=</span> <span class="fl">2022</span>, show_plot <span class="op">=</span> <span class="cn">false</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    df_input <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span> <span class="st">"PAR_2006_2022.csv"</span>, DataFrame; missingstring <span class="op">=</span> <span class="st">"-1"</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@select</span>! df_input <span class="op">$</span>(<span class="st">r"^PAR"</span>) <span class="op">:</span>plot_id <span class="op">:</span>date</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="pp">@chain</span> df_input <span class="cf">begin</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>PAR <span class="op">=</span> <span class="fu">daily_PAR_sum</span>(df_input; show_plot)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="op">:</span>explo <span class="op">=</span> <span class="op">:</span>plot_id</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>date <span class="op">:</span>explo <span class="op">:</span>PAR</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    date_range <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">Date</span>(startyear)<span class="op">:</span><span class="bu">Dates</span>.<span class="fu">lastdayofyear</span>(<span class="bu">Dates</span>.<span class="fu">Date</span>(endyear))</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    df_prep <span class="op">=</span> <span class="fu">DataFrame</span>(date <span class="op">=</span> <span class="fu">repeat</span>(date_range, <span class="fl">3</span>),</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        explo <span class="op">=</span> <span class="fu">repeat</span>([<span class="st">"HAI"</span>, <span class="st">"ALB"</span>, <span class="st">"SCH"</span>], inner <span class="op">=</span> <span class="fu">length</span>(date_range)))</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    df_prep.doy <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">dayofyear</span>.(df_prep.date)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    df_prep.year <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">year</span>.(df_prep.date)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    df_final <span class="op">=</span> <span class="fu">leftjoin</span>(df_prep, df, on <span class="op">=</span> [<span class="op">:</span>date, <span class="op">:</span>explo])</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    df_median <span class="op">=</span> <span class="pp">@chain</span> df_final <span class="cf">begin</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> .!<span class="fu">ismissing</span>.(<span class="op">:</span>PAR)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">groupby</span>(_, <span class="op">:</span>doy)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@combine</span> <span class="op">:</span>PAR_median <span class="op">=</span> <span class="fu">median</span>(<span class="op">:</span>PAR)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="pp">@chain</span> df_final <span class="cf">begin</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">leftjoin</span>(_, df_median, on <span class="op">=</span> <span class="op">:</span>doy)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>PAR <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>PAR) ? <span class="op">:</span>PAR_median <span class="op">:</span> <span class="op">:</span>PAR</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>PAR <span class="op">=</span> <span class="fu">uconvert</span>.(u<span class="st">"MJ / ha / d"</span>, <span class="op">:</span>PAR)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>PAR <span class="op">=</span> <span class="fu">convert</span>.(<span class="dt">Int64</span>, <span class="fu">round</span>.(<span class="fu">ustrip</span>.(<span class="op">:</span>PAR), digits <span class="op">=</span> <span class="fl">0</span>))</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>year <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">year</span>.(<span class="op">:</span>date)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>date</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>date <span class="op">:</span>year <span class="op">:</span>explo <span class="op">:</span>PAR</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    CSV.<span class="fu">write</span>(<span class="st">"par.csv"</span>, df)</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">daily_PAR_sum</span>(df; show_plot)</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>    PAR_sum <span class="op">=</span> Quantity{<span class="dt">Float64</span>}[]</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">nrow</span>(df)</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> show_plot</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>            <span class="fu">plot_par_sum_approximation</span>(df, n)</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>        area <span class="op">=</span> <span class="fu">area_under_curve</span>(<span class="fu">Array</span>(df[n, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>]))</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(PAR_sum, area)</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> PAR_sum</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">area_under_curve</span>(PAR_measures; return_polygon <span class="op">=</span> <span class="cn">false</span>)</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>    hours <span class="op">=</span> <span class="fu">collect</span>(<span class="fl">0</span><span class="op">:</span><span class="fl">3.0</span><span class="op">:</span><span class="fl">21</span>)</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>    number_positive <span class="op">=</span> PAR_measures <span class="op">.&gt;</span> <span class="fl">0</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>    left_no_par <span class="op">=</span> <span class="fu">findfirst</span>(PAR_measures <span class="op">.!=</span> <span class="fl">0</span>) <span class="op">-</span><span class="fl">1</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>    right_no_par <span class="op">=</span> <span class="fu">findfirst</span>(PAR_measures[<span class="fl">4</span><span class="op">:</span><span class="kw">end</span>] <span class="op">.==</span> <span class="fl">0</span>) <span class="op">+</span> <span class="fl">3</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>    f <span class="op">=</span> left_no_par<span class="op">:</span>right_no_par</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> Polynomials.<span class="fu">fit</span>(hours[f], PAR_measures[f], <span class="fl">2</span>)</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>    <span class="co">##### Integral</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>    roots_par <span class="op">=</span> <span class="fu">roots</span>(p)</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> <span class="fu">integrate</span>(p)</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>    F_a <span class="op">=</span> <span class="fu">p1</span>(roots_par[<span class="fl">1</span>])</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>    F_b <span class="op">=</span> <span class="fu">p1</span>(roots_par[<span class="fl">2</span>])</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>    area <span class="op">=</span> (F_b <span class="op">-</span> F_a) <span class="op">/</span> <span class="fl">1e6</span> <span class="op">*</span> <span class="fl">60</span><span class="op">^</span><span class="fl">2</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>    <span class="co">##### 2nd option: Riemann sum, 1 s -&gt; polynomial interpolation</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># tpoints = uconvert.(u"hr", collect(1.0:60*60*24) * u"s") / u"hr"</span></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># polygon_y = p.(tpoints)</span></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># area1 = sum(polygon_y[polygon_y .&gt; 0]) / 1e6</span></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>    <span class="co">##### 3rd option: Riemann sum 3 hours -&gt; no interpolation</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># manual_m = sum(PAR_measures .* 10800) / 1e6</span></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> return_polygon</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> p</span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> area <span class="op">.*</span> u<span class="st">"MJ / m^2 / d"</span></span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_par_sum_approximation</span>(df, n)</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>    hours <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">:</span><span class="fl">21</span></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>    PAR_measures <span class="op">=</span> <span class="fu">Array</span>(df[n, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>])</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>    orig_measures <span class="op">=</span> <span class="fu">copy</span>(PAR_measures)</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">area_under_curve</span>(PAR_measures;</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>        return_polygon <span class="op">=</span> <span class="cn">true</span>)</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>])</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> <span class="fu">collect</span>(<span class="fl">0</span><span class="op">:</span><span class="fl">0.001</span><span class="op">:</span><span class="fl">24</span>)</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> <span class="fu">p</span>.(t)</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>    pred_filter <span class="op">=</span> pred <span class="op">.&gt;</span> <span class="fl">0</span></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(t[pred_filter], pred[pred_filter])</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">band!</span>(t[pred_filter], <span class="fl">0</span>, pred[pred_filter];</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> (<span class="op">:</span>blue, <span class="fl">0.2</span>))</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scatter!</span>(hours, orig_measures;</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>        markersize <span class="op">=</span> <span class="fl">15</span>,</span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="op">:</span>coral3)</span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">display</span>(fig)</span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cn">nothing</span></span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> <span class="st">"../data/"</span></span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move file to /assets/data/input</span></span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">PAR_data</span>(path)</span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The potential evapotranspiration (PET) values were estimated by the agrometeorological model AMBAV, the VPGB variable (“potential evapotranspiration over gras”) is used here. Estimates of PET are available for different weather stations in Germany. The closest weather station of each Exploratory was chosen to get the daily PET values.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Details on loading PET">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Details on loading PET
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The data was processed with the following script:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> CSV<span class="op">,</span> Dates</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>using DataFrames<span class="op">,</span> DataFramesMeta</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">load_soil</span>(path)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    # https<span class="op">:</span><span class="co">//opendata.dwd.de/climate_environment/CDC/derived_germany/soil/daily/historical/</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    # <span class="dv">164</span> <span class="op">-</span> Angermünde <span class="op">=</span> SCH</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    # <span class="dv">3402</span> <span class="op">-</span> Münsingen<span class="op">-</span>Apfelstetten <span class="op">=</span> ALB</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    # <span class="dv">6305</span> <span class="op">-</span> Mühlhausen <span class="op">=</span> HAI</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    # VPGB <span class="op">-</span> potential evapotranspiration over <span class="fu">gras</span> (AMBAV)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    # BF10 <span class="op">-</span> soil moisture under grass and sandy loam</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    #        between <span class="dv">0</span> and <span class="dv">10</span> cm depth <span class="kw">in</span> <span class="op">%</span> plant useable water</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    # BFGSL <span class="op">-</span> soil mosture under grass and sandy loam up to <span class="dv">60</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    #         cm <span class="fu">depth</span> (AMBAV)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    fs <span class="op">=</span> [</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pet_164.txt.gz"</span><span class="op">,</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pet_3402.txt.gz"</span><span class="op">,</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pet_6305.txt.gz"</span><span class="op">,</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    station <span class="op">=</span> [</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Angermünde"</span><span class="op">,</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Münsingen-Apfelstetten"</span><span class="op">,</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Eisenach"</span><span class="op">,</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    explo <span class="op">=</span> [<span class="st">"SCH"</span><span class="op">,</span> <span class="st">"ALB"</span><span class="op">,</span> <span class="st">"HAI"</span>]</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    final_df <span class="op">=</span> <span class="fu">DataFrame</span>()</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="fu">joinpath</span>(path<span class="op">,</span> fs[i])</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> CSV<span class="op">.</span><span class="fu">read</span>(p<span class="op">,</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>            DataFrame<span class="op">;</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>            dateformat <span class="op">=</span> <span class="st">"yyyymmdd"</span><span class="op">,</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>            types <span class="op">=</span> <span class="fu">Dict</span>(<span class="op">:</span>Datum <span class="kw">=&gt;</span> Dates<span class="op">.</span><span class="at">Date</span>))</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>        df_transformed <span class="op">=</span> @chain df begin</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>                               @<span class="fu">select</span>(<span class="op">:</span>Stationsindex<span class="op">,</span> <span class="op">:</span>Datum<span class="op">,</span> <span class="op">:</span>VPGB<span class="op">,</span> <span class="op">:</span>BF10<span class="op">,</span> <span class="op">:</span>BFGSL)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>                               @<span class="fu">transform</span>(</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">:</span>weather_station<span class="op">=</span>station[i]<span class="op">,</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">:</span>doy<span class="op">=</span>Dates<span class="op">.</span><span class="at">dayofyear</span><span class="op">.</span>(<span class="op">:</span>Datum)<span class="op">,</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">:</span>year<span class="op">=</span>Dates<span class="op">.</span><span class="at">year</span><span class="op">.</span>(<span class="op">:</span>Datum)<span class="op">,</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">:</span>explo<span class="op">=</span>explo[i])</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>                               @<span class="fu">select</span>(</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">:</span>explo<span class="op">,</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">:</span>weather_station<span class="op">,</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">:</span>weather_station_index<span class="op">=:</span>Stationsindex<span class="op">,</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">:</span>date<span class="op">=:</span>Datum<span class="op">,</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">:</span>year<span class="op">,</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">:</span>doy<span class="op">,</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">:</span>VPGB<span class="op">,</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">:</span>BF10<span class="op">,</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">:</span>BFGSL)</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>        end</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>        final_df <span class="op">=</span> <span class="fu">vcat</span>(final_df<span class="op">,</span> df_transformed)</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>    end</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> final_df</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>end</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">load_PET_input</span>(path<span class="op">;</span> years)</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="fu">load_soil</span>(path)</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>    @chain df begin</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>        @subset <span class="op">:</span>year <span class="op">.</span><span class="at">∈</span> <span class="fu">Ref</span>(years)</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>        @rename <span class="op">:</span>PET <span class="op">=</span> <span class="op">:</span>VPGB</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>        @select <span class="op">:</span>explo <span class="op">:</span>date <span class="op">:</span>year <span class="op">:</span>PET</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>        @orderby <span class="op">:</span>date</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>    end</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>end</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>data_path <span class="op">=</span> <span class="st">"../data/"</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a><span class="fu">load_PET_input</span>(data_path<span class="op">;</span> years <span class="op">=</span> <span class="dv">2006</span><span class="op">:</span><span class="dv">2022</span>) <span class="op">|&gt;</span> CSV<span class="op">.</span><span class="fu">write</span>(<span class="st">"pet.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
<th>data source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>temperature[t, plot]</code></td>
<td>Temperature [°C]</td>
<td><span class="citation" data-cites="explo19007v6">Wöllauer et al. (<a href="#ref-explo19007v6" role="doc-biblioref">2023</a>)</span></td>
</tr>
<tr class="even">
<td><code>precipitation[t, plot]</code></td>
<td>Precipitation [mm d⁻¹]</td>
<td><span class="citation" data-cites="explo19007v6">Wöllauer et al. (<a href="#ref-explo19007v6" role="doc-biblioref">2023</a>)</span></td>
</tr>
<tr class="odd">
<td><code>PAR[t, region]</code></td>
<td>Photosynthetically active radiation [MJ ha⁻¹ d⁻¹]</td>
<td><span class="citation" data-cites="PARdata">Wang (<a href="#ref-PARdata" role="doc-biblioref">2021</a>)</span></td>
</tr>
<tr class="even">
<td><code>PET[t, region]</code></td>
<td>Potential evapotranspiration [mm d⁻¹]</td>
<td><span class="citation" data-cites="PETdata">DWD Climate Data Center (<a href="#ref-PETdata" role="doc-biblioref">2019</a>)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="daily-management-variables" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="daily-management-variables"><span class="header-section-number">2.3</span> Daily management variables</h3>
<p>The management data was downloaded from BExIS and the mowing and grazing events were extracted. Exact dates were avaible for mowing. For grazing, only the start month, grazing intensity and the number of days grazed were available.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Details on mowing">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Details on mowing
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The mowing data was processed with the following script:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFramesMeta</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">CSV</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">Dates</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">convert_id</span>(id)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="fu">first</span>.(id, <span class="fl">3</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">chop</span>(id, head<span class="op">=</span><span class="fl">3</span>, tail<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">lpad</span>(b, <span class="fl">2</span>, <span class="st">"0"</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> b</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">isdate</span>(x)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">ismissing</span>(x)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cn">false</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">isnothing</span>(<span class="fu">tryparse</span>(<span class="bu">Dates</span>.<span class="dt">Date</span>, x, <span class="bu">Dates</span>.dateformat<span class="st">"yyy-mm-dd"</span>)) ? <span class="cn">false</span> <span class="op">:</span> <span class="cn">true</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">load_mowing</span>(path)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    lui_df <span class="op">=</span> CSV.<span class="fu">read</span>(</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        path <span class="op">*</span> <span class="st">"LUI_tool_input.csv"</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        DataFrame)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> CSV.<span class="fu">read</span>(</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>        path <span class="op">*</span> <span class="st">"management_input.csv"</span>,</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>        DataFrame;</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>        missingstring<span class="op">=</span>[<span class="st">""</span>, <span class="st">"NA"</span>]);</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="fu">mapcols</span>(col <span class="op">-&gt;</span> <span class="fu">replace</span>(col, <span class="st">"-1"</span> <span class="op">=&gt;</span> <span class="cn">missing</span>), df)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="fu">mapcols</span>(col <span class="op">-&gt;</span> <span class="fu">replace</span>(col, <span class="op">-</span><span class="fl">1</span> <span class="op">=&gt;</span> <span class="cn">missing</span>), df)</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    mowing_df <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span>(<span class="op">:</span>Year, <span class="op">:</span>EP_PlotID,</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">$</span>(<span class="st">r"DateCut"</span>), <span class="op">$</span>(<span class="st">r"CutHeight_cm"</span>))</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">innerjoin</span>(<span class="pp">@select</span>(lui_df, <span class="op">:</span>Year, <span class="op">:</span>EP_PlotID, <span class="op">:</span>TotalMowing),</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>            _,</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>            on <span class="op">=</span> [<span class="op">:</span>Year, <span class="op">:</span>EP_PlotID])</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sort</span>(<span class="op">:</span>EP_PlotID)</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">disallowmissing!</span>(<span class="op">:</span>Year)</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>        mowing_df[<span class="op">:</span>, <span class="st">"MowingDay</span><span class="sc">$</span>i<span class="st">"</span>] <span class="op">=</span> <span class="fu">Array</span><span class="dt">{Union{Missing, Int64}}</span>(<span class="cn">missing</span>, <span class="fu">nrow</span>(mowing_df))</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>        mowing_filter <span class="op">=</span> <span class="fu">isdate</span>.(mowing_df[<span class="op">:</span>, <span class="st">"DateCut</span><span class="sc">$</span>i<span class="st">"</span>])</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>        mowing_dates <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">Date</span>.(mowing_df[mowing_filter, <span class="st">"DateCut</span><span class="sc">$</span>i<span class="st">"</span>])</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>        mowing_df[mowing_filter, <span class="st">"MowingDay</span><span class="sc">$</span>i<span class="st">"</span>] <span class="op">.=</span> <span class="bu">Dates</span>.<span class="fu">dayofyear</span>.(mowing_dates)</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>        heights <span class="op">=</span> <span class="fu">copy</span>(mowing_df[<span class="op">:</span> ,<span class="st">"CutHeight_cm</span><span class="sc">$</span>i<span class="st">"</span>])</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>        heights <span class="op">=</span> <span class="fu">convert</span>(<span class="dt">Vector</span>{<span class="dt">Union</span>{<span class="dt">Missing</span>, <span class="dt">Float64</span>}}, heights)</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>        f1 <span class="op">=</span> .! <span class="fu">ismissing</span>.(heights) <span class="op">.&amp;&amp;</span> heights <span class="op">.&lt;</span> <span class="fl">3.0</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>        heights[f1] <span class="op">.=</span> <span class="cn">missing</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>        f2 <span class="op">=</span> <span class="fu">ismissing</span>.(heights) <span class="op">.&amp;&amp;</span> mowing_filter</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>        heights[f2] <span class="op">.=</span> <span class="fl">7.5</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>        mowing_df[!, <span class="st">"CutHeight_cm</span><span class="sc">$</span>i<span class="st">"</span>] <span class="op">=</span> heights</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@select</span>! mowing_df <span class="op">$</span>(<span class="fu">Not</span>(<span class="st">r"DateCut"</span>))</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>    mowing_validation <span class="op">=</span> <span class="pp">@chain</span> mowing_df <span class="cf">begin</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>EP_PlotID <span class="op">=</span> <span class="fu">convert_id</span>.(<span class="op">:</span>EP_PlotID)</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>plotID <span class="op">=</span> <span class="op">:</span>EP_PlotID</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>year <span class="op">=</span> <span class="op">:</span>Year</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>year</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mowing_validation</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> <span class="fu">load_mowing</span>(<span class="st">"../data/"</span>)</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a><span class="co"># move to GrasslandTraitSim/assets/data/input/</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(<span class="st">"mowing.csv"</span>, df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Details on grazing">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Details on grazing
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The grazing data was processed with the following script:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFramesMeta</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">CSV</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">Dates</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">convert_id</span>(id)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="fu">first</span>.(id, <span class="fl">3</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">chop</span>(id, head<span class="op">=</span><span class="fl">3</span>, tail<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">lpad</span>(b, <span class="fl">2</span>, <span class="st">"0"</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> b</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">convert_month</span>(str)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">ismissing</span>(str)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cn">missing</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    month_strs <span class="op">=</span> [</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Januar"</span>, <span class="st">"Februar"</span>, <span class="st">"Maerz"</span>, <span class="st">"April"</span>, <span class="st">"Mai"</span>, <span class="st">"Juni"</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Juli"</span>, <span class="st">"August"</span>, <span class="st">"September"</span>, <span class="st">"Oktober"</span>, <span class="st">"November"</span>, <span class="st">"Dezember"</span>]</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">findfirst</span>(str <span class="op">.==</span> month_strs)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">supplementary_feeding</span>(path)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># supplementary_feeding.csv was created from https://www.bexis.uni-jena.de/ddm/data/Showdata/26487</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> CSV.<span class="fu">read</span>(</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>        path <span class="op">*</span> <span class="st">"supplementary_feeding.csv"</span>,</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>        DataFrame)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rename</span>! df <span class="op">:</span>plotID <span class="op">=</span> <span class="op">:</span>EP_PlotID</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rename</span>! df <span class="op">:</span>year <span class="op">=</span> <span class="op">:</span>Year</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    df_summarized <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@groupby</span> <span class="op">:</span>plotID</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@combine</span> <span class="op">:</span>supplementary_feeding <span class="op">=</span> <span class="fu">any</span>(<span class="op">:</span>SupplementaryFeeding)</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df, df_summarized</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">load_grazing</span>(path)</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>    lui_df <span class="op">=</span> CSV.<span class="fu">read</span>(</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>        path <span class="op">*</span> <span class="st">"LUI_tool_input.csv"</span>,</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>        DataFrame)</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> CSV.<span class="fu">read</span>(</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>        path <span class="op">*</span> <span class="st">"management_input.csv"</span>,</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>        DataFrame;</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>        missingstring<span class="op">=</span>[<span class="st">""</span>, <span class="st">"NA"</span>]);</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="fu">mapcols</span>(col <span class="op">-&gt;</span> <span class="fu">replace</span>(col, <span class="st">"-1"</span> <span class="op">=&gt;</span> <span class="cn">missing</span>), df)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="fu">mapcols</span>(col <span class="op">-&gt;</span> <span class="fu">replace</span>(col, <span class="op">-</span><span class="fl">1</span> <span class="op">=&gt;</span> <span class="cn">missing</span>), df)</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="fu">mapcols</span>(col <span class="op">-&gt;</span> <span class="fu">replace</span>(col, <span class="st">"ja"</span> <span class="op">=&gt;</span> <span class="cn">true</span>), df)</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="fu">mapcols</span>(col <span class="op">-&gt;</span> <span class="fu">replace</span>(col, <span class="st">"nein"</span> <span class="op">=&gt;</span> <span class="cn">false</span>), df)</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    selected_columns <span class="op">=</span> [</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>Year, <span class="op">:</span>EP_PlotID, <span class="op">:</span>SizeManagementUnit,</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>AllYearGrazing, <span class="op">:</span>StartGrazing, <span class="op">:</span>GrazingType,</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>StartGrazingPeriod1,</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>StartGrazingPeriod2,</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>StartGrazingPeriod3,</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>StartGrazingPeriod4,</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>LivestockUnits1, <span class="op">:</span>DayGrazing1, <span class="op">:</span>GrazingArea1,</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>LivestockUnits2, <span class="op">:</span>DayGrazing2, <span class="op">:</span>GrazingArea2,</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>LivestockUnits3, <span class="op">:</span>DayGrazing3, <span class="op">:</span>GrazingArea3,</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>LivestockUnits4, <span class="op">:</span>DayGrazing4, <span class="op">:</span>GrazingArea4,</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>    col_filter <span class="op">=</span> <span class="fu">Symbol</span>.(<span class="fu">names</span>(df)) <span class="op">.∈</span> <span class="fu">Ref</span>(selected_columns)</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[!, col_filter]</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>    df.AllYearGrazing[<span class="fu">ismissing</span>.(df.AllYearGrazing)] <span class="op">.=</span> <span class="cn">false</span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>    df.GrazingType[<span class="fu">ismissing</span>.(df.GrazingType)] <span class="op">.=</span> <span class="st">""</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>    <span class="co">## 2020: AEG09 grazing of period 1 was written to grazing period 2</span></span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>    df[<span class="fu">findall</span>(df.Year <span class="op">.==</span> <span class="fl">2020</span> <span class="op">.&amp;&amp;</span> df.EP_PlotID <span class="op">.==</span> <span class="st">"AEG9"</span>), <span class="op">:</span>StartGrazingPeriod1] <span class="op">.=</span> <span class="st">"Mai"</span></span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>    df[<span class="fu">findall</span>(df.Year <span class="op">.==</span> <span class="fl">2020</span> <span class="op">.&amp;&amp;</span> df.EP_PlotID <span class="op">.==</span> <span class="st">"AEG9"</span>), <span class="op">:</span>DayGrazing1] <span class="op">.=</span> <span class="fl">15</span></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>    df[<span class="fu">findall</span>(df.Year <span class="op">.==</span> <span class="fl">2020</span> <span class="op">.&amp;&amp;</span> df.EP_PlotID <span class="op">.==</span> <span class="st">"AEG9"</span>), <span class="op">:</span>LivestockUnits1] <span class="op">.=</span> <span class="fl">70</span></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>    df[<span class="fu">findall</span>(df.Year <span class="op">.==</span> <span class="fl">2020</span> <span class="op">.&amp;&amp;</span> df.EP_PlotID <span class="op">.==</span> <span class="st">"AEG9"</span>), <span class="op">:</span>StartGrazingPeriod2] <span class="op">.=</span> <span class="cn">missing</span></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>    df[<span class="fu">findall</span>(df.Year <span class="op">.==</span> <span class="fl">2020</span> <span class="op">.&amp;&amp;</span> df.EP_PlotID <span class="op">.==</span> <span class="st">"AEG9"</span>), <span class="op">:</span>DayGrazing2] <span class="op">.=</span> <span class="cn">missing</span></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>    df[<span class="fu">findall</span>(df.Year <span class="op">.==</span> <span class="fl">2020</span> <span class="op">.&amp;&amp;</span> df.EP_PlotID <span class="op">.==</span> <span class="st">"AEG9"</span>), <span class="op">:</span>LivestockUnits2] <span class="op">.=</span> <span class="cn">missing</span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>        <span class="fu">innerjoin</span>(<span class="pp">@select</span>(lui_df, <span class="op">:</span>Year, <span class="op">:</span>EP_PlotID, <span class="op">:</span>TotalGrazing), _,</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>                  on <span class="op">=</span> [<span class="op">:</span>Year, <span class="op">:</span>EP_PlotID])</span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>EP_PlotID <span class="op">=</span> <span class="fu">convert_id</span>(<span class="op">:</span>EP_PlotID)</span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>Year <span class="op">:</span>EP_PlotID</span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="cf">begin</span></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>DayGrazing1 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>DayGrazing1) ? <span class="fl">0</span> <span class="op">:</span> <span class="op">:</span>DayGrazing1</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>DayGrazing2 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>DayGrazing2) ? <span class="fl">0</span> <span class="op">:</span> <span class="op">:</span>DayGrazing2</span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>DayGrazing3 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>DayGrazing3) ? <span class="fl">0</span> <span class="op">:</span> <span class="op">:</span>DayGrazing3</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>DayGrazing4 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>DayGrazing4) ? <span class="fl">0</span> <span class="op">:</span> <span class="op">:</span>DayGrazing4</span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>LivestockUnits1 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>LivestockUnits1) ? <span class="fl">0</span> <span class="op">:</span> <span class="op">:</span>LivestockUnits1</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>LivestockUnits2 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>LivestockUnits2) ? <span class="fl">0</span> <span class="op">:</span> <span class="op">:</span>LivestockUnits2</span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>LivestockUnits3 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>LivestockUnits3) ? <span class="fl">0</span> <span class="op">:</span> <span class="op">:</span>LivestockUnits3</span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>LivestockUnits4 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>LivestockUnits4) ? <span class="fl">0</span> <span class="op">:</span> <span class="op">:</span>LivestockUnits4</span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>GrazingArea1 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>GrazingArea1) ? <span class="op">:</span>SizeManagementUnit <span class="op">:</span> <span class="op">:</span>GrazingArea1</span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>GrazingArea2 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>GrazingArea2) ? <span class="op">:</span>SizeManagementUnit <span class="op">:</span> <span class="op">:</span>GrazingArea2</span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>GrazingArea3 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>GrazingArea3) ? <span class="op">:</span>SizeManagementUnit <span class="op">:</span> <span class="op">:</span>GrazingArea3</span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>GrazingArea4 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>GrazingArea4) ? <span class="op">:</span>SizeManagementUnit <span class="op">:</span> <span class="op">:</span>GrazingArea4</span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="cf">begin</span></span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>GrazingArea1 <span class="op">=</span> <span class="fu">iszero</span>(<span class="op">:</span>GrazingArea1) ? <span class="op">:</span>SizeManagementUnit <span class="op">:</span> <span class="op">:</span>GrazingArea1</span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>GrazingArea2 <span class="op">=</span> <span class="fu">iszero</span>(<span class="op">:</span>GrazingArea2) ? <span class="op">:</span>SizeManagementUnit <span class="op">:</span> <span class="op">:</span>GrazingArea2</span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>GrazingArea3 <span class="op">=</span> <span class="fu">iszero</span>(<span class="op">:</span>GrazingArea3) ? <span class="op">:</span>SizeManagementUnit <span class="op">:</span> <span class="op">:</span>GrazingArea3</span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>GrazingArea4 <span class="op">=</span> <span class="fu">iszero</span>(<span class="op">:</span>GrazingArea4) ? <span class="op">:</span>SizeManagementUnit <span class="op">:</span> <span class="op">:</span>GrazingArea4</span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="cf">begin</span></span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>inten_graz1 <span class="op">=</span> <span class="op">:</span>DayGrazing1 <span class="op">*</span> <span class="op">:</span>LivestockUnits1 <span class="op">/</span> <span class="op">:</span>GrazingArea1</span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>inten_graz2 <span class="op">=</span> <span class="op">:</span>DayGrazing2 <span class="op">*</span> <span class="op">:</span>LivestockUnits2 <span class="op">/</span> <span class="op">:</span>GrazingArea2</span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>inten_graz3 <span class="op">=</span> <span class="op">:</span>DayGrazing3 <span class="op">*</span> <span class="op">:</span>LivestockUnits3 <span class="op">/</span> <span class="op">:</span>GrazingArea3</span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>inten_graz4 <span class="op">=</span> <span class="op">:</span>DayGrazing4 <span class="op">*</span> <span class="op">:</span>LivestockUnits4 <span class="op">/</span> <span class="op">:</span>GrazingArea4</span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>intens_total <span class="op">=</span> <span class="op">:</span>inten_graz1 <span class="op">+</span> <span class="op">:</span>inten_graz2 <span class="op">+</span> <span class="op">:</span>inten_graz3 <span class="op">+</span> <span class="op">:</span>inten_graz4</span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="cf">begin</span></span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>isgrazed1 <span class="op">=</span> <span class="op">:</span>inten_graz1 <span class="op">&gt;</span> <span class="fl">0.0</span></span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>isgrazed2 <span class="op">=</span> <span class="op">:</span>inten_graz2 <span class="op">&gt;</span> <span class="fl">0.0</span></span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>isgrazed3 <span class="op">=</span> <span class="op">:</span>inten_graz3 <span class="op">&gt;</span> <span class="fl">0.0</span></span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>isgrazed4 <span class="op">=</span> <span class="op">:</span>inten_graz4 <span class="op">&gt;</span> <span class="fl">0.0</span></span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a>        <span class="co">## on some rows the start of the first grazing period was missing</span></span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a>        <span class="co">## set to the start of the start of the overall grazing period</span></span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>StartGrazingPeriod1 <span class="op">=</span></span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ismissing</span>(<span class="op">:</span>StartGrazingPeriod1) ? <span class="op">:</span>StartGrazing <span class="op">:</span> <span class="op">:</span>StartGrazingPeriod1</span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="cf">begin</span></span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>StartGrazingPeriod1 <span class="op">=</span> <span class="fu">convert_month</span>(<span class="op">:</span>StartGrazingPeriod1)</span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>StartGrazingPeriod2 <span class="op">=</span> <span class="fu">convert_month</span>(<span class="op">:</span>StartGrazingPeriod2)</span>
<span id="cb14-136"><a href="#cb14-136" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>StartGrazingPeriod3 <span class="op">=</span> <span class="fu">convert_month</span>(<span class="op">:</span>StartGrazingPeriod3)</span>
<span id="cb14-137"><a href="#cb14-137" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>StartGrazingPeriod4 <span class="op">=</span> <span class="fu">convert_month</span>(<span class="op">:</span>StartGrazingPeriod4)</span>
<span id="cb14-138"><a href="#cb14-138" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb14-139"><a href="#cb14-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-140"><a href="#cb14-140" aria-hidden="true" tabindex="-1"></a>        <span class="co">## allyear grazing on dauerweide starts in january</span></span>
<span id="cb14-141"><a href="#cb14-141" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>StartGrazingPeriod1 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>StartGrazingPeriod1) <span class="op">&amp;&amp;</span></span>
<span id="cb14-142"><a href="#cb14-142" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>AllYearGrazing  <span class="op">&amp;&amp;</span> <span class="fu">startswith</span>(<span class="op">:</span>GrazingType, <span class="st">"Dauerweide"</span>) ?</span>
<span id="cb14-143"><a href="#cb14-143" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1</span> <span class="op">:</span> <span class="op">:</span>StartGrazingPeriod1</span>
<span id="cb14-144"><a href="#cb14-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-145"><a href="#cb14-145" aria-hidden="true" tabindex="-1"></a>        <span class="co">## for 16 rows (one row = one year of one site) the start of grazing was missing</span></span>
<span id="cb14-146"><a href="#cb14-146" aria-hidden="true" tabindex="-1"></a>        <span class="co">## set to june</span></span>
<span id="cb14-147"><a href="#cb14-147" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>StartGrazingPeriod1 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>StartGrazingPeriod1) ?</span>
<span id="cb14-148"><a href="#cb14-148" aria-hidden="true" tabindex="-1"></a>            <span class="fl">6</span> <span class="op">:</span> <span class="op">:</span>StartGrazingPeriod1</span>
<span id="cb14-149"><a href="#cb14-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-150"><a href="#cb14-150" aria-hidden="true" tabindex="-1"></a>        <span class="co">## for 8 rows the start of the second grazing period was missing</span></span>
<span id="cb14-151"><a href="#cb14-151" aria-hidden="true" tabindex="-1"></a>        <span class="co">## set to start of first grazing period + one month</span></span>
<span id="cb14-152"><a href="#cb14-152" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>StartGrazingPeriod2 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>StartGrazingPeriod2) <span class="op">&amp;&amp;</span></span>
<span id="cb14-153"><a href="#cb14-153" aria-hidden="true" tabindex="-1"></a>            !<span class="fu">iszero</span>(<span class="op">:</span>DayGrazing2) <span class="op">&amp;&amp;</span> !<span class="fu">iszero</span>(<span class="op">:</span>LivestockUnits2) ?</span>
<span id="cb14-154"><a href="#cb14-154" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>StartGrazingPeriod1 <span class="op">+</span> <span class="fl">1</span> <span class="op">:</span> <span class="op">:</span>StartGrazingPeriod2</span>
<span id="cb14-155"><a href="#cb14-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-156"><a href="#cb14-156" aria-hidden="true" tabindex="-1"></a>        <span class="co">## for 2 rows the start of the third grazing period was missing</span></span>
<span id="cb14-157"><a href="#cb14-157" aria-hidden="true" tabindex="-1"></a>        <span class="co">## set to start of second grazing period + one month (= July &amp; November)</span></span>
<span id="cb14-158"><a href="#cb14-158" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>StartGrazingPeriod3 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>StartGrazingPeriod3) <span class="op">&amp;&amp;</span></span>
<span id="cb14-159"><a href="#cb14-159" aria-hidden="true" tabindex="-1"></a>            !<span class="fu">iszero</span>(<span class="op">:</span>DayGrazing3) <span class="op">&amp;&amp;</span> !<span class="fu">iszero</span>(<span class="op">:</span>LivestockUnits3) ?</span>
<span id="cb14-160"><a href="#cb14-160" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>StartGrazingPeriod2 <span class="op">+</span> <span class="fl">1</span> <span class="op">:</span> <span class="op">:</span>StartGrazingPeriod3</span>
<span id="cb14-161"><a href="#cb14-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-162"><a href="#cb14-162" aria-hidden="true" tabindex="-1"></a>        <span class="co">## for 1 row the start of the fourth grazing period was missing</span></span>
<span id="cb14-163"><a href="#cb14-163" aria-hidden="true" tabindex="-1"></a>        <span class="co">## set to start of third grazing period + one month (= November)</span></span>
<span id="cb14-164"><a href="#cb14-164" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>StartGrazingPeriod4 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>StartGrazingPeriod4) <span class="op">&amp;&amp;</span></span>
<span id="cb14-165"><a href="#cb14-165" aria-hidden="true" tabindex="-1"></a>            !<span class="fu">iszero</span>(<span class="op">:</span>DayGrazing4) <span class="op">&amp;&amp;</span> !<span class="fu">iszero</span>(<span class="op">:</span>LivestockUnits4) ?</span>
<span id="cb14-166"><a href="#cb14-166" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>StartGrazingPeriod3 <span class="op">+</span> <span class="fl">1</span> <span class="op">:</span> <span class="op">:</span>StartGrazingPeriod4</span>
<span id="cb14-167"><a href="#cb14-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-168"><a href="#cb14-168" aria-hidden="true" tabindex="-1"></a>        <span class="co">## set the start of the grazig to the first day of the month</span></span>
<span id="cb14-169"><a href="#cb14-169" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>start_graz1 <span class="op">=</span> <span class="op">:</span>isgrazed1 ?</span>
<span id="cb14-170"><a href="#cb14-170" aria-hidden="true" tabindex="-1"></a>            <span class="bu">Dates</span>.<span class="fu">Date</span>(<span class="op">:</span>Year, <span class="op">:</span>StartGrazingPeriod1) <span class="op">:</span> <span class="cn">missing</span></span>
<span id="cb14-171"><a href="#cb14-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-172"><a href="#cb14-172" aria-hidden="true" tabindex="-1"></a>        <span class="co">## set the end of the first grazing period to the start date + the number of days</span></span>
<span id="cb14-173"><a href="#cb14-173" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>end_graz1 <span class="op">=</span> <span class="op">:</span>isgrazed1 ?</span>
<span id="cb14-174"><a href="#cb14-174" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>start_graz1 <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>(<span class="op">:</span>DayGrazing1) <span class="op">:</span> <span class="cn">missing</span></span>
<span id="cb14-175"><a href="#cb14-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-176"><a href="#cb14-176" aria-hidden="true" tabindex="-1"></a>        <span class="co">## if the start of the second grazing period is before the end of the first</span></span>
<span id="cb14-177"><a href="#cb14-177" aria-hidden="true" tabindex="-1"></a>        <span class="co">## set the start of the second to the end of the first + one day</span></span>
<span id="cb14-178"><a href="#cb14-178" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>start_graz2 <span class="op">=</span> <span class="op">:</span>isgrazed2 ?</span>
<span id="cb14-179"><a href="#cb14-179" aria-hidden="true" tabindex="-1"></a>            <span class="bu">Dates</span>.<span class="fu">Date</span>(<span class="op">:</span>Year, <span class="op">:</span>StartGrazingPeriod2) <span class="op">:</span> <span class="cn">missing</span></span>
<span id="cb14-180"><a href="#cb14-180" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>start_graz2 <span class="op">=</span> <span class="op">:</span>isgrazed2 <span class="op">&amp;&amp;</span> <span class="op">:</span>start_graz2 <span class="op">&lt;=</span> <span class="op">:</span>end_graz1 ?</span>
<span id="cb14-181"><a href="#cb14-181" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>end_graz1 <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>(<span class="fl">1</span>) <span class="op">:</span> <span class="op">:</span>start_graz2</span>
<span id="cb14-182"><a href="#cb14-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-183"><a href="#cb14-183" aria-hidden="true" tabindex="-1"></a>        <span class="co">## set the end of the second grazing period to the start date + the number of days</span></span>
<span id="cb14-184"><a href="#cb14-184" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>end_graz2 <span class="op">=</span> <span class="op">:</span>isgrazed2 ?</span>
<span id="cb14-185"><a href="#cb14-185" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>start_graz2 <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>(<span class="op">:</span>DayGrazing2) <span class="op">:</span> <span class="cn">missing</span></span>
<span id="cb14-186"><a href="#cb14-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-187"><a href="#cb14-187" aria-hidden="true" tabindex="-1"></a>        <span class="co">## if the start of the third grazing period is before the end of the second</span></span>
<span id="cb14-188"><a href="#cb14-188" aria-hidden="true" tabindex="-1"></a>        <span class="co">## set the start of the third to the end of the second + one day</span></span>
<span id="cb14-189"><a href="#cb14-189" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>start_graz3 <span class="op">=</span> <span class="op">:</span>isgrazed3 ?</span>
<span id="cb14-190"><a href="#cb14-190" aria-hidden="true" tabindex="-1"></a>            <span class="bu">Dates</span>.<span class="fu">Date</span>(<span class="op">:</span>Year, <span class="op">:</span>StartGrazingPeriod3) <span class="op">:</span> <span class="cn">missing</span></span>
<span id="cb14-191"><a href="#cb14-191" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>start_graz3 <span class="op">=</span> <span class="op">:</span>isgrazed3 <span class="op">&amp;&amp;</span> <span class="op">:</span>start_graz3 <span class="op">&lt;=</span> <span class="op">:</span>end_graz2 ?</span>
<span id="cb14-192"><a href="#cb14-192" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>end_graz2 <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>(<span class="fl">1</span>) <span class="op">:</span> <span class="op">:</span>start_graz3</span>
<span id="cb14-193"><a href="#cb14-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-194"><a href="#cb14-194" aria-hidden="true" tabindex="-1"></a>        <span class="co">## set the end of the third grazing period to the start date + the number of days</span></span>
<span id="cb14-195"><a href="#cb14-195" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>end_graz3 <span class="op">=</span> <span class="op">:</span>isgrazed3 ?</span>
<span id="cb14-196"><a href="#cb14-196" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>start_graz3 <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>(<span class="op">:</span>DayGrazing3) <span class="op">:</span> <span class="cn">missing</span></span>
<span id="cb14-197"><a href="#cb14-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-198"><a href="#cb14-198" aria-hidden="true" tabindex="-1"></a>        <span class="co">## if the start of the fourth grazing period is before the end of the third</span></span>
<span id="cb14-199"><a href="#cb14-199" aria-hidden="true" tabindex="-1"></a>        <span class="co">## set the start of the fourth to the end of the third + one day</span></span>
<span id="cb14-200"><a href="#cb14-200" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>start_graz4 <span class="op">=</span> <span class="op">:</span>isgrazed4 ?</span>
<span id="cb14-201"><a href="#cb14-201" aria-hidden="true" tabindex="-1"></a>            <span class="bu">Dates</span>.<span class="fu">Date</span>(<span class="op">:</span>Year, <span class="op">:</span>StartGrazingPeriod4) <span class="op">:</span> <span class="cn">missing</span></span>
<span id="cb14-202"><a href="#cb14-202" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>start_graz4 <span class="op">=</span> <span class="op">:</span>isgrazed4 <span class="op">&amp;&amp;</span> <span class="op">:</span>start_graz4 <span class="op">&lt;=</span> <span class="op">:</span>end_graz3 ?</span>
<span id="cb14-203"><a href="#cb14-203" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>end_graz3 <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>(<span class="fl">1</span>) <span class="op">:</span> <span class="op">:</span>start_graz4</span>
<span id="cb14-204"><a href="#cb14-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-205"><a href="#cb14-205" aria-hidden="true" tabindex="-1"></a>        <span class="co">## set the end of the fourth grazing period to the start date + the number of days</span></span>
<span id="cb14-206"><a href="#cb14-206" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>end_graz4 <span class="op">=</span> <span class="op">:</span>isgrazed4 ?</span>
<span id="cb14-207"><a href="#cb14-207" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>start_graz4 <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>(<span class="op">:</span>DayGrazing4) <span class="op">:</span> <span class="cn">missing</span></span>
<span id="cb14-208"><a href="#cb14-208" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb14-209"><a href="#cb14-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-210"><a href="#cb14-210" aria-hidden="true" tabindex="-1"></a>    test1 <span class="op">=</span> <span class="fu">sum</span>(<span class="fu">abs</span>.(df.TotalGrazing <span class="op">.-</span> df.intens_total) <span class="op">.&gt;</span> <span class="fl">10</span>)</span>
<span id="cb14-211"><a href="#cb14-211" aria-hidden="true" tabindex="-1"></a>    test2 <span class="op">=</span> df[<span class="fu">ismissing</span>.(df.StartGrazingPeriod1), <span class="op">:</span>]</span>
<span id="cb14-212"><a href="#cb14-212" aria-hidden="true" tabindex="-1"></a>    test3 <span class="op">=</span> df[<span class="fu">ismissing</span>.(df.StartGrazingPeriod2) <span class="op">.&amp;&amp;</span> .! <span class="fu">iszero</span>.(df.DayGrazing2) <span class="op">.&amp;&amp;</span></span>
<span id="cb14-213"><a href="#cb14-213" aria-hidden="true" tabindex="-1"></a>               .! <span class="fu">iszero</span>.(df.LivestockUnits2), <span class="op">:</span>]</span>
<span id="cb14-214"><a href="#cb14-214" aria-hidden="true" tabindex="-1"></a>    test4 <span class="op">=</span> df[<span class="fu">ismissing</span>.(df.StartGrazingPeriod3) <span class="op">.&amp;&amp;</span> .! <span class="fu">iszero</span>.(df.DayGrazing3) <span class="op">.&amp;&amp;</span></span>
<span id="cb14-215"><a href="#cb14-215" aria-hidden="true" tabindex="-1"></a>               .! <span class="fu">iszero</span>.(df.LivestockUnits3), <span class="op">:</span>]</span>
<span id="cb14-216"><a href="#cb14-216" aria-hidden="true" tabindex="-1"></a>    test5 <span class="op">=</span> df[<span class="fu">ismissing</span>.(df.StartGrazingPeriod4) <span class="op">.&amp;&amp;</span> .! <span class="fu">iszero</span>.(df.DayGrazing4) <span class="op">.&amp;&amp;</span></span>
<span id="cb14-217"><a href="#cb14-217" aria-hidden="true" tabindex="-1"></a>               .! <span class="fu">iszero</span>.(df.LivestockUnits4), <span class="op">:</span>]</span>
<span id="cb14-218"><a href="#cb14-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-219"><a href="#cb14-219" aria-hidden="true" tabindex="-1"></a>    <span class="co">## two rows have a small deviation in the total grazing intensity in my calculations</span></span>
<span id="cb14-220"><a href="#cb14-220" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@show</span> test1</span>
<span id="cb14-221"><a href="#cb14-221" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@show</span> <span class="fu">nrow</span>(test2)</span>
<span id="cb14-222"><a href="#cb14-222" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@show</span> <span class="fu">nrow</span>(test3)</span>
<span id="cb14-223"><a href="#cb14-223" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@show</span> <span class="fu">nrow</span>(test4)</span>
<span id="cb14-224"><a href="#cb14-224" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@show</span> <span class="fu">nrow</span>(test5)</span>
<span id="cb14-225"><a href="#cb14-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-226"><a href="#cb14-226" aria-hidden="true" tabindex="-1"></a>    <span class="fu">display</span>(<span class="fu">scatter</span>(df.TotalGrazing, df.intens_total, color <span class="op">=</span> (<span class="op">:</span>black, <span class="fl">0.2</span>)))</span>
<span id="cb14-227"><a href="#cb14-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-228"><a href="#cb14-228" aria-hidden="true" tabindex="-1"></a>    <span class="co">## produce the final dataframe that is used for the model input</span></span>
<span id="cb14-229"><a href="#cb14-229" aria-hidden="true" tabindex="-1"></a>    final_df <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb14-230"><a href="#cb14-230" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb14-231"><a href="#cb14-231" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>year <span class="op">=</span> <span class="op">:</span>Year</span>
<span id="cb14-232"><a href="#cb14-232" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>plotID <span class="op">=</span> <span class="op">:</span>EP_PlotID</span>
<span id="cb14-233"><a href="#cb14-233" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb14-234"><a href="#cb14-234" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="cf">begin</span></span>
<span id="cb14-235"><a href="#cb14-235" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>inten_graz1 <span class="op">=</span> <span class="fu">round</span>(<span class="op">:</span>inten_graz1 <span class="op">/</span> <span class="op">:</span>DayGrazing1; digits<span class="op">=</span><span class="fl">3</span>)</span>
<span id="cb14-236"><a href="#cb14-236" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>inten_graz2 <span class="op">=</span> <span class="fu">round</span>(<span class="op">:</span>inten_graz2 <span class="op">/</span> <span class="op">:</span>DayGrazing2; digits<span class="op">=</span><span class="fl">3</span>)</span>
<span id="cb14-237"><a href="#cb14-237" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>inten_graz3 <span class="op">=</span> <span class="fu">round</span>(<span class="op">:</span>inten_graz3 <span class="op">/</span> <span class="op">:</span>DayGrazing3; digits<span class="op">=</span><span class="fl">3</span>)</span>
<span id="cb14-238"><a href="#cb14-238" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>inten_graz4 <span class="op">=</span> <span class="fu">round</span>(<span class="op">:</span>inten_graz4 <span class="op">/</span> <span class="op">:</span>DayGrazing4; digits<span class="op">=</span><span class="fl">3</span>)</span>
<span id="cb14-239"><a href="#cb14-239" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb14-240"><a href="#cb14-240" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="cf">begin</span></span>
<span id="cb14-241"><a href="#cb14-241" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>plotID</span>
<span id="cb14-242"><a href="#cb14-242" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>year</span>
<span id="cb14-243"><a href="#cb14-243" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>inten_graz1</span>
<span id="cb14-244"><a href="#cb14-244" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>inten_graz2</span>
<span id="cb14-245"><a href="#cb14-245" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>inten_graz3</span>
<span id="cb14-246"><a href="#cb14-246" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>inten_graz4</span>
<span id="cb14-247"><a href="#cb14-247" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>start_graz1</span>
<span id="cb14-248"><a href="#cb14-248" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>start_graz2</span>
<span id="cb14-249"><a href="#cb14-249" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>start_graz3</span>
<span id="cb14-250"><a href="#cb14-250" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>start_graz4</span>
<span id="cb14-251"><a href="#cb14-251" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>end_graz1</span>
<span id="cb14-252"><a href="#cb14-252" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>end_graz2</span>
<span id="cb14-253"><a href="#cb14-253" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>end_graz3</span>
<span id="cb14-254"><a href="#cb14-254" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>end_graz4</span>
<span id="cb14-255"><a href="#cb14-255" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb14-256"><a href="#cb14-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-257"><a href="#cb14-257" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb14-258"><a href="#cb14-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-259"><a href="#cb14-259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> final_df</span>
<span id="cb14-260"><a href="#cb14-260" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb14-261"><a href="#cb14-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-262"><a href="#cb14-262" aria-hidden="true" tabindex="-1"></a>df_supple, df_supple_sum <span class="op">=</span> <span class="fu">supplementary_feeding</span>(<span class="st">"../data/"</span>)</span>
<span id="cb14-263"><a href="#cb14-263" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> <span class="fu">load_grazing</span>(<span class="st">"../data/"</span>)</span>
<span id="cb14-264"><a href="#cb14-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-265"><a href="#cb14-265" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter</span>(<span class="fu">vec</span>(<span class="fu">Matrix</span>(<span class="pp">@select</span>(df, <span class="op">$</span>(<span class="st">r"inten_"</span>)))))</span>
<span id="cb14-266"><a href="#cb14-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-267"><a href="#cb14-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-268"><a href="#cb14-268" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(<span class="st">"supplementary_feeding.csv"</span>, df_supple_sum)</span>
<span id="cb14-269"><a href="#cb14-269" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(<span class="st">"grazing.csv"</span>, df)</span>
<span id="cb14-270"><a href="#cb14-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-271"><a href="#cb14-271" aria-hidden="true" tabindex="-1"></a><span class="co"># move file to GrasslandTraitSim/assets/data/input</span></span>
<span id="cb14-272"><a href="#cb14-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-273"><a href="#cb14-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-274"><a href="#cb14-274" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb14-275"><a href="#cb14-275" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">find_start_month</span>(general_start, start_first_period)</span>
<span id="cb14-276"><a href="#cb14-276" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ! <span class="fu">ismissing</span>(general_start)</span>
<span id="cb14-277"><a href="#cb14-277" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fu">convert_month</span>(general_start)</span>
<span id="cb14-278"><a href="#cb14-278" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elseif</span> ! <span class="fu">ismissing</span>(start_first_period)</span>
<span id="cb14-279"><a href="#cb14-279" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fu">convert_month</span>(start_first_period)</span>
<span id="cb14-280"><a href="#cb14-280" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb14-281"><a href="#cb14-281" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fl">6</span></span>
<span id="cb14-282"><a href="#cb14-282" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb14-283"><a href="#cb14-283" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb14-284"><a href="#cb14-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-285"><a href="#cb14-285" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">find_end_month</span>(general_end)</span>
<span id="cb14-286"><a href="#cb14-286" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ! <span class="fu">ismissing</span>(general_end)</span>
<span id="cb14-287"><a href="#cb14-287" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="fu">convert_month</span>(general_end)</span>
<span id="cb14-288"><a href="#cb14-288" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb14-289"><a href="#cb14-289" aria-hidden="true" tabindex="-1"></a>           <span class="cf">return</span> <span class="fl">10</span></span>
<span id="cb14-290"><a href="#cb14-290" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb14-291"><a href="#cb14-291" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb14-292"><a href="#cb14-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-293"><a href="#cb14-293" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">load_grazing_simple</span>(path)</span>
<span id="cb14-294"><a href="#cb14-294" aria-hidden="true" tabindex="-1"></a>        lui_df <span class="op">=</span> CSV.<span class="fu">read</span>(</span>
<span id="cb14-295"><a href="#cb14-295" aria-hidden="true" tabindex="-1"></a>            path <span class="op">*</span> <span class="st">"LUI_tool_input.csv"</span>,</span>
<span id="cb14-296"><a href="#cb14-296" aria-hidden="true" tabindex="-1"></a>            DataFrame)</span>
<span id="cb14-297"><a href="#cb14-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-298"><a href="#cb14-298" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> CSV.<span class="fu">read</span>(</span>
<span id="cb14-299"><a href="#cb14-299" aria-hidden="true" tabindex="-1"></a>            path <span class="op">*</span> <span class="st">"nonpublic_management_input.csv"</span>,</span>
<span id="cb14-300"><a href="#cb14-300" aria-hidden="true" tabindex="-1"></a>            DataFrame;</span>
<span id="cb14-301"><a href="#cb14-301" aria-hidden="true" tabindex="-1"></a>            missingstring<span class="op">=</span>[<span class="st">""</span>, <span class="st">"NA"</span>]);</span>
<span id="cb14-302"><a href="#cb14-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-303"><a href="#cb14-303" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="fu">mapcols</span>(col <span class="op">-&gt;</span> <span class="fu">replace</span>(col, <span class="st">"-1"</span> <span class="op">=&gt;</span> <span class="cn">missing</span>), df)</span>
<span id="cb14-304"><a href="#cb14-304" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="fu">mapcols</span>(col <span class="op">-&gt;</span> <span class="fu">replace</span>(col, <span class="op">-</span><span class="fl">1</span> <span class="op">=&gt;</span> <span class="cn">missing</span>), df)</span>
<span id="cb14-305"><a href="#cb14-305" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="fu">mapcols</span>(col <span class="op">-&gt;</span> <span class="fu">replace</span>(col, <span class="st">"ja"</span> <span class="op">=&gt;</span> <span class="cn">true</span>), df)</span>
<span id="cb14-306"><a href="#cb14-306" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="fu">mapcols</span>(col <span class="op">-&gt;</span> <span class="fu">replace</span>(col, <span class="st">"nein"</span> <span class="op">=&gt;</span> <span class="cn">false</span>), df)</span>
<span id="cb14-307"><a href="#cb14-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-308"><a href="#cb14-308" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb14-309"><a href="#cb14-309" aria-hidden="true" tabindex="-1"></a>            <span class="fu">innerjoin</span>(<span class="pp">@select</span>(lui_df, <span class="op">:</span>Year, <span class="op">:</span>EP_PlotID, <span class="op">:</span>TotalGrazing), _, on <span class="op">=</span> [<span class="op">:</span>Year, <span class="op">:</span>EP_PlotID])</span>
<span id="cb14-310"><a href="#cb14-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-311"><a href="#cb14-311" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="op">:</span>startmonth <span class="op">=</span> <span class="fu">find_start_month</span>.(<span class="op">:</span>StartGrazing, <span class="op">:</span>StartGrazingPeriod1)</span>
<span id="cb14-312"><a href="#cb14-312" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="op">:</span>endmonth <span class="op">=</span> <span class="fu">find_end_month</span>.(<span class="op">:</span>EndGrazing)</span>
<span id="cb14-313"><a href="#cb14-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-314"><a href="#cb14-314" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="op">:</span>start_graz1 <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">firstdayofmonth</span>.(<span class="bu">Dates</span>.<span class="fu">Date</span>.(<span class="op">:</span>Year, <span class="op">:</span>startmonth))</span>
<span id="cb14-315"><a href="#cb14-315" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="op">:</span>end_graz1 <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">lastdayofmonth</span>.(<span class="bu">Dates</span>.<span class="fu">Date</span>.(<span class="op">:</span>Year, <span class="op">:</span>endmonth))</span>
<span id="cb14-316"><a href="#cb14-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-317"><a href="#cb14-317" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="op">:</span>days_grazing <span class="op">=</span> <span class="op">:</span>end_graz1 <span class="op">.-</span> <span class="op">:</span>start_graz1</span>
<span id="cb14-318"><a href="#cb14-318" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="op">:</span>inten_graz1 <span class="op">=</span> <span class="op">:</span>TotalGrazing <span class="op">./</span> <span class="bu">Dates</span>.<span class="fu">value</span>.(<span class="op">:</span>days_grazing)</span>
<span id="cb14-319"><a href="#cb14-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-320"><a href="#cb14-320" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@rtransform</span> <span class="op">:</span>start_graz1 <span class="op">=</span> <span class="fu">iszero</span>(<span class="op">:</span>TotalGrazing) ? <span class="cn">missing</span> <span class="op">:</span> <span class="op">:</span>start_graz1</span>
<span id="cb14-321"><a href="#cb14-321" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@rtransform</span> <span class="op">:</span>end_graz1 <span class="op">=</span> <span class="fu">iszero</span>(<span class="op">:</span>TotalGrazing) ? <span class="cn">missing</span> <span class="op">:</span> <span class="op">:</span>end_graz1</span>
<span id="cb14-322"><a href="#cb14-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-323"><a href="#cb14-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-324"><a href="#cb14-324" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="op">:</span>plotID <span class="op">=</span> <span class="fu">convert_id</span>.(<span class="op">:</span>EP_PlotID)</span>
<span id="cb14-325"><a href="#cb14-325" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@rename</span> <span class="op">:</span>year <span class="op">=</span> <span class="op">:</span>Year</span>
<span id="cb14-326"><a href="#cb14-326" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@orderby</span> <span class="op">:</span>plotID</span>
<span id="cb14-327"><a href="#cb14-327" aria-hidden="true" tabindex="-1"></a>            <span class="co"># @select :plotID :year :TotalGrazing :StartGrazing :EndGrazing :start_graz1 :end_graz1 :days_grazing :inten_graz1</span></span>
<span id="cb14-328"><a href="#cb14-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-329"><a href="#cb14-329" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>year <span class="op">:</span>inten_graz1 <span class="op">:</span>start_graz1 <span class="op">:</span>end_graz1</span>
<span id="cb14-330"><a href="#cb14-330" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb14-331"><a href="#cb14-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-332"><a href="#cb14-332" aria-hidden="true" tabindex="-1"></a>        df</span>
<span id="cb14-333"><a href="#cb14-333" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb14-334"><a href="#cb14-334" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="fu">load_grazing_simple</span>(<span class="st">"../data/"</span>)</span>
<span id="cb14-335"><a href="#cb14-335" aria-hidden="true" tabindex="-1"></a>    CSV.<span class="fu">write</span>(<span class="st">"grazing.csv"</span>, df)</span>
<span id="cb14-336"><a href="#cb14-336" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
<th>data source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>CUT_mowing</code></td>
<td>Height of mowing event, <code>NaN</code> means no mowing [m]</td>
<td><span class="citation" data-cites="explo_31715_v9">Vogt et al. (<a href="#ref-explo_31715_v9" role="doc-biblioref">2024</a>)</span></td>
</tr>
<tr class="even">
<td><code>LD_grazing</code></td>
<td>Grazing intensity measured in livestock units, <code>NaN</code> means no grazing [LD ha⁻¹]</td>
<td><span class="citation" data-cites="explo_31715_v9">Vogt et al. (<a href="#ref-explo_31715_v9" role="doc-biblioref">2024</a>)</span></td>
</tr>
</tbody>
</table>
<div id="4" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_mow <span class="op">=</span> <span class="pp">@chain</span> sim.data.input.mow <span class="cf">begin</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span> <span class="fu">startswith</span>.(<span class="op">:</span>plotID, <span class="st">"H"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@groupby</span> <span class="op">:</span>plotID</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@combine</span> <span class="op">:</span>mowing <span class="op">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="op">:</span>TotalMowing); digits <span class="op">=</span> <span class="fl">1</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@orderby</span> <span class="op">:</span>plotID</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>df_graz <span class="op">=</span> <span class="pp">@chain</span> sim.data.input.graz <span class="cf">begin</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span> <span class="fu">startswith</span>.(<span class="op">:</span>plotID, <span class="st">"H"</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rtransform</span> <span class="op">:</span>graz1 <span class="op">=</span> <span class="fu">ismissing</span>(<span class="op">:</span>end_graz1 <span class="op">-</span> <span class="op">:</span>start_graz1) ? <span class="fl">0.0</span> <span class="op">:</span> <span class="op">:</span>inten_graz1 <span class="op">*</span> <span class="bu">Dates</span>.<span class="fu">value</span>.(<span class="op">:</span>end_graz1 <span class="op">-</span> <span class="op">:</span>start_graz1)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># @rtransform :graz2 = ismissing(:end_graz2 - :start_graz2) ? 0.0 : :inten_graz2 * Dates.value.(:end_graz2 - :start_graz2)</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># @rtransform :graz3 = ismissing(:end_graz3 - :start_graz3) ? 0.0 : :inten_graz3 * Dates.value.(:end_graz3 - :start_graz3)</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># @rtransform :graz4 = ismissing(:end_graz4 - :start_graz4) ? 0.0 : :inten_graz4 * Dates.value.(:end_graz4 - :start_graz4)</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>total_grazed <span class="op">=</span> <span class="op">:</span>graz1 <span class="co">#+ :graz2 + :graz3 + :graz4</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@groupby</span> <span class="op">:</span>plotID</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@combine</span> <span class="op">:</span>grazing <span class="op">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="op">:</span>total_grazed); digits <span class="op">=</span> <span class="fl">1</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@orderby</span> <span class="op">:</span>plotID</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(; size <span class="op">=</span> (<span class="fl">500</span>, <span class="fl">800</span>))</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stem</span>(fig[<span class="fl">1</span>,<span class="fl">1</span>], df_mow.mowing;</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>         axis <span class="op">=</span> (; ylabel <span class="op">=</span> <span class="st">"Mean number of mowing events per year [-]"</span>,</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>                   xticks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">:</span><span class="fl">50</span>),</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>         color <span class="op">=</span> <span class="op">:</span>blue)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stem</span>(fig[<span class="fl">2</span>,<span class="fl">1</span>], <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, df_graz.grazing;</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>         axis <span class="op">=</span> (; xlabel <span class="op">=</span> <span class="st">"plotID"</span>, ylabel <span class="op">=</span> <span class="st">"Mean grazing intensity per year [LD ha⁻¹ d]"</span>,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>                   xticks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">:</span><span class="fl">50</span>),</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>         color <span class="op">=</span> <span class="op">:</span>red)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowgap!</span>(fig.layout, <span class="fl">1</span>, <span class="fl">0</span>)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="data_files/figure-html/cell-3-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="raw-time-invariant-site-variables" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="raw-time-invariant-site-variables"><span class="header-section-number">2.4</span> Raw time invariant site variables</h3>
<p>The texture classes of <span class="citation" data-cites="explo14686v10">Schöning, Solly, et al. (<a href="#ref-explo14686v10" role="doc-biblioref">2021c</a>)</span> were partly collapsed: <code>Fine_Silt</code>, <code>Medium_Silt</code>, <code>Coarse_Silt</code> to <code>silt</code> and <code>Fine_Sand</code>, <code>Medium_Sand</code>, <code>Coarse_Sand</code> to <code>sand</code>.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
<th>Data source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>sand</code></td>
<td>Sand content [%]</td>
<td><span class="citation" data-cites="explo14686v10">Schöning, Solly, et al. (<a href="#ref-explo14686v10" role="doc-biblioref">2021c</a>)</span></td>
</tr>
<tr class="even">
<td><code>silt</code></td>
<td>Silt content [%]</td>
<td><span class="citation" data-cites="explo14686v10">Schöning, Solly, et al. (<a href="#ref-explo14686v10" role="doc-biblioref">2021c</a>)</span></td>
</tr>
<tr class="odd">
<td><code>clay</code></td>
<td>Clay content [%]</td>
<td><span class="citation" data-cites="explo14686v10">Schöning, Solly, et al. (<a href="#ref-explo14686v10" role="doc-biblioref">2021c</a>)</span></td>
</tr>
<tr class="even">
<td><code>rootdepth</code></td>
<td>Mean rooting depth of plants [mm, orig: cm]</td>
<td><span class="citation" data-cites="explo4761v3">Herold, Schöning, and Schrumpf (<a href="#ref-explo4761v3" role="doc-biblioref">2021</a>)</span></td>
</tr>
<tr class="odd">
<td><code>bulk</code></td>
<td>Bulk density [g cm⁻³]</td>
<td><span class="citation" data-cites="explo17086v4">Schöning, Solly, et al. (<a href="#ref-explo17086v4" role="doc-biblioref">2021a</a>)</span></td>
</tr>
<tr class="even">
<td><code>organic</code></td>
<td>Organic matter content [%]</td>
<td><span class="citation" data-cites="explo14446v19">Schöning, Solly, et al. (<a href="#ref-explo14446v19" role="doc-biblioref">2021b</a>)</span></td>
</tr>
<tr class="odd">
<td><code>totalN</code></td>
<td>Total nitrogen [g kg⁻¹]</td>
<td><span class="citation" data-cites="explo14446v19">Schöning, Solly, et al. (<a href="#ref-explo14446v19" role="doc-biblioref">2021b</a>)</span> <span class="citation" data-cites="explo18787v6">Schöning, Trumbore, et al. (<a href="#ref-explo18787v6" role="doc-biblioref">2021</a>)</span> <span class="citation" data-cites="explo23846v10">Schöning, Klötzing, et al. (<a href="#ref-explo23846v10" role="doc-biblioref">2021</a>)</span> <span class="citation" data-cites="explo_31210_v13">Schöning (<a href="#ref-explo_31210_v13" role="doc-biblioref">2023</a>)</span></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled" title="Details on loading the total nitrogen">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Details on loading the total nitrogen
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The mean total nitrogen of the years 2011, 2014, 2017 and 2021 was calculated with the following script:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>soilnutrients.jl</strong></pre>
</div>
<div class="sourceCode" id="cb16" data-filename="soilnutrients.jl"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">CSV</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">DataFramesMeta</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">read_minsoil</span>(path, year)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@chain</span> CSV.<span class="fu">read</span>(path, DataFrame; missingstring <span class="op">=</span> <span class="st">"NA"</span>) <span class="cf">begin</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="op">:</span>Plot <span class="op">=</span> <span class="op">:</span>EP_Plotid</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="op">:</span>explo <span class="op">=</span> <span class="op">:</span>Exploratory</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span><span class="dt">Type</span> <span class="op">.==</span> <span class="st">"G"</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>Year <span class="op">=</span> year</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">convert_id</span>(id)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="fu">first</span>.(id, <span class="fl">3</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">chop</span>(id, head <span class="op">=</span> <span class="fl">3</span>, tail <span class="op">=</span> <span class="fl">0</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">lpad</span>(b, <span class="fl">2</span>, <span class="st">"0"</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> b</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>data_path <span class="op">=</span> <span class="st">"../data/"</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>df_prep <span class="op">=</span> <span class="fu">vcat</span>(</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_minsoil</span>(data_path <span class="op">*</span> <span class="st">"soilnutrients_2011.csv"</span>, <span class="fl">2011</span>),</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_minsoil</span>(data_path <span class="op">*</span> <span class="st">"soilnutrients_2014.csv"</span>, <span class="fl">2014</span>),</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_minsoil</span>(data_path <span class="op">*</span> <span class="st">"soilnutrients_2017.csv"</span>, <span class="fl">2017</span>),</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_minsoil</span>(data_path <span class="op">*</span> <span class="st">"soilnutrients_2021.csv"</span>, <span class="fl">2021</span>))</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>minsoil_df <span class="op">=</span> <span class="pp">@chain</span> df_prep <span class="cf">begin</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>plotID <span class="op">=</span> <span class="fu">convert_id</span>.(<span class="op">:</span>Plot)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@orderby</span> <span class="op">:</span>plotID</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">groupby</span>(<span class="op">:</span>plotID)</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@combine</span> <span class="op">:</span>totalN <span class="op">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="op">:</span>Total_N); digits <span class="op">=</span> <span class="fl">2</span>)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(<span class="st">"soilnutrients.csv"</span>, minsoil_df)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="co">## visualize how the total N changes over time</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AlgebraOfGraphics</span>, <span class="bu">CairoMakie</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>    plots <span class="op">=</span> [<span class="st">"</span><span class="sc">$</span>(explo)<span class="sc">$</span>(<span class="fu">lpad</span>(i, <span class="fl">2</span>, <span class="st">"0"</span>))<span class="st">"</span> for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span> for explo <span class="kw">in</span> [<span class="st">"HEG"</span>]]</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="pp">@chain</span> df_prep <span class="cf">begin</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>plotID <span class="op">=</span> <span class="fu">convert_id</span>.(<span class="op">:</span>Plot)</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>plotID</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>plotID <span class="op">.∈</span> <span class="fu">Ref</span>(plots)</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>Year <span class="op">:</span>Total_N</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>   xy <span class="op">=</span> <span class="fu">data</span>(df) <span class="op">*</span> <span class="fu">mapping</span>(<span class="op">:</span>Year, <span class="op">:</span>Total_N, color <span class="op">=</span> <span class="op">:</span>plotID)</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>   layers <span class="op">=</span> <span class="fu">visual</span>(Scatter) <span class="op">+</span> <span class="fu">visual</span>(Lines)</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>   <span class="fu">draw</span>(layers <span class="op">*</span> xy)</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Details on loading the soil characteristics for WHC and PWP">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Details on loading the soil characteristics for WHC and PWP
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Soil characteristics were loaded with the following script:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>soilwater.jl</strong></pre>
</div>
<div class="sourceCode" id="cb17" data-filename="soilwater.jl"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">CSV</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">DataFramesMeta</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">convert_id</span>(id)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="fu">first</span>.(id, <span class="fl">3</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">chop</span>(id, head <span class="op">=</span> <span class="fl">3</span>, tail <span class="op">=</span> <span class="fl">0</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">lpad</span>(b, <span class="fl">2</span>, <span class="st">"0"</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> b</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> <span class="st">"../data/"</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>texture_df <span class="op">=</span> CSV.<span class="fu">read</span>(data_dir <span class="op">*</span> <span class="st">"soiltexture_2011.csv"</span>,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    DataFrame;</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    missingstring <span class="op">=</span> [<span class="st">"NA"</span>])</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>organic_df <span class="op">=</span> CSV.<span class="fu">read</span>(data_dir <span class="op">*</span> <span class="st">"soilorganicmatter_2011.csv"</span>,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    DataFrame;</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    missingstring <span class="op">=</span> [<span class="st">"NA"</span>])</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>bulk_df <span class="op">=</span> CSV.<span class="fu">read</span>(data_dir <span class="op">*</span> <span class="st">"soilbulkdensity_2011.csv"</span>,</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    DataFrame;</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    missingstring <span class="op">=</span> [<span class="st">"-888888"</span>, <span class="st">"NA"</span>])</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="fu">coalesce</span>(bulk_df, <span class="cn">NaN</span>, <span class="cn">missing</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>rooting_df <span class="op">=</span> CSV.<span class="fu">read</span>(data_dir <span class="op">*</span> <span class="st">"rootingdepth_2008.csv"</span>,</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    DataFrame;</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    missingstring <span class="op">=</span> [<span class="st">"NA"</span>])</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>plot_rooting_df <span class="op">=</span> <span class="pp">@chain</span> rooting_df <span class="cf">begin</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rename</span> <span class="op">:</span>EP_Plotid <span class="op">=</span> <span class="op">:</span>plotid</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span> .!<span class="fu">ismissing</span>.(<span class="op">:</span>rootingSpace)</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">groupby</span>(_, <span class="op">:</span>EP_Plotid)</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@combine</span> <span class="op">:</span>root_depth <span class="op">=</span> <span class="fu">median</span>(<span class="op">:</span>rootingSpace)</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>explo_rooting_df <span class="op">=</span> <span class="pp">@chain</span> rooting_df <span class="cf">begin</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rename</span> <span class="op">:</span>EP_Plotid <span class="op">=</span> <span class="op">:</span>plotid</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>explo <span class="op">=</span> <span class="fu">string</span>.(<span class="fu">first</span>.(<span class="op">:</span>EP_Plotid))</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span> .!<span class="fu">ismissing</span>.(<span class="op">:</span>rootingSpace)</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">groupby</span>(_, <span class="op">:</span>explo)</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@combine</span> <span class="op">:</span>median_root_depth <span class="op">=</span> <span class="fu">median</span>(<span class="op">:</span>rootingSpace)</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> <span class="pp">@chain</span> texture_df <span class="cf">begin</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span> <span class="op">:</span><span class="dt">Type</span> <span class="op">.==</span> <span class="st">"G"</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>Clay <span class="op">=</span> <span class="op">:</span>Clay <span class="op">/</span> <span class="fl">10</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>Silt <span class="op">=</span> (<span class="op">:</span>Fine_Silt <span class="op">+</span> <span class="op">:</span>Medium_Silt <span class="op">+</span> <span class="op">:</span>Coarse_Silt) <span class="op">/</span> <span class="fl">10</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>Sand <span class="op">=</span> (<span class="op">:</span>Fine_Sand <span class="op">+</span> <span class="op">:</span>Medium_Sand <span class="op">+</span> <span class="op">:</span>Coarse_Sand) <span class="op">/</span> <span class="fl">10</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rename</span> <span class="op">:</span>explo <span class="op">=</span> <span class="op">:</span>Exploratory</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leftjoin</span>(_, organic_df, on <span class="op">=</span> <span class="op">:</span>EP_Plotid, makeunique <span class="op">=</span> <span class="cn">true</span>)</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leftjoin</span>(_, bulk_df, on <span class="op">=</span> <span class="op">:</span>EP_Plotid, makeunique <span class="op">=</span> <span class="cn">true</span>)</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leftjoin</span>(_, plot_rooting_df, on <span class="op">=</span> <span class="op">:</span>EP_Plotid, makeunique <span class="op">=</span> <span class="cn">true</span>)</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leftjoin</span>(_, explo_rooting_df, on <span class="op">=</span> <span class="op">:</span>explo)</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rename</span> <span class="op">:</span>bulk <span class="op">=</span> <span class="op">:</span>BD</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>bulk <span class="op">=</span> <span class="fu">coalesce</span>.(<span class="op">:</span>bulk, <span class="fu">mean</span>(<span class="op">:</span>bulk[.!<span class="fu">ismissing</span>.(<span class="op">:</span>bulk)]))</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>root_depth <span class="op">=</span> <span class="fu">coalesce</span>.(<span class="op">:</span>root_depth, <span class="op">:</span>median_root_depth) <span class="op">*</span> <span class="fl">10</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>organic <span class="op">=</span> <span class="fu">round</span>.(<span class="op">:</span>Organic_C <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="fl">100</span>; digits <span class="op">=</span> <span class="fl">2</span>)</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rtransform</span> <span class="op">:</span>plotID <span class="op">=</span> <span class="fu">convert_id</span>(<span class="op">:</span>EP_Plotid)</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@orderby</span> <span class="op">:</span>plotID</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>clay <span class="op">=</span> <span class="op">:</span>Clay</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>silt <span class="op">=</span> <span class="op">:</span>Silt</span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>sand <span class="op">=</span> <span class="op">:</span>Sand</span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>rootdepth <span class="op">=</span> <span class="op">:</span>root_depth</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>explo <span class="op">:</span>clay <span class="op">:</span>silt <span class="op">:</span>sand <span class="op">:</span>organic <span class="op">:</span>bulk <span class="op">:</span>rootdepth</span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(<span class="st">"soilwater.csv"</span>, df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="water-holding-capacity-and-permanent-wilting-point" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="water-holding-capacity-and-permanent-wilting-point"><span class="header-section-number">2.5</span> Water holding capacity and permanent wilting point</h3>
<p>The procedure for converting soil characteristics to water holding capacity (WHC) and permanent wilting point (PWP) is described by <span class="citation" data-cites="Gupta1979">Gupta and Larson (<a href="#ref-Gupta1979" role="doc-biblioref">1979</a>)</span>. These plots show the usable field capacity (uFC), water holding capacity (WHC) and permanent wilting point (PWP) for all sites of the Hainich exploratory.</p>
<div id="6" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">GrasslandTraitSim</span> as sim</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">CSV</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">DataFramesMeta</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AlgebraOfGraphics</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> CSV.<span class="fu">read</span>(sim.<span class="fu">assetpath</span>() <span class="op">*</span> <span class="st">"/data/input/soilwater.csv"</span>, DataFrame) </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">### Estimating Generalized Soil-water Characteristics from Texture</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">## Gupta 1979</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> [<span class="op">-</span><span class="fl">0.04</span> <span class="fl">7.053</span> <span class="fl">10.242</span> <span class="fl">10.070</span> <span class="fl">6.333</span> <span class="op">-</span><span class="fl">32.120</span> <span class="fl">0.950</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">0.07</span> <span class="fl">5.678</span> <span class="fl">9.228</span> <span class="fl">9.135</span> <span class="fl">6.103</span> <span class="op">-</span><span class="fl">26.960</span> <span class="fl">0.959</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">0.10</span> <span class="fl">5.018</span> <span class="fl">8.548</span> <span class="fl">8.833</span> <span class="fl">4.966</span> <span class="op">-</span><span class="fl">24.230</span> <span class="fl">0.961</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">0.20</span> <span class="fl">3.890</span> <span class="fl">7.066</span> <span class="fl">8.408</span> <span class="fl">2.817</span> <span class="op">-</span><span class="fl">18.780</span> <span class="fl">0.962</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">0.33</span> <span class="fl">3.075</span> <span class="fl">5.886</span> <span class="fl">8.039</span> <span class="fl">2.208</span> <span class="op">-</span><span class="fl">14.340</span> <span class="fl">0.962</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">0.60</span> <span class="fl">2.181</span> <span class="fl">4.557</span> <span class="fl">7.557</span> <span class="fl">2.191</span> <span class="op">-</span><span class="fl">9.276</span> <span class="fl">0.964</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">1.0</span> <span class="fl">1.563</span> <span class="fl">3.620</span> <span class="fl">7.154</span> <span class="fl">2.388</span> <span class="op">-</span><span class="fl">5.759</span> <span class="fl">0.966</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">2.0</span> <span class="fl">0.932</span> <span class="fl">2.643</span> <span class="fl">6.636</span> <span class="fl">2.717</span> <span class="op">-</span><span class="fl">2.214</span> <span class="fl">0.967</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">4.0</span> <span class="fl">0.483</span> <span class="fl">1.943</span> <span class="fl">6.128</span> <span class="fl">2.925</span> <span class="op">-</span><span class="fl">0.204</span> <span class="fl">0.962</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">7.0</span> <span class="fl">0.214</span> <span class="fl">1.538</span> <span class="fl">5.908</span> <span class="fl">2.855</span> <span class="fl">1.530</span> <span class="fl">0.954</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">10.0</span> <span class="fl">0.076</span> <span class="fl">1.334</span> <span class="fl">5.802</span> <span class="fl">2.653</span> <span class="fl">2.145</span> <span class="fl">0.951</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">15.0</span> <span class="op">-</span><span class="fl">0.059</span> <span class="fl">1.142</span> <span class="fl">5.766</span> <span class="fl">2.228</span> <span class="fl">2.671</span> <span class="fl">0.947</span>]</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>gupta_df <span class="op">=</span> <span class="fu">DataFrame</span>(m, [<span class="op">:</span>Ψ_bar, <span class="op">:</span>a, <span class="op">:</span>b, <span class="op">:</span>c, <span class="op">:</span>d, <span class="op">:</span><span class="cn">e</span>, <span class="op">:</span>R])</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>gupta_df <span class="op">=</span> <span class="pp">@chain</span> gupta_df <span class="cf">begin</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>a <span class="op">=</span> <span class="op">:</span>a <span class="op">*</span> <span class="fl">1e-3</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>b <span class="op">=</span> <span class="op">:</span>b <span class="op">*</span> <span class="fl">1e-3</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>c <span class="op">=</span> <span class="op">:</span>c <span class="op">*</span> <span class="fl">1e-3</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>d <span class="op">=</span> <span class="op">:</span>d <span class="op">*</span> <span class="fl">1e-3</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span><span class="cn">e</span> <span class="op">=</span> <span class="op">:</span><span class="cn">e</span> <span class="op">*</span> <span class="fl">1e-2</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>Ψ_hPa <span class="op">=</span> <span class="op">:</span>Ψ_bar <span class="op">*</span> <span class="fl">1000</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rtransform</span> <span class="op">:</span>pF <span class="op">=</span> <span class="fu">log10</span>(<span class="fu">abs</span>(<span class="op">:</span>Ψ_hPa))</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@select</span> <span class="op">:</span>pF <span class="op">:</span>Ψ_hPa <span class="op">:</span>Ψ_bar <span class="op">:</span>a <span class="op">:</span>b <span class="op">:</span>c <span class="op">:</span>d <span class="op">:</span><span class="cn">e</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="pp">@subset</span> gupta_df <span class="op">:</span>Ψ_hPa <span class="op">.==</span> <span class="op">-</span><span class="fl">15000</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calc_gupta</span>(; sand, silt, clay, organic, bulk)</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    ps <span class="op">=</span> <span class="fu">NamedTuple</span>.(<span class="fu">eachrow</span>(gupta_df))</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>    θs <span class="op">=</span> <span class="fu">fill</span>(<span class="cn">NaN</span>, <span class="fu">nrow</span>(gupta_df))</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">nrow</span>(gupta_df)</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> ps[i]</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>        θ <span class="op">=</span> p.a <span class="op">*</span> sand <span class="op">+</span> p.b <span class="op">*</span> silt <span class="op">+</span> p.c <span class="op">*</span> clay <span class="op">+</span> p.d <span class="op">*</span> organic <span class="op">+</span> p.<span class="cn">e</span> <span class="op">*</span> bulk</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>        θs[i] <span class="op">=</span> θ</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    θs[θs <span class="op">.&gt;</span> <span class="fl">1</span>] <span class="op">.=</span> <span class="fl">1</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>    θs[θs <span class="op">.&lt;</span> <span class="fl">0</span>] <span class="op">.=</span> <span class="fl">0</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> θs</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calc_specific</span>(; df, hPA)</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>    gupta_sub <span class="op">=</span> <span class="pp">@chain</span> gupta_df <span class="cf">begin</span></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>Ψ_hPa <span class="op">.==</span> hPA</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">$</span>(<span class="fu">Not</span>(<span class="st">r"pF</span><span class="ch">|</span><span class="st">Ψ"</span>))</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">NamedTuple</span>.(<span class="fu">eachrow</span>(gupta_sub))[<span class="fl">1</span>]</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>    θ <span class="op">=</span> p.a <span class="op">*</span> df.sand <span class="op">+</span> p.b <span class="op">*</span> df.silt <span class="op">+</span> p.c <span class="op">*</span> df.clay <span class="op">+</span> p.d <span class="op">*</span> df.organic <span class="op">+</span> p.<span class="cn">e</span> <span class="op">*</span> df.bulk</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> θ <span class="op">.*</span> df.rootdepth</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>df.WHC <span class="op">=</span> <span class="fu">calc_specific</span>(; df, hPA <span class="op">=</span> <span class="op">-</span><span class="fl">70</span>)</span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>df.PWP <span class="op">=</span> <span class="fu">calc_specific</span>(; df, hPA <span class="op">=</span> <span class="op">-</span><span class="fl">15000</span>)</span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>df.uFC <span class="op">=</span> df.WHC <span class="op">-</span> df.PWP</span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a><span class="pp">@subset</span>! df <span class="op">:</span>explo <span class="op">.==</span> <span class="st">"H"</span></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(; size <span class="op">=</span> (<span class="fl">800</span>, <span class="fl">300</span>))</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>    ax1, _ <span class="op">=</span> <span class="fu">hist</span>(fig[<span class="fl">1</span>,<span class="fl">1</span>], df.WHC, axis <span class="op">=</span> (; xlabel <span class="op">=</span> <span class="st">"Water holding capacity [mm]"</span>))</span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>    ax2, _ <span class="op">=</span> <span class="fu">hist</span>(fig[<span class="fl">1</span>,<span class="fl">2</span>], df.PWP, axis <span class="op">=</span> (; xlabel <span class="op">=</span> <span class="st">"Permanent wilting point [mm]"</span>, yticklabelsvisible <span class="op">=</span> <span class="cn">false</span>))</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>    ax3, _ <span class="op">=</span> <span class="fu">hist</span>(fig[<span class="fl">1</span>,<span class="fl">3</span>], df.uFC, axis <span class="op">=</span> (; xlabel <span class="op">=</span> <span class="st">"Usable field capacity [mm]"</span>, yticklabelsvisible <span class="op">=</span> <span class="cn">false</span>))</span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">linkyaxes!</span>(ax1, ax2, ax3)</span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colgap!</span>(fig.layout, <span class="fl">1</span>, <span class="fl">0</span>)</span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colgap!</span>(fig.layout, <span class="fl">2</span>, <span class="fl">0</span>)</span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="data_files/figure-html/cell-4-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="calibration-data" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="calibration-data"><span class="header-section-number">3</span> Calibration data</h2>
<section id="biomass-and-vegetation-height" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="biomass-and-vegetation-height"><span class="header-section-number">3.1</span> Biomass and vegetation height</h3>
<p>Biomass and vegetation height were measured in the Biodiversity Exploratories once per year. The data was downloaded from BExIS and processed to get the measured biomass and vegetation height.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 30%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
<th>Data source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>biomass[plot, year]</code></td>
<td>Dried aboveground biomass, cut at a height of 4 cm once per year in spring [g m⁻²]</td>
<td><span class="citation" data-cites="explo16209v2">Boch et al. (<a href="#ref-explo16209v2" role="doc-biblioref">2017</a>)</span> <span class="citation" data-cites="explo12706v2">Schmitt, Prati, and Fischer (<a href="#ref-explo12706v2" role="doc-biblioref">2017</a>)</span> <span class="citation" data-cites="explo14346v3">Schmitt et al. (<a href="#ref-explo14346v3" role="doc-biblioref">2018</a>)</span> <span class="citation" data-cites="explo15588v2">Schmitt and Fischer (<a href="#ref-explo15588v2" role="doc-biblioref">2018</a>)</span> <span class="citation" data-cites="explo16826v4">Schmitt, Prati, and Fischer (<a href="#ref-explo16826v4" role="doc-biblioref">2018b</a>)</span> <span class="citation" data-cites="explo19807v4">Fischer, Hinderling, Schäfer, et al. (<a href="#ref-explo19807v4" role="doc-biblioref">2023a</a>)</span> <span class="citation" data-cites="explo19809v3">Fischer, Hinderling, Schäfer, et al. (<a href="#ref-explo19809v3" role="doc-biblioref">2023b</a>)</span> <span class="citation" data-cites="explo21187v3">Fischer, Schäfer, et al. (<a href="#ref-explo21187v3" role="doc-biblioref">2023</a>)</span> <span class="citation" data-cites="explo23486v4">Schäfer, Prati, and Fischer (<a href="#ref-explo23486v4" role="doc-biblioref">2023</a>)</span> <span class="citation" data-cites="explo24166v4">Bolliger, Hinderling, et al. (<a href="#ref-explo24166v4" role="doc-biblioref">2023</a>)</span> <span class="citation" data-cites="explo26151v4">Fischer, Hinderling, Bolliger, et al. (<a href="#ref-explo26151v4" role="doc-biblioref">2023</a>)</span> <span class="citation" data-cites="explo27426v5">Bolliger, Prati, et al. (<a href="#ref-explo27426v5" role="doc-biblioref">2023</a>)</span> <span class="citation" data-cites="explo31180v22">Prati and Bolliger (<a href="#ref-explo31180v22" role="doc-biblioref">2023</a>)</span> <span class="citation" data-cites="explo31387v10">Prati (<a href="#ref-explo31387v10" role="doc-biblioref">2023</a>)</span></td>
</tr>
<tr class="even">
<td><code>height[plot, t]</code></td>
<td>Measured vegetation height</td>
<td>same as above</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled" title="Details on getting the measured biomass">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Details on getting the measured biomass
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The measured (cut) biomass data was processed with the following script:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">CSV</span>, <span class="bu">Dates</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">DataFramesMeta</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">convert_id</span>(id)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="fu">first</span>.(id, <span class="fl">3</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">chop</span>(id, head <span class="op">=</span> <span class="fl">3</span>, tail <span class="op">=</span> <span class="fl">0</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">lpad</span>(b, <span class="fl">2</span>, <span class="st">"0"</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> b</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">core_biomass</span>(path)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    datasets1 <span class="op">=</span> [<span class="st">"biomass_</span><span class="sc">$</span>y<span class="st">.csv"</span> for y <span class="kw">in</span> <span class="fl">2009</span><span class="op">:</span><span class="fl">2011</span>]</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    datasets2 <span class="op">=</span> [<span class="st">"vegetation_header_data_</span><span class="sc">$</span>y<span class="st">.csv"</span> for y <span class="kw">in</span> <span class="fl">2012</span><span class="op">:</span><span class="fl">2022</span>]</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    datasets <span class="op">=</span> <span class="fu">vcat</span>(datasets1, datasets2)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    id_cols <span class="op">=</span> [</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>GpPlotID</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>PlotID</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>EpPlotID, <span class="fl">7</span>)<span class="op">...</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>Ep_PlotID, <span class="fl">4</span>)<span class="op">...</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"EP.PlotID"</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    date_cols <span class="op">=</span> [</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>date_new</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>Datum</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>date, <span class="fl">3</span>)<span class="op">...</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>date_new, <span class="fl">4</span>)<span class="op">...</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>date_bm, <span class="fl">4</span>)<span class="op">...</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date.bm"</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    biomass_cols <span class="op">=</span> [</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>        [<span class="op">:</span>Biomass, <span class="op">:</span>biomass_missing],</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>        [<span class="op">:</span>Biomasse, <span class="op">:</span>biomass_missing],</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>([<span class="op">:</span>biomass_g, <span class="op">:</span>biomass_missing], <span class="fl">10</span>)<span class="op">...</span>,</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>        [<span class="op">:</span>biomass_g_1, <span class="op">:</span>biomass_g_2],</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"biomass.1"</span>, <span class="st">"biomass.2"</span>]</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    dfs <span class="op">=</span> []</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(datasets)</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span> datasets[i], DataFrame;</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>            missingstring <span class="op">=</span> [<span class="st">""</span>, <span class="st">"NA"</span>])</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> !<span class="fu">any</span>([<span class="st">"Datum"</span>, <span class="st">"date"</span>, <span class="st">"date_bm"</span>, <span class="st">"date.bm"</span>] <span class="op">.∈</span> <span class="fu">Ref</span>(<span class="fu">names</span>(df)))</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">"year"</span> <span class="op">∈</span> <span class="fu">names</span>(df)</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>                doy <span class="op">=</span> df.day_of_year</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>                df.day_of_year[<span class="fu">ismissing</span>.(doy)] <span class="op">.=</span> <span class="fu">round</span>(<span class="fu">median</span>(doy[.!<span class="fu">ismissing</span>.(doy)]))</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>                df.date_new <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">Date</span>.(df.year) <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>.(df.day_of_year)</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elseif</span> <span class="st">"Year"</span> <span class="op">∈</span> <span class="fu">names</span>(df)</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>                doy <span class="op">=</span> df.Day_of_year</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>                year <span class="op">=</span> df.Year</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>                df.date_new <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">Date</span>.(year) <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>.(doy)</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="op">:</span>plotID <span class="op">=</span> <span class="fu">convert_id</span>.(<span class="op">$</span>(id_cols[i]))</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@rename</span> <span class="op">:</span>date <span class="op">=</span> <span class="op">$</span>(date_cols[i])</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>            <span class="co">## extract and convert from g/m2 to kg/ha</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="op">:</span>biomass_missing <span class="op">=</span> <span class="cn">NaN</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="op">:</span>biomass1 <span class="op">=</span> <span class="fu">round</span>.(<span class="op">$</span>(biomass_cols[i][<span class="fl">1</span>]) <span class="op">*</span> <span class="fl">10</span>)</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="op">:</span>biomass2 <span class="op">=</span> <span class="fu">round</span>.(<span class="op">$</span>(biomass_cols[i][<span class="fl">2</span>]) <span class="op">*</span> <span class="fl">10</span>)</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="op">:</span>cutting_height <span class="op">=</span> <span class="fl">0.04</span></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@orderby</span> <span class="op">:</span>date</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>date <span class="op">:</span>biomass1 <span class="op">:</span>biomass2 <span class="op">:</span>cutting_height</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unique!</span>(df, [<span class="op">:</span>plotID, <span class="op">:</span>date])</span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(dfs, df)</span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>    concat_dfs <span class="op">=</span> <span class="fu">vcat</span>(dfs<span class="op">...</span>)</span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>    final_df <span class="op">=</span> <span class="pp">@chain</span> <span class="fu">stack</span>(concat_dfs, [<span class="op">:</span>biomass1, <span class="op">:</span>biomass2]) <span class="cf">begin</span></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rsubset</span> !<span class="fu">isnan</span>(<span class="op">:</span>value) <span class="op">&amp;</span> !<span class="fu">ismissing</span>(<span class="op">:</span>date)</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="op">:</span>biomass <span class="op">=</span> <span class="op">:</span>value</span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>stat <span class="op">=</span> <span class="st">"core"</span></span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>date <span class="op">:</span>biomass <span class="op">:</span>cutting_height <span class="op">:</span>stat</span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> final_df</span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sade_biomass</span>(path)</span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a>    datasets <span class="op">=</span> [<span class="st">"biomass_</span><span class="sc">$</span>(y)<span class="st">_sade.csv"</span> for y <span class="kw">in</span> [<span class="fl">2015</span>, <span class="fl">2017</span>]]</span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>    dfs <span class="op">=</span> []</span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(datasets)</span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span> datasets[i], DataFrame;</span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>                    missingstring <span class="op">=</span> [<span class="st">""</span>, <span class="st">"NA"</span>])</span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>        df_transformed <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@subset</span> <span class="op">:</span>treatment <span class="op">.==</span> <span class="st">"control"</span></span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="cf">begin</span></span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span>plotID <span class="op">=</span> <span class="fu">convert_id</span>.(<span class="op">:</span>EpPlotID)</span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span>date <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">Date</span>.(<span class="op">:</span>year) <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>.(<span class="op">:</span>day_of_year_bm)</span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span>biomass <span class="op">=</span> <span class="fu">round</span>.(<span class="op">:</span>biomass_g <span class="op">.*</span> <span class="fl">10</span>)</span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span>cutting_height <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>date <span class="op">:</span>biomass <span class="op">:</span>cutting_height</span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(dfs, df_transformed)</span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a>    final_df <span class="op">=</span> <span class="fu">vcat</span>(dfs<span class="op">...</span>)</span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span>! final_df <span class="op">:</span>stat <span class="op">=</span> <span class="st">"sade"</span></span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> final_df</span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">hedgeII_biomass</span>(path)</span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a>    datasets <span class="op">=</span> [</span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a>        <span class="st">"biomass_2017_hainich_hedgeII.csv"</span>, <span class="co"># Hainich 2017</span></span>
<span id="cb19-117"><a href="#cb19-117" aria-hidden="true" tabindex="-1"></a>        <span class="st">"biomass_2018_alb_hedgeII.csv"</span>  <span class="co"># Alb 2018</span></span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb19-119"><a href="#cb19-119" aria-hidden="true" tabindex="-1"></a>    dates <span class="op">=</span> [</span>
<span id="cb19-120"><a href="#cb19-120" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Dates</span>.<span class="fu">Date</span>(<span class="fl">2017</span>, <span class="fl">05</span>, <span class="fl">31</span>),</span>
<span id="cb19-121"><a href="#cb19-121" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Dates</span>.<span class="fu">Date</span>(<span class="fl">2018</span>, <span class="fl">05</span>, <span class="fl">31</span>)</span>
<span id="cb19-122"><a href="#cb19-122" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb19-123"><a href="#cb19-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-124"><a href="#cb19-124" aria-hidden="true" tabindex="-1"></a>    dfs <span class="op">=</span> []</span>
<span id="cb19-125"><a href="#cb19-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(datasets)</span>
<span id="cb19-126"><a href="#cb19-126" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span> datasets[i], DataFrame;</span>
<span id="cb19-127"><a href="#cb19-127" aria-hidden="true" tabindex="-1"></a>                    missingstring <span class="op">=</span> [<span class="st">""</span>, <span class="st">"NA"</span>])</span>
<span id="cb19-128"><a href="#cb19-128" aria-hidden="true" tabindex="-1"></a>        df_transformed <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb19-129"><a href="#cb19-129" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="cf">begin</span></span>
<span id="cb19-130"><a href="#cb19-130" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span>date <span class="op">=</span> dates[i]</span>
<span id="cb19-131"><a href="#cb19-131" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span>biomass <span class="op">=</span> <span class="fu">round</span>.(<span class="op">:</span>biomass <span class="op">.*</span> <span class="fl">250</span>)</span>
<span id="cb19-132"><a href="#cb19-132" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span>plotID <span class="op">=</span> <span class="op">:</span>plotname</span>
<span id="cb19-133"><a href="#cb19-133" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span>cutting_height <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb19-134"><a href="#cb19-134" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb19-135"><a href="#cb19-135" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@rsubset</span> !<span class="fu">ismissing</span>(<span class="op">:</span>biomass)</span>
<span id="cb19-136"><a href="#cb19-136" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>date <span class="op">:</span>biomass <span class="op">:</span>cutting_height</span>
<span id="cb19-137"><a href="#cb19-137" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb19-138"><a href="#cb19-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-139"><a href="#cb19-139" aria-hidden="true" tabindex="-1"></a>        <span class="fu">disallowmissing!</span>(df_transformed)</span>
<span id="cb19-140"><a href="#cb19-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-141"><a href="#cb19-141" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(dfs, df_transformed)</span>
<span id="cb19-142"><a href="#cb19-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb19-143"><a href="#cb19-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-144"><a href="#cb19-144" aria-hidden="true" tabindex="-1"></a>    final_df <span class="op">=</span> <span class="fu">vcat</span>(dfs<span class="op">...</span>)</span>
<span id="cb19-145"><a href="#cb19-145" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span>! final_df <span class="op">:</span>stat <span class="op">=</span> <span class="st">"hedgeII"</span></span>
<span id="cb19-146"><a href="#cb19-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> final_df</span>
<span id="cb19-147"><a href="#cb19-147" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb19-148"><a href="#cb19-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-149"><a href="#cb19-149" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sat_biomass</span>(path)</span>
<span id="cb19-150"><a href="#cb19-150" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span> <span class="st">"biomass_from_sentinel.csv"</span>, DataFrame)</span>
<span id="cb19-151"><a href="#cb19-151" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rename</span>! df <span class="cf">begin</span></span>
<span id="cb19-152"><a href="#cb19-152" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>satellite_mean <span class="op">=</span> <span class="op">:</span>biomass_kg_ha</span>
<span id="cb19-153"><a href="#cb19-153" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>satellite_min <span class="op">=</span> <span class="op">:</span>biomass_kg_ha_min</span>
<span id="cb19-154"><a href="#cb19-154" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>satellite_max <span class="op">=</span> <span class="op">:</span>biomass_kg_ha_max</span>
<span id="cb19-155"><a href="#cb19-155" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb19-156"><a href="#cb19-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-157"><a href="#cb19-157" aria-hidden="true" tabindex="-1"></a>    df_stack <span class="op">=</span> <span class="fu">stack</span>(df, [<span class="op">:</span>satellite_mean, <span class="op">:</span>satellite_min, <span class="op">:</span>satellite_max];</span>
<span id="cb19-158"><a href="#cb19-158" aria-hidden="true" tabindex="-1"></a>                     variable_name <span class="op">=</span> <span class="op">:</span>stat, value_name <span class="op">=</span> <span class="op">:</span>biomass)</span>
<span id="cb19-159"><a href="#cb19-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-160"><a href="#cb19-160" aria-hidden="true" tabindex="-1"></a>    df_final <span class="op">=</span> <span class="pp">@chain</span> df_stack <span class="cf">begin</span></span>
<span id="cb19-161"><a href="#cb19-161" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>cutting_height <span class="op">=</span> <span class="fl">0.04</span></span>
<span id="cb19-162"><a href="#cb19-162" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>date <span class="op">:</span>biomass <span class="op">:</span>cutting_height <span class="op">:</span>stat</span>
<span id="cb19-163"><a href="#cb19-163" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb19-164"><a href="#cb19-164" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_final</span>
<span id="cb19-165"><a href="#cb19-165" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb19-166"><a href="#cb19-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-167"><a href="#cb19-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-168"><a href="#cb19-168" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb19-169"><a href="#cb19-169" aria-hidden="true" tabindex="-1"></a>    data_path <span class="op">=</span> <span class="st">"../data/"</span></span>
<span id="cb19-170"><a href="#cb19-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-171"><a href="#cb19-171" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="fu">vcat</span>(<span class="fu">core_biomass</span>(data_path), <span class="fu">sade_biomass</span>(data_path),</span>
<span id="cb19-172"><a href="#cb19-172" aria-hidden="true" tabindex="-1"></a>              <span class="fu">sat_biomass</span>(data_path), <span class="fu">hedgeII_biomass</span>(data_path))</span>
<span id="cb19-173"><a href="#cb19-173" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="pp">@orderby</span> df <span class="op">:</span>plotID <span class="op">:</span>date</span>
<span id="cb19-174"><a href="#cb19-174" aria-hidden="true" tabindex="-1"></a>    <span class="fu">disallowmissing!</span>(df)</span>
<span id="cb19-175"><a href="#cb19-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-176"><a href="#cb19-176" aria-hidden="true" tabindex="-1"></a>    biomass_file <span class="op">=</span> <span class="st">"measured_biomass.csv"</span></span>
<span id="cb19-177"><a href="#cb19-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-178"><a href="#cb19-178" aria-hidden="true" tabindex="-1"></a>    <span class="co"># @info "$biomass_file"</span></span>
<span id="cb19-179"><a href="#cb19-179" aria-hidden="true" tabindex="-1"></a>    CSV.<span class="fu">write</span>(biomass_file, df)</span>
<span id="cb19-180"><a href="#cb19-180" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb19-181"><a href="#cb19-181" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Details on getting the measured vegetation height">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Details on getting the measured vegetation height
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The measured vegetation height data was processed with the following script:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">CSV</span>, <span class="bu">Dates</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">DataFramesMeta</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">convert_id</span>(id)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="fu">first</span>.(id, <span class="fl">3</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">chop</span>(id, head <span class="op">=</span> <span class="fl">3</span>, tail <span class="op">=</span> <span class="fl">0</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">lpad</span>(b, <span class="fl">2</span>, <span class="st">"0"</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> b</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">core_height</span>(path)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    datasets <span class="op">=</span> [</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"vegetation_2012.csv"</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"biomass_2013.csv"</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"biomass_2014.csv"</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"vegetation_2015.csv"</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"biomass_2016.csv"</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"biomass_2017.csv"</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"biomass_2018.csv"</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"biomass_2019.csv"</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"biomass_2020.csv"</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"biomass_2021.csv"</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"biomass_2022.csv"</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    id_cols <span class="op">=</span> [</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>EpPlotID, <span class="fl">6</span>)<span class="op">...</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>Ep_PlotID, <span class="fl">4</span>)<span class="op">...</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"EP.PlotID"</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    date_cols <span class="op">=</span> [</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>date, <span class="fl">2</span>)<span class="op">...</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>date_new, <span class="fl">4</span>)<span class="op">...</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>date_bm, <span class="fl">4</span>)<span class="op">...</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"date.bm"</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>    veg_height <span class="op">=</span> [</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>([<span class="op">:</span>v_height_1_cm, <span class="op">:</span>v_height_2_cm,</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>              <span class="op">:</span>v_height_3_cm, <span class="op">:</span>v_height_4_cm], <span class="fl">2</span>)<span class="op">...</span>,</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>([<span class="op">:</span>vegetation_height_mean_cm, <span class="op">:</span>height_missing,</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>              <span class="op">:</span>height_missing, <span class="op">:</span>height_missing], <span class="fl">7</span>)<span class="op">...</span>,</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>        [<span class="op">:</span>vegetation_height_mean_cm_1, <span class="op">:</span>vegetation_height_mean_cm_2,</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>         <span class="op">:</span>height_missing, <span class="op">:</span>height_missing],</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"vegetation.height.1"</span>, <span class="st">"vegetation.height.2"</span>, <span class="op">:</span>height_missing, <span class="op">:</span>height_missing]</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    dfs <span class="op">=</span> []</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(datasets)</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span> datasets[i], DataFrame;</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>            missingstring <span class="op">=</span> [<span class="st">""</span>, <span class="st">"NA"</span>])</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> !<span class="fu">any</span>([<span class="st">"Datum"</span>, <span class="st">"date"</span>, <span class="st">"date_bm"</span>, <span class="st">"date.bm"</span>] <span class="op">.∈</span> <span class="fu">Ref</span>(<span class="fu">names</span>(df)))</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">"year"</span> <span class="op">∈</span> <span class="fu">names</span>(df)</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>                doy <span class="op">=</span> df.day_of_year</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>                df.day_of_year[<span class="fu">ismissing</span>.(doy)] <span class="op">.=</span> <span class="fu">round</span>(<span class="fu">median</span>(doy[.!<span class="fu">ismissing</span>.(doy)]))</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>                df.date_new <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">Date</span>.(df.year) <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>.(df.day_of_year)</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elseif</span> <span class="st">"Year"</span> <span class="op">∈</span> <span class="fu">names</span>(df)</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>                doy <span class="op">=</span> df.Day_of_year</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>                year <span class="op">=</span> df.Year</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>                df.date_new <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">Date</span>.(year) <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>.(doy)</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>        df[!, <span class="op">:</span>height_missing] <span class="op">.=</span> <span class="cn">NaN</span></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="cf">begin</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span>plotID <span class="op">=</span> <span class="fu">convert_id</span>.(<span class="op">$</span>(id_cols[i]))</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span>height1 <span class="op">=</span> <span class="op">$</span>(veg_height[i][<span class="fl">1</span>])</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span>height2 <span class="op">=</span> <span class="op">$</span>(veg_height[i][<span class="fl">2</span>])</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span>height3 <span class="op">=</span> <span class="op">$</span>(veg_height[i][<span class="fl">3</span>])</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span>height4 <span class="op">=</span> <span class="op">$</span>(veg_height[i][<span class="fl">4</span>])</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@rename</span> <span class="op">:</span>date <span class="op">=</span> <span class="op">$</span>(date_cols[i])</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@orderby</span> <span class="op">:</span>date</span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>date <span class="op">:</span>height1 <span class="op">:</span>height2 <span class="op">:</span>height3 <span class="op">:</span>height4</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unique!</span>(df, [<span class="op">:</span>plotID, <span class="op">:</span>date])</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(dfs, df)</span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>    concat_dfs <span class="op">=</span> <span class="fu">vcat</span>(dfs<span class="op">...</span>)</span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>    final_df <span class="op">=</span> <span class="pp">@chain</span> <span class="fu">stack</span>(concat_dfs, [<span class="op">:</span>height1, <span class="op">:</span>height2, <span class="op">:</span>height3, <span class="op">:</span>height4]) <span class="cf">begin</span></span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rsubset</span> !<span class="fu">isnan</span>(<span class="op">:</span>value) <span class="op">&amp;</span> !<span class="fu">ismissing</span>(<span class="op">:</span>date)</span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>height <span class="op">=</span> <span class="fu">round</span>.(<span class="op">:</span>value <span class="op">./</span> <span class="fl">100</span>; digits <span class="op">=</span> <span class="fl">3</span>)</span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>plotID <span class="op">:</span>date</span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>date <span class="op">:</span>height</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">disallowmissing!</span>(final_df)</span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> final_df</span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> <span class="st">"../data/"</span></span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="fu">core_height</span>(path)</span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> <span class="st">"measured_height.csv"</span></span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move to assets/data/validation</span></span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a>    CSV.<span class="fu">write</span>(output_path, df)</span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="community-weighted-mean-traits" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="community-weighted-mean-traits"><span class="header-section-number">3.2</span> Community weighted mean traits</h3>
<p>Vegetation data was subsetted to 2009 - 2002. The exact date of the vegetation records is not available in <span class="citation" data-cites="explo31389v7">Hinderling and Keller (<a href="#ref-explo31389v7" role="doc-biblioref">2023</a>)</span>, therefore the dates of the vegetation sampling were used from the header data sets.</p>
<p>Species mean trait values were calculated from the raw trait data sets.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Details on calculating the community weighted mean traits">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Details on calculating the community weighted mean traits
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The community weighted mean traits were calculated with the following script:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>2_cwm_traits.jl</strong></pre>
</div>
<div class="sourceCode" id="cb21" data-filename="2_cwm_traits.jl"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">include</span>(<span class="st">"0_functions_load_traits.jl"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">##### load tables</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>data_path <span class="op">=</span> <span class="st">"../data/"</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>cwm_output_path <span class="op">=</span> <span class="st">"cwm_traits.csv"</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>veg_df, veg_species_df <span class="op">=</span> <span class="fu">load_veg_df</span>(data_path)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>df_leaf <span class="op">=</span> <span class="fu">bexis_leaf_traits</span>(data_path)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>df_root <span class="op">=</span> <span class="fu">bexis_root_traits</span>(data_path)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>df_try <span class="op">=</span> <span class="fu">load_lnc_try</span>(data_path)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>df_maxheight <span class="op">=</span> CSV.<span class="fu">read</span>(data_path <span class="op">*</span> <span class="st">"maxheight_rothmaler.csv"</span>, DataFrame)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="pp">@transform</span>! df_maxheight <span class="op">:</span>maxheight <span class="op">=</span> <span class="op">:</span>maxheight <span class="op">.*</span> u<span class="st">"m"</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="pp">@select</span>! df_maxheight <span class="op">:</span>species <span class="op">:</span>maxheight</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">##### create trait tables for all species in vegetation dataset</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>df_bexis <span class="op">=</span> <span class="pp">@chain</span> <span class="fu">outerjoin</span>(df_leaf, df_root, on <span class="op">=</span> <span class="op">:</span>species, makeunique <span class="op">=</span> <span class="cn">true</span>) <span class="cf">begin</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rtransform</span> <span class="op">:</span>sla <span class="op">=</span> <span class="fu">uconvert</span>(u<span class="st">"m^2 / g"</span>, <span class="fu">mean_missing</span>(<span class="op">:</span>sla1, <span class="op">:</span>sla2))</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@select</span> <span class="op">$</span>(<span class="fu">Not</span>([<span class="op">:</span>sla1, <span class="op">:</span>sla2, <span class="op">:</span>LA, <span class="op">:</span>LDM, <span class="op">:</span>leaf_species_orig, <span class="op">:</span>root_species_orig]))</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>veg_trait_df <span class="op">=</span> <span class="pp">@chain</span> veg_species_df <span class="cf">begin</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leftjoin</span>(df_bexis; on <span class="op">=</span> <span class="op">:</span>species)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leftjoin</span>(df_maxheight; on <span class="op">=</span> <span class="op">:</span>species)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leftjoin</span>(df_try; on <span class="op">=</span> <span class="op">:</span>species)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rsubset</span> <span class="op">:</span>maxheight <span class="op">&lt;=</span> <span class="fl">2.0</span>u<span class="st">"m"</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@orderby</span> <span class="op">:</span>species</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>veg_trait_final_df <span class="op">=</span> <span class="pp">@chain</span> veg_trait_df <span class="cf">begin</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="op">:</span>species <span class="op">=</span> <span class="op">:</span>veg_orig_name</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@select</span> <span class="op">$</span>(<span class="fu">Not</span>(<span class="op">:</span>veg_orig_name))</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="co">######### join trait and species cover data</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">cwm_missing</span>(trait_vals, cover_vals)</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    f <span class="op">=</span> .! <span class="fu">ismissing</span>.(trait_vals)</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(cover_vals[f] <span class="op">.*</span> trait_vals[f] <span class="op">./</span> <span class="fu">sum</span>(cover_vals[f]))</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">cwm_quality</span>(trait_vals, cover_vals)</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    f <span class="op">=</span> .! <span class="fu">ismissing</span>.(trait_vals)</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(cover_vals <span class="op">.*</span> f <span class="op">./</span> <span class="fu">sum</span>(cover_vals))</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">functional_dispersion</span>(trait_vec, cover_vals;)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Laliberté &amp; Legendre 2010</span></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    trait_matrix <span class="op">=</span> <span class="fu">hcat</span>(trait_vec<span class="op">...</span>)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    traits_missing <span class="op">=</span> <span class="fu">ismissing</span>.(trait_matrix)</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>    species_filter <span class="op">=</span> <span class="fu">iszero</span>.(<span class="fu">vec</span>(<span class="fu">sum</span>(traits_missing; dims <span class="op">=</span> <span class="fl">2</span>)))</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>    trait_matrix <span class="op">=</span> trait_matrix[species_filter, <span class="op">:</span>]</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>    cover_vals <span class="op">=</span> cover_vals[species_filter]</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>    nspecies, ntraits <span class="op">=</span> <span class="fu">size</span>(trait_matrix)</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    z_squarred <span class="op">=</span> <span class="fu">zeros</span>(nspecies)</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>ntraits</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>        trait_vals <span class="op">=</span> trait_matrix[<span class="op">:</span>, t]</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>        trait_vals <span class="op">=</span> trait_vals <span class="op">./</span> <span class="fu">mean</span>(trait_vals)</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>        cwm <span class="op">=</span> <span class="fu">sum</span>(cover_vals <span class="op">.*</span> trait_vals <span class="op">./</span> <span class="fu">sum</span>(cover_vals))</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>        z_squarred <span class="op">.+=</span> (trait_vals <span class="op">.-</span> cwm) <span class="op">.^</span> <span class="fl">2</span></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> <span class="fu">sqrt</span>.(z_squarred)</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>    relative_cover <span class="op">=</span> cover_vals <span class="op">./</span> <span class="fu">sum</span>(cover_vals)</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">sum</span>(z <span class="op">.*</span> relative_cover)</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>cwm_veg_df <span class="op">=</span> <span class="pp">@chain</span> veg_df <span class="cf">begin</span></span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leftjoin</span>(veg_trait_final_df, on <span class="op">=</span> <span class="op">:</span>species)</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@groupby</span> <span class="op">:</span>plotID <span class="op">:</span>year</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@combine</span> <span class="cf">begin</span></span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>rsa <span class="op">=</span> <span class="fu">cwm_missing</span>(<span class="op">:</span>srsa, <span class="op">:</span>cover)</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>amc <span class="op">=</span> <span class="fu">cwm_missing</span>(<span class="op">:</span>amc, <span class="op">:</span>cover)</span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>abp <span class="op">=</span> <span class="fu">cwm_missing</span>(<span class="op">:</span>abp, <span class="op">:</span>cover)</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>sla <span class="op">=</span> <span class="fu">cwm_missing</span>(<span class="op">:</span>sla, <span class="op">:</span>cover)</span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>maxheight <span class="op">=</span> <span class="fu">cwm_missing</span>(<span class="op">:</span>maxheight, <span class="op">:</span>cover)</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>lnc <span class="op">=</span> <span class="fu">cwm_missing</span>(<span class="op">:</span>lnc, <span class="op">:</span>cover)</span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>fdis <span class="op">=</span> <span class="fu">functional_dispersion</span>([<span class="op">:</span>srsa, <span class="op">:</span>amc, <span class="op">:</span>abp, <span class="op">:</span>sla, <span class="op">:</span>maxheight, <span class="op">:</span>lnc], <span class="op">:</span>cover) <span class="co">#</span></span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>        <span class="co"># :srsa_quality = cwm_quality(:srsa, :cover)</span></span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>        <span class="co"># :amc_quality = cwm_quality(:amc, :cover)</span></span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>        <span class="co"># :abp_quality = cwm_quality(:abp, :cover)</span></span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># :sla_quality = cwm_quality(:sla, :cover)</span></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>        <span class="co"># :height_quality = cwm_quality(:height, :cover)</span></span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>        <span class="co"># :lnc_quality = cwm_quality(:lnc, :cover)</span></span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@orderby</span> <span class="op">:</span>plotID <span class="op">:</span>year</span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a><span class="co">##### join vegetation date</span></span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>veg_date_df <span class="op">=</span> <span class="fu">load_vegetation_date_df</span>(data_path)</span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a>cwm_veg_df <span class="op">=</span> <span class="pp">@chain</span> cwm_veg_df <span class="cf">begin</span></span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@subset</span> <span class="fl">2009</span> <span class="op">.&lt;=</span> <span class="op">:</span>year <span class="op">.&lt;=</span> <span class="fl">2021</span></span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leftjoin</span>(veg_date_df, on <span class="op">=</span> [<span class="op">:</span>year, <span class="op">:</span>plotID])</span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a><span class="fu">disallowmissing!</span>(cwm_veg_df)</span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a><span class="co">##### write output without units</span></span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a>cwm_veg_wo_units_df <span class="op">=</span> <span class="pp">@rtransform</span> cwm_veg_df <span class="cf">begin</span></span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span>rsa <span class="op">=</span> <span class="fu">ustrip</span>(<span class="op">:</span>rsa)</span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span>sla <span class="op">=</span> <span class="fu">ustrip</span>(<span class="op">:</span>sla)</span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span>maxheight <span class="op">=</span> <span class="fu">ustrip</span>(<span class="op">:</span>maxheight)</span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span>lnc <span class="op">=</span> <span class="fu">ustrip</span>(<span class="op">:</span>lnc)</span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a>CSV.<span class="fu">write</span>(cwm_output_path, cwm_veg_wo_units_df)</span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a><span class="co">##### read file and add units</span></span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a><span class="pp">@chain</span> CSV.<span class="fu">read</span>(cwm_output_path, DataFrame) <span class="cf">begin</span></span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span> <span class="cf">begin</span></span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>srsa <span class="op">=</span> <span class="op">:</span>srsa <span class="op">*</span> u<span class="st">"m^2 / g"</span></span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>sla <span class="op">=</span> <span class="op">:</span>sla <span class="op">*</span> u<span class="st">"m^2 / g"</span></span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>height <span class="op">=</span> <span class="op">:</span>height <span class="op">*</span> u<span class="st">"m"</span></span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>lnc <span class="op">=</span> <span class="op">:</span>lnc <span class="op">*</span> u<span class="st">"mg / g"</span></span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb21-119"><a href="#cb21-119" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The functions for loading the trait data are described in the following script:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>0_functions_load_traits.jl</strong></pre>
</div>
<div class="sourceCode" id="cb22" data-filename="0_functions_load_traits.jl"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">DataFramesMeta</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RCall</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">CSV</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">Dates</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">mean_missing</span>(x1, x2)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">ismissing</span>(x1)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x2</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elseif</span> <span class="fu">ismissing</span>(x2)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x1</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">mean</span>([x1, x2])</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">bexis_leaf_traits</span>(path)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@info</span> <span class="st">"Loading bexis leaf traits"</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span> <span class="st">"leaf_traits.csv"</span>, DataFrame;</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>        missingstring<span class="op">=</span><span class="st">"NA"</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LA: leaf area [mm²]</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LFM: leaf fresh mass [g]</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LDM: leaf dry weight [g]</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>system <span class="op">.==</span> <span class="st">"grassland"</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="cf">begin</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>LA <span class="op">=</span> <span class="op">:</span>total_area <span class="op">*</span> u<span class="st">"mm^2"</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>LDM <span class="op">=</span> <span class="op">:</span>dry_weight <span class="op">*</span> u<span class="st">"g"</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>leaf_species_orig <span class="op">=</span> <span class="op">:</span>pl_species</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>leaf_species <span class="op">=</span> <span class="op">:</span>pl_species</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="op">:</span>plotID <span class="op">=</span> <span class="op">:</span>plotid_withzero</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>leaf_species <span class="op">.∉</span> <span class="fu">Ref</span>([<span class="st">"Crataegus sp"</span>, <span class="st">"Secale sp"</span>])</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>leaf_species <span class="op">:</span>leaf_species_orig <span class="op">:</span>LA <span class="op">:</span>LDM</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rsubset</span> !(<span class="fu">ismissing</span>(<span class="op">:</span>LA) <span class="op">||</span> <span class="fu">ismissing</span>(<span class="op">:</span>LDM))</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">disallowmissing!</span>(df)</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>    df[df.leaf_species <span class="op">.==</span> <span class="st">"Festuca pratensis"</span>, <span class="op">:</span>leaf_species] <span class="op">.=</span> <span class="st">"Lolium pratense (Huds.) Darbysh."</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>    df[df.leaf_species <span class="op">.==</span> <span class="st">"Festuca arundinacea"</span>, <span class="op">:</span>leaf_species] <span class="op">.=</span> <span class="st">"Lolium arundinaceum (Schreb.) Darbysh."</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    df[df.leaf_species <span class="op">.==</span> <span class="st">"Taraxacum sp"</span>, <span class="op">:</span>leaf_species] <span class="op">.=</span> <span class="st">"Taraxacum officinale F.H.Wigg."</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>    df[df.leaf_species <span class="op">.==</span> <span class="st">"Prunella sp"</span>, <span class="op">:</span>leaf_species] <span class="op">.=</span> <span class="st">"Prunella vulgaris L."</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>    df[df.leaf_species <span class="op">.==</span> <span class="st">"Primula elatior veris agg"</span>, <span class="op">:</span>leaf_species] <span class="op">.=</span> <span class="st">"Primula elatior Hill"</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>    df[df.leaf_species <span class="op">.==</span> <span class="st">"Bromus hordeaceus agg incl. B. commutatus"</span>, <span class="op">:</span>leaf_species] <span class="op">.=</span> <span class="st">"Bromus hordeaceus L."</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>    df[df.leaf_species <span class="op">.==</span> <span class="st">"Rhinanthus agg"</span>, <span class="op">:</span>leaf_species] <span class="op">.=</span> <span class="st">"Rhinanthus minor L."</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>    leaf_species <span class="op">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(df.leaf_species))</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># [println(s) for s in sort(unique(leaf_species))];</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rput</span> leaf_species</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>    R<span class="st">"""</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a><span class="st">    library(TNRS)</span></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a><span class="st">    leaf_species_df&lt;- TNRS(leaf_species)</span></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a><span class="st">    NaN</span></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rget</span> leaf_species_df</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>    leaf_species_df <span class="op">=</span> <span class="pp">@chain</span> leaf_species_df <span class="cf">begin</span></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>leaf_species <span class="op">=</span> <span class="op">:</span>Name_submitted</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>species <span class="op">=</span> <span class="op">:</span>Accepted_species</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>species <span class="op">:</span>leaf_species</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>        <span class="fu">leftjoin</span>(leaf_species_df, on <span class="op">=</span> <span class="op">:</span>leaf_species)</span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@groupby</span> <span class="op">:</span>species</span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@combine</span> <span class="cf">begin</span></span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>leaf_species_orig <span class="op">=</span> <span class="fu">first</span>(<span class="op">:</span>leaf_species_orig)</span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>LA <span class="op">=</span> <span class="fu">median</span>(<span class="op">:</span>LA)</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>LDM <span class="op">=</span> <span class="fu">median</span>(<span class="op">:</span>LDM)</span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>species</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>sla1 <span class="op">=</span> <span class="op">:</span>LA <span class="op">./</span> <span class="op">:</span>LDM</span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">bexis_root_traits</span>(path)</span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@info</span> <span class="st">"Loading bexis root traits"</span></span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> CSV.<span class="fu">read</span>(data_path <span class="op">*</span> <span class="st">"root_traits.csv"</span>, DataFrame;</span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>        missingstring<span class="op">=</span><span class="st">"NA"</span>)</span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="op">:</span>root_species_orig <span class="op">=</span> <span class="op">:</span>species</span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>species <span class="op">=</span> <span class="fu">convert</span>.(<span class="dt">String</span>, <span class="op">:</span>root_species_orig)</span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a>    df[df.species <span class="op">.==</span> <span class="st">"Festuca_pratensis"</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Lolium pratense (Huds.) Darbysh."</span></span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a>    df[df.species <span class="op">.==</span> <span class="st">"Festuca_arundinacea"</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Lolium arundinaceum (Schreb.) Darbysh."</span></span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a>    root_species <span class="op">=</span> df.species</span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># [println(s) for s in root_species];</span></span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rput</span> root_species</span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>    R<span class="st">"""</span></span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a><span class="st">    library(TNRS)</span></span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a><span class="st">    root_species_df&lt;- TNRS(root_species)</span></span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a><span class="st">    NaN</span></span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rget</span> root_species_df</span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># BA:</span></span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   below ground dry biomass / aboveground dry biomass</span></span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   [ratio area/mass]</span></span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># SRSA:</span></span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   root surface area / root dry biomass</span></span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   [m²/g]</span></span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># AMC:</span></span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   arbuscular mycorrhizal colonisation of the entire root system</span></span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   [fraction, 0 to 1]</span></span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="cf">begin</span></span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>species <span class="op">=</span> root_species_df.Accepted_species</span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>ba <span class="op">=</span> <span class="op">:</span>biomass_allocation</span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>srsa <span class="op">=</span> <span class="op">:</span>SRSA <span class="op">*</span> u<span class="st">"m^2 / g"</span></span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>amc <span class="op">=</span> <span class="op">:</span>col</span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>sla2 <span class="op">=</span> <span class="op">:</span>SLA <span class="op">*</span> u<span class="st">"cm^2 / g"</span></span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>abp <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">+</span> <span class="op">:</span>ba)</span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rtransform</span> <span class="op">:</span>bbp <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="op">:</span>abp</span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>species</span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>species <span class="op">:</span>root_species_orig <span class="op">:</span>srsa <span class="op">:</span>amc <span class="op">:</span>sla2 <span class="op">:</span>abp <span class="op">:</span>bbp</span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">LEDA_height</span>(path)</span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">isfile</span>(path <span class="op">*</span>  <span class="st">"canopy_height_LEDA.csv"</span>)</span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span>  <span class="st">"canopy_height_LEDA.csv"</span>, DataFrame)</span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span>! df <span class="op">:</span>height <span class="op">=</span> <span class="op">:</span>height <span class="op">*</span> u<span class="st">"m"</span></span>
<span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span>! df .! <span class="fu">ismissing</span>.(<span class="op">:</span>species)</span>
<span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-135"><a href="#cb22-135" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@info</span> <span class="st">"Loading leada height"</span></span>
<span id="cb22-136"><a href="#cb22-136" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">data_available</span>(data)</span>
<span id="cb22-137"><a href="#cb22-137" aria-hidden="true" tabindex="-1"></a>        f <span class="op">=</span> <span class="fu">isa</span>.(data, <span class="dt">Number</span>)</span>
<span id="cb22-138"><a href="#cb22-138" aria-hidden="true" tabindex="-1"></a>        f[f] <span class="op">.=</span> .! <span class="fu">isnan</span>.(data[f]) <span class="op">.&amp;&amp;</span> <span class="cn">Inf</span> <span class="op">.&gt;</span> data[f] <span class="op">.&gt;</span> <span class="fl">0</span></span>
<span id="cb22-139"><a href="#cb22-139" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> f</span>
<span id="cb22-140"><a href="#cb22-140" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb22-141"><a href="#cb22-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-142"><a href="#cb22-142" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span>  <span class="st">"LEDA/canopy_height.txt"</span>, DataFrame;</span>
<span id="cb22-143"><a href="#cb22-143" aria-hidden="true" tabindex="-1"></a>        missingstring<span class="op">=</span>[<span class="st">""</span>, <span class="st">"NA"</span>],</span>
<span id="cb22-144"><a href="#cb22-144" aria-hidden="true" tabindex="-1"></a>        delim<span class="op">=</span><span class="st">";"</span>)</span>
<span id="cb22-145"><a href="#cb22-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-146"><a href="#cb22-146" aria-hidden="true" tabindex="-1"></a>    df[!, <span class="op">:</span>height] <span class="op">.=</span> <span class="cn">NaN</span></span>
<span id="cb22-147"><a href="#cb22-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-148"><a href="#cb22-148" aria-hidden="true" tabindex="-1"></a>    <span class="co">### Use single values</span></span>
<span id="cb22-149"><a href="#cb22-149" aria-hidden="true" tabindex="-1"></a>    f1 <span class="op">=</span> <span class="fu">data_available</span>(df[<span class="op">:</span>, <span class="st">"single value [m]"</span>])</span>
<span id="cb22-150"><a href="#cb22-150" aria-hidden="true" tabindex="-1"></a>    df[f1, <span class="op">:</span>height] <span class="op">.=</span> df[f1, <span class="st">"single value [m]"</span>]</span>
<span id="cb22-151"><a href="#cb22-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-152"><a href="#cb22-152" aria-hidden="true" tabindex="-1"></a>    <span class="co">### even better mean values</span></span>
<span id="cb22-153"><a href="#cb22-153" aria-hidden="true" tabindex="-1"></a>    f1 <span class="op">=</span> <span class="fu">data_available</span>(df[<span class="op">:</span>, <span class="st">"mean CH [m]"</span>])</span>
<span id="cb22-154"><a href="#cb22-154" aria-hidden="true" tabindex="-1"></a>    df[f1, <span class="op">:</span>height] <span class="op">.=</span> df[f1, <span class="st">"mean CH [m]"</span>]</span>
<span id="cb22-155"><a href="#cb22-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-156"><a href="#cb22-156" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rename</span>! df <span class="op">:</span>species_leda <span class="op">=</span> <span class="op">$</span>(<span class="fu">Symbol</span>(<span class="st">"SBS name"</span>))</span>
<span id="cb22-157"><a href="#cb22-157" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span>! df <span class="op">:</span>leda_species_orig <span class="op">=</span> <span class="op">:</span>species_leda</span>
<span id="cb22-158"><a href="#cb22-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-159"><a href="#cb22-159" aria-hidden="true" tabindex="-1"></a>    df[df.species_leda <span class="op">.==</span> <span class="st">"Festuca pratensis"</span>, <span class="op">:</span>species_leda] <span class="op">.=</span> <span class="st">"Lolium pratense (Huds.) Darbysh."</span></span>
<span id="cb22-160"><a href="#cb22-160" aria-hidden="true" tabindex="-1"></a>    df[df.species_leda <span class="op">.==</span> <span class="st">"Festuca pratensis s. apennina"</span>, <span class="op">:</span>species_leda] <span class="op">.=</span> <span class="st">"Festuca pratensis subsp. apennina(De Not.) Hegi"</span></span>
<span id="cb22-161"><a href="#cb22-161" aria-hidden="true" tabindex="-1"></a>    df[df.species_leda <span class="op">.==</span> <span class="st">"Festuca arundinacea"</span>, <span class="op">:</span>species_leda] <span class="op">.=</span> <span class="st">"Lolium arundinaceum (Schreb.) Darbysh."</span></span>
<span id="cb22-162"><a href="#cb22-162" aria-hidden="true" tabindex="-1"></a>    df[df.species_leda <span class="op">.==</span> <span class="st">"Senecio jacobaea"</span>, <span class="op">:</span>species_leda] <span class="op">.=</span> <span class="st">"Senecio vulgaris L."</span></span>
<span id="cb22-163"><a href="#cb22-163" aria-hidden="true" tabindex="-1"></a>    df[df.species_leda <span class="op">.==</span> <span class="st">"Taraxacum Sec. Ruderalia"</span>, <span class="op">:</span>species_leda] <span class="op">.=</span> <span class="st">"Taraxacum officinale F.H.Wigg."</span></span>
<span id="cb22-164"><a href="#cb22-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-165"><a href="#cb22-165" aria-hidden="true" tabindex="-1"></a>    leda_species <span class="op">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(df.species_leda))</span>
<span id="cb22-166"><a href="#cb22-166" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rput</span> leda_species</span>
<span id="cb22-167"><a href="#cb22-167" aria-hidden="true" tabindex="-1"></a>    R<span class="st">"""</span></span>
<span id="cb22-168"><a href="#cb22-168" aria-hidden="true" tabindex="-1"></a><span class="st">    library(TNRS)</span></span>
<span id="cb22-169"><a href="#cb22-169" aria-hidden="true" tabindex="-1"></a><span class="st">    leda_species_df &lt;- TNRS(leda_species)</span></span>
<span id="cb22-170"><a href="#cb22-170" aria-hidden="true" tabindex="-1"></a><span class="st">    NaN</span></span>
<span id="cb22-171"><a href="#cb22-171" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb22-172"><a href="#cb22-172" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rget</span> leda_species_df</span>
<span id="cb22-173"><a href="#cb22-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-174"><a href="#cb22-174" aria-hidden="true" tabindex="-1"></a>    leda_species_df <span class="op">=</span> <span class="pp">@chain</span> leda_species_df <span class="cf">begin</span></span>
<span id="cb22-175"><a href="#cb22-175" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb22-176"><a href="#cb22-176" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>species_leda <span class="op">=</span> <span class="op">:</span>Name_submitted</span>
<span id="cb22-177"><a href="#cb22-177" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>species <span class="op">=</span> <span class="op">:</span>Accepted_species</span>
<span id="cb22-178"><a href="#cb22-178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-179"><a href="#cb22-179" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>species <span class="op">:</span>species_leda</span>
<span id="cb22-180"><a href="#cb22-180" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-181"><a href="#cb22-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-182"><a href="#cb22-182" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb22-183"><a href="#cb22-183" aria-hidden="true" tabindex="-1"></a>        <span class="fu">leftjoin</span>(leda_species_df, on <span class="op">=</span> <span class="op">:</span>species_leda)</span>
<span id="cb22-184"><a href="#cb22-184" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@groupby</span> <span class="op">:</span>species</span>
<span id="cb22-185"><a href="#cb22-185" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@combine</span> <span class="cf">begin</span></span>
<span id="cb22-186"><a href="#cb22-186" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>species_leda <span class="op">=</span> <span class="fu">first</span>(<span class="op">:</span>species_leda)</span>
<span id="cb22-187"><a href="#cb22-187" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>height <span class="op">=</span> <span class="fu">median</span>(<span class="op">:</span>height)</span>
<span id="cb22-188"><a href="#cb22-188" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-189"><a href="#cb22-189" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-190"><a href="#cb22-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-191"><a href="#cb22-191" aria-hidden="true" tabindex="-1"></a>    CSV.<span class="fu">write</span>(path <span class="op">*</span>  <span class="st">"LEDA/canopy_height_sub.csv"</span>, df)</span>
<span id="cb22-192"><a href="#cb22-192" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span>! df <span class="op">:</span>height <span class="op">=</span> <span class="op">:</span>height <span class="op">*</span> u<span class="st">"m"</span></span>
<span id="cb22-193"><a href="#cb22-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-194"><a href="#cb22-194" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb22-195"><a href="#cb22-195" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb22-196"><a href="#cb22-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-197"><a href="#cb22-197" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">manual_height!</span>(df)</span>
<span id="cb22-198"><a href="#cb22-198" aria-hidden="true" tabindex="-1"></a>    species_without_height <span class="op">=</span> [<span class="st">"Poa trivialis"</span>, <span class="st">"Helictotrichon pubescens"</span>,</span>
<span id="cb22-199"><a href="#cb22-199" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Veronica teucrium"</span>, <span class="st">"Tripleurospermum inodorum"</span>, <span class="st">"Rumex acetosella"</span>,</span>
<span id="cb22-200"><a href="#cb22-200" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Medicago falcata"</span>, <span class="st">"Carex vulpina"</span>]</span>
<span id="cb22-201"><a href="#cb22-201" aria-hidden="true" tabindex="-1"></a>    new_height <span class="op">=</span> [<span class="fl">0.3</span>, <span class="fl">0.6</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>]u<span class="st">"m"</span></span>
<span id="cb22-202"><a href="#cb22-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-203"><a href="#cb22-203" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(new_height)</span>
<span id="cb22-204"><a href="#cb22-204" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> species_without_height[i]</span>
<span id="cb22-205"><a href="#cb22-205" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> new_height[i]</span>
<span id="cb22-206"><a href="#cb22-206" aria-hidden="true" tabindex="-1"></a>        df[df.species <span class="op">.==</span> s, <span class="op">:</span>height] <span class="op">.=</span> v</span>
<span id="cb22-207"><a href="#cb22-207" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-208"><a href="#cb22-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-209"><a href="#cb22-209" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb22-210"><a href="#cb22-210" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb22-211"><a href="#cb22-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-212"><a href="#cb22-212" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">load_lnc_try</span>(path)</span>
<span id="cb22-213"><a href="#cb22-213" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@info</span> <span class="st">"Loading try lnc"</span></span>
<span id="cb22-214"><a href="#cb22-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-215"><a href="#cb22-215" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">isfile</span>(path <span class="op">*</span>  <span class="st">"Leaf_nitrogen_content_TRY.csv"</span>)</span>
<span id="cb22-216"><a href="#cb22-216" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span>  <span class="st">"Leaf_nitrogen_content_TRY.csv"</span>, DataFrame)</span>
<span id="cb22-217"><a href="#cb22-217" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span>! df <span class="op">:</span>lnc <span class="op">=</span> <span class="op">:</span>lnc <span class="op">*</span> u<span class="st">"mg/g"</span></span>
<span id="cb22-218"><a href="#cb22-218" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span>! df .! <span class="fu">ismissing</span>.(<span class="op">:</span>species)</span>
<span id="cb22-219"><a href="#cb22-219" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb22-220"><a href="#cb22-220" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-221"><a href="#cb22-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-222"><a href="#cb22-222" aria-hidden="true" tabindex="-1"></a>    try_df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span>  <span class="st">"TRY/33838.txt"</span>, DataFrame;</span>
<span id="cb22-223"><a href="#cb22-223" aria-hidden="true" tabindex="-1"></a>        missingstring<span class="op">=</span>[<span class="st">""</span>, <span class="st">"NA"</span>],</span>
<span id="cb22-224"><a href="#cb22-224" aria-hidden="true" tabindex="-1"></a>        delim<span class="op">=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb22-225"><a href="#cb22-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-226"><a href="#cb22-226" aria-hidden="true" tabindex="-1"></a>    try_sub_df <span class="op">=</span> <span class="pp">@chain</span> try_df <span class="cf">begin</span></span>
<span id="cb22-227"><a href="#cb22-227" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> .! <span class="fu">ismissing</span>.(<span class="op">:</span>AccSpeciesName)</span>
<span id="cb22-228"><a href="#cb22-228" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> .! <span class="fu">ismissing</span>.(<span class="op">:</span>TraitName)</span>
<span id="cb22-229"><a href="#cb22-229" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> .! <span class="fu">ismissing</span>.(<span class="op">:</span>StdValue)</span>
<span id="cb22-230"><a href="#cb22-230" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>AccSpeciesName <span class="op">:</span>StdValue <span class="op">:</span>TraitName</span>
<span id="cb22-231"><a href="#cb22-231" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-232"><a href="#cb22-232" aria-hidden="true" tabindex="-1"></a>    <span class="fu">disallowmissing!</span>(try_sub_df)</span>
<span id="cb22-233"><a href="#cb22-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-234"><a href="#cb22-234" aria-hidden="true" tabindex="-1"></a>    try_species <span class="op">=</span> <span class="fu">unique</span>(try_sub_df.AccSpeciesName)</span>
<span id="cb22-235"><a href="#cb22-235" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rput</span> try_species</span>
<span id="cb22-236"><a href="#cb22-236" aria-hidden="true" tabindex="-1"></a>    R<span class="st">"""</span></span>
<span id="cb22-237"><a href="#cb22-237" aria-hidden="true" tabindex="-1"></a><span class="st">    library(TNRS)</span></span>
<span id="cb22-238"><a href="#cb22-238" aria-hidden="true" tabindex="-1"></a><span class="st">    try_species_df&lt;- TNRS(try_species)</span></span>
<span id="cb22-239"><a href="#cb22-239" aria-hidden="true" tabindex="-1"></a><span class="st">    NaN</span></span>
<span id="cb22-240"><a href="#cb22-240" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb22-241"><a href="#cb22-241" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rget</span> try_species_df</span>
<span id="cb22-242"><a href="#cb22-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-243"><a href="#cb22-243" aria-hidden="true" tabindex="-1"></a>    try_species_sub_df <span class="op">=</span> <span class="pp">@chain</span> try_species_df <span class="cf">begin</span></span>
<span id="cb22-244"><a href="#cb22-244" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb22-245"><a href="#cb22-245" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>AccSpeciesName <span class="op">=</span> <span class="op">:</span>Name_submitted</span>
<span id="cb22-246"><a href="#cb22-246" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>species <span class="op">=</span> <span class="op">:</span>Accepted_species</span>
<span id="cb22-247"><a href="#cb22-247" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-248"><a href="#cb22-248" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>species</span>
<span id="cb22-249"><a href="#cb22-249" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>species <span class="op">:</span>AccSpeciesName</span>
<span id="cb22-250"><a href="#cb22-250" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-251"><a href="#cb22-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-252"><a href="#cb22-252" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> <span class="pp">@chain</span> try_sub_df <span class="cf">begin</span></span>
<span id="cb22-253"><a href="#cb22-253" aria-hidden="true" tabindex="-1"></a>        <span class="fu">leftjoin</span>(try_species_sub_df, on <span class="op">=</span> <span class="st">"AccSpeciesName"</span>)</span>
<span id="cb22-254"><a href="#cb22-254" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>TraitName <span class="op">.==</span> <span class="st">"Leaf nitrogen (N) content per leaf dry mass"</span></span>
<span id="cb22-255"><a href="#cb22-255" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@groupby</span> <span class="op">:</span>species</span>
<span id="cb22-256"><a href="#cb22-256" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@combine</span> <span class="op">:</span>lnc <span class="op">=</span> <span class="fu">median</span>(<span class="op">:</span>StdValue)</span>
<span id="cb22-257"><a href="#cb22-257" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> .! <span class="fu">ismissing</span>.(<span class="op">:</span>species)</span>
<span id="cb22-258"><a href="#cb22-258" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-259"><a href="#cb22-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-260"><a href="#cb22-260" aria-hidden="true" tabindex="-1"></a>    CSV.<span class="fu">write</span>(path <span class="op">*</span>  <span class="st">"TRY/33838_sub.csv"</span>, df)</span>
<span id="cb22-261"><a href="#cb22-261" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@transform</span>! df <span class="op">:</span>lnc <span class="op">=</span> <span class="op">:</span>lnc <span class="op">*</span> u<span class="st">"mg/g"</span></span>
<span id="cb22-262"><a href="#cb22-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-263"><a href="#cb22-263" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb22-264"><a href="#cb22-264" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb22-265"><a href="#cb22-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-266"><a href="#cb22-266" aria-hidden="true" tabindex="-1"></a><span class="co">### export citation from TRY</span></span>
<span id="cb22-267"><a href="#cb22-267" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">try_dataset_references</span>(species)</span>
<span id="cb22-268"><a href="#cb22-268" aria-hidden="true" tabindex="-1"></a>    try_df <span class="op">=</span> CSV.<span class="fu">read</span>(data_path <span class="op">*</span>  <span class="st">"TRY/33838.txt"</span>, DataFrame;</span>
<span id="cb22-269"><a href="#cb22-269" aria-hidden="true" tabindex="-1"></a>                    missingstring<span class="op">=</span>[<span class="st">""</span>, <span class="st">"NA"</span>], delim<span class="op">=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb22-270"><a href="#cb22-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-271"><a href="#cb22-271" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@chain</span> try_df <span class="cf">begin</span></span>
<span id="cb22-272"><a href="#cb22-272" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@transform</span> <span class="op">:</span>species <span class="op">=</span> <span class="op">:</span>SpeciesName</span>
<span id="cb22-273"><a href="#cb22-273" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>species <span class="op">.∈</span> <span class="fu">Ref</span>(species)</span>
<span id="cb22-274"><a href="#cb22-274" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>TraitName <span class="op">.==</span> <span class="st">"Leaf nitrogen (N) content per leaf dry mass"</span></span>
<span id="cb22-275"><a href="#cb22-275" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@groupby</span> <span class="op">:</span>Dataset <span class="op">:</span>Reference</span>
<span id="cb22-276"><a href="#cb22-276" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@combine</span> <span class="cf">begin</span></span>
<span id="cb22-277"><a href="#cb22-277" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>n <span class="op">=</span> <span class="fu">length</span>(<span class="op">:</span>Dataset)</span>
<span id="cb22-278"><a href="#cb22-278" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>r <span class="op">=</span> <span class="fu">first</span>(<span class="op">:</span>Reference)</span>
<span id="cb22-279"><a href="#cb22-279" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-280"><a href="#cb22-280" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>n</span>
<span id="cb22-281"><a href="#cb22-281" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-282"><a href="#cb22-282" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb22-283"><a href="#cb22-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-284"><a href="#cb22-284" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">convert_id</span>(id)</span>
<span id="cb22-285"><a href="#cb22-285" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="fu">first</span>.(id, <span class="fl">3</span>)</span>
<span id="cb22-286"><a href="#cb22-286" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">chop</span>(id, head <span class="op">=</span> <span class="fl">3</span>, tail <span class="op">=</span> <span class="fl">0</span>)</span>
<span id="cb22-287"><a href="#cb22-287" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="fu">lpad</span>(b, <span class="fl">2</span>, <span class="st">"0"</span>)</span>
<span id="cb22-288"><a href="#cb22-288" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">*</span> b</span>
<span id="cb22-289"><a href="#cb22-289" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb22-290"><a href="#cb22-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-291"><a href="#cb22-291" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">to_numeric</span>(d<span class="op">::</span><span class="dt">Dates.Date</span>)</span>
<span id="cb22-292"><a href="#cb22-292" aria-hidden="true" tabindex="-1"></a>    daysinyear <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">daysinyear</span>(<span class="bu">Dates</span>.<span class="fu">year</span>(d))</span>
<span id="cb22-293"><a href="#cb22-293" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Dates</span>.<span class="fu">year</span>(d) <span class="op">+</span> (<span class="bu">Dates</span>.<span class="fu">dayofyear</span>(d) <span class="op">-</span> <span class="fl">1</span>) <span class="op">/</span> daysinyear</span>
<span id="cb22-294"><a href="#cb22-294" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb22-295"><a href="#cb22-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-296"><a href="#cb22-296" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">load_veg_df</span>(path)</span>
<span id="cb22-297"><a href="#cb22-297" aria-hidden="true" tabindex="-1"></a>    veg_df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span> <span class="st">"vegetation_2008_2022.csv"</span>, DataFrame,</span>
<span id="cb22-298"><a href="#cb22-298" aria-hidden="true" tabindex="-1"></a>        missingstring <span class="op">=</span> [<span class="st">""</span>, <span class="st">"NA"</span>])</span>
<span id="cb22-299"><a href="#cb22-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-300"><a href="#cb22-300" aria-hidden="true" tabindex="-1"></a>    veg_df <span class="op">=</span> <span class="pp">@chain</span> veg_df <span class="cf">begin</span></span>
<span id="cb22-301"><a href="#cb22-301" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> .! <span class="fu">ismissing</span>.(<span class="op">:</span>Cover)</span>
<span id="cb22-302"><a href="#cb22-302" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>Cover <span class="op">.&gt;</span> <span class="fl">0</span></span>
<span id="cb22-303"><a href="#cb22-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-304"><a href="#cb22-304" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb22-305"><a href="#cb22-305" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>species <span class="op">=</span> <span class="op">:</span>Species</span>
<span id="cb22-306"><a href="#cb22-306" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>year <span class="op">=</span> <span class="op">:</span>Year</span>
<span id="cb22-307"><a href="#cb22-307" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>cover <span class="op">=</span> <span class="op">:</span>Cover</span>
<span id="cb22-308"><a href="#cb22-308" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>plotID <span class="op">=</span> <span class="op">:</span>Useful_EP_PlotID</span>
<span id="cb22-309"><a href="#cb22-309" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-310"><a href="#cb22-310" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>year <span class="op">:</span>species <span class="op">:</span>cover</span>
<span id="cb22-311"><a href="#cb22-311" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@orderby</span> <span class="op">:</span>plotID <span class="op">:</span>year <span class="op">:</span>species</span>
<span id="cb22-312"><a href="#cb22-312" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-313"><a href="#cb22-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-314"><a href="#cb22-314" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Festuca_pratensis"</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Lolium pratense (Huds.) Darbysh."</span></span>
<span id="cb22-315"><a href="#cb22-315" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Festuca_arundinacea"</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Lolium arundinaceum (Schreb.) Darbysh."</span></span>
<span id="cb22-316"><a href="#cb22-316" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Senecio_jacobaea"</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Jacobaea vulgaris Gaertn."</span></span>
<span id="cb22-317"><a href="#cb22-317" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Trifolium_campestre/dubium_aggr."</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Trifolium dubium Sibth."</span></span>
<span id="cb22-318"><a href="#cb22-318" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Vicia_cf_lathyroides"</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Vicia lathyroides L."</span></span>
<span id="cb22-319"><a href="#cb22-319" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Geum_rivale/urbanum_aggr."</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Geum urbanum L."</span></span>
<span id="cb22-320"><a href="#cb22-320" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Ononis_repens/spinosa_aggr."</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Ononis spinosa L."</span></span>
<span id="cb22-321"><a href="#cb22-321" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Geranium_cf_pusillum"</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Geranium pusillum L."</span></span>
<span id="cb22-322"><a href="#cb22-322" aria-hidden="true" tabindex="-1"></a>    veg_df[veg_df.species <span class="op">.==</span> <span class="st">"Primula_elatior/veris/aggr."</span>, <span class="op">:</span>species] <span class="op">.=</span> <span class="st">"Primula elatior Hill"</span></span>
<span id="cb22-323"><a href="#cb22-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-324"><a href="#cb22-324" aria-hidden="true" tabindex="-1"></a>    veg_species <span class="op">=</span> <span class="fu">unique</span>(veg_df.species)</span>
<span id="cb22-325"><a href="#cb22-325" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rput</span> veg_species</span>
<span id="cb22-326"><a href="#cb22-326" aria-hidden="true" tabindex="-1"></a>    R<span class="st">"""</span></span>
<span id="cb22-327"><a href="#cb22-327" aria-hidden="true" tabindex="-1"></a><span class="st">    library(TNRS)</span></span>
<span id="cb22-328"><a href="#cb22-328" aria-hidden="true" tabindex="-1"></a><span class="st">    veg_species_df &lt;- TNRS(veg_species)</span></span>
<span id="cb22-329"><a href="#cb22-329" aria-hidden="true" tabindex="-1"></a><span class="st">    NaN</span></span>
<span id="cb22-330"><a href="#cb22-330" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb22-331"><a href="#cb22-331" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@rget</span> veg_species_df</span>
<span id="cb22-332"><a href="#cb22-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-333"><a href="#cb22-333" aria-hidden="true" tabindex="-1"></a>    veg_species_df <span class="op">=</span> <span class="pp">@chain</span> veg_species_df <span class="cf">begin</span></span>
<span id="cb22-334"><a href="#cb22-334" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@rename</span> <span class="cf">begin</span></span>
<span id="cb22-335"><a href="#cb22-335" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>species <span class="op">=</span> <span class="op">:</span>Accepted_species</span>
<span id="cb22-336"><a href="#cb22-336" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span>veg_orig_name <span class="op">=</span> <span class="op">:</span>Name_submitted</span>
<span id="cb22-337"><a href="#cb22-337" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-338"><a href="#cb22-338" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@subset</span> <span class="op">:</span>species <span class="op">.!==</span> <span class="st">""</span></span>
<span id="cb22-339"><a href="#cb22-339" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span> <span class="op">:</span>species <span class="op">:</span>veg_orig_name</span>
<span id="cb22-340"><a href="#cb22-340" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-341"><a href="#cb22-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-342"><a href="#cb22-342" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> veg_df, veg_species_df</span>
<span id="cb22-343"><a href="#cb22-343" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb22-344"><a href="#cb22-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-345"><a href="#cb22-345" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">load_vegetation_date_df</span>(path)</span>
<span id="cb22-346"><a href="#cb22-346" aria-hidden="true" tabindex="-1"></a>    ep_plots <span class="op">=</span> [<span class="st">"</span><span class="sc">$</span>(explo)<span class="st">"</span> <span class="op">*</span> <span class="fu">lpad</span>(i, <span class="fl">2</span>, <span class="st">"0"</span>) for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span> for explo <span class="kw">in</span> [<span class="st">"HEG"</span>, <span class="st">"SEG"</span>, <span class="st">"AEG"</span>]]</span>
<span id="cb22-347"><a href="#cb22-347" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="op">=</span> <span class="fu">DataFrame</span>(plotID <span class="op">=</span> ep_plots)</span>
<span id="cb22-348"><a href="#cb22-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-349"><a href="#cb22-349" aria-hidden="true" tabindex="-1"></a>    datasets <span class="op">=</span> [<span class="st">"vegetation_header_data_</span><span class="sc">$</span>y<span class="st">.csv"</span> for y <span class="kw">in</span> <span class="fl">2009</span><span class="op">:</span><span class="fl">2021</span>]</span>
<span id="cb22-350"><a href="#cb22-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-351"><a href="#cb22-351" aria-hidden="true" tabindex="-1"></a>    date_col <span class="op">=</span> [<span class="fu">fill</span>(<span class="op">:</span><span class="dt">Date</span>, <span class="fl">2</span>)<span class="op">...</span></span>
<span id="cb22-352"><a href="#cb22-352" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>date, <span class="fl">3</span>)<span class="op">...</span></span>
<span id="cb22-353"><a href="#cb22-353" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="cn">missing</span>, <span class="fl">4</span>)<span class="op">...</span></span>
<span id="cb22-354"><a href="#cb22-354" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>date_releves, <span class="fl">4</span>)<span class="op">...</span>]</span>
<span id="cb22-355"><a href="#cb22-355" aria-hidden="true" tabindex="-1"></a>    id_cols <span class="op">=</span> [<span class="op">:</span>EPID</span>
<span id="cb22-356"><a href="#cb22-356" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>EpPlotID, <span class="fl">8</span>)<span class="op">...</span></span>
<span id="cb22-357"><a href="#cb22-357" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fill</span>(<span class="op">:</span>Ep_PlotID, <span class="fl">4</span>)<span class="op">...</span>]</span>
<span id="cb22-358"><a href="#cb22-358" aria-hidden="true" tabindex="-1"></a>    dfs <span class="op">=</span> []</span>
<span id="cb22-359"><a href="#cb22-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-360"><a href="#cb22-360" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i, file) <span class="kw">in</span> <span class="fu">enumerate</span>(datasets)</span>
<span id="cb22-361"><a href="#cb22-361" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> CSV.<span class="fu">read</span>(path <span class="op">*</span> file,</span>
<span id="cb22-362"><a href="#cb22-362" aria-hidden="true" tabindex="-1"></a>            DataFrame;</span>
<span id="cb22-363"><a href="#cb22-363" aria-hidden="true" tabindex="-1"></a>            missingstring <span class="op">=</span> [<span class="st">""</span>, <span class="st">"NA"</span>])</span>
<span id="cb22-364"><a href="#cb22-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-365"><a href="#cb22-365" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="fu">ismissing</span>(date_col[i])</span>
<span id="cb22-366"><a href="#cb22-366" aria-hidden="true" tabindex="-1"></a>            doy <span class="op">=</span> df.day_of_year</span>
<span id="cb22-367"><a href="#cb22-367" aria-hidden="true" tabindex="-1"></a>            doy[<span class="fu">ismissing</span>.(doy)] <span class="op">.=</span> <span class="fu">mean</span>(.!<span class="fu">ismissing</span>(doy))</span>
<span id="cb22-368"><a href="#cb22-368" aria-hidden="true" tabindex="-1"></a>            df.date <span class="op">=</span> @. <span class="bu">Dates</span>.<span class="fu">Date</span>(df.year) <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>(doy)</span>
<span id="cb22-369"><a href="#cb22-369" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb22-370"><a href="#cb22-370" aria-hidden="true" tabindex="-1"></a>            df.date <span class="op">=</span> df[<span class="op">:</span>, date_col[i]]</span>
<span id="cb22-371"><a href="#cb22-371" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-372"><a href="#cb22-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-373"><a href="#cb22-373" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="pp">@chain</span> df <span class="cf">begin</span></span>
<span id="cb22-374"><a href="#cb22-374" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@transform</span> <span class="op">:</span>plotID <span class="op">=</span> <span class="fu">convert_id</span>.(<span class="op">$</span>(id_cols[i]))</span>
<span id="cb22-375"><a href="#cb22-375" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@select</span> <span class="op">:</span>plotID <span class="op">:</span>date</span>
<span id="cb22-376"><a href="#cb22-376" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rightjoin</span>(plot_df, on <span class="op">=</span> <span class="op">:</span>plotID)</span>
<span id="cb22-377"><a href="#cb22-377" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-378"><a href="#cb22-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-379"><a href="#cb22-379" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="fu">any</span>(<span class="fu">ismissing</span>.(df.date))</span>
<span id="cb22-380"><a href="#cb22-380" aria-hidden="true" tabindex="-1"></a>            selected_dates <span class="op">=</span> df[.!<span class="fu">ismissing</span>.(df.date), <span class="op">:</span>date]</span>
<span id="cb22-381"><a href="#cb22-381" aria-hidden="true" tabindex="-1"></a>            year <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">year</span>(selected_dates[<span class="fl">1</span>])</span>
<span id="cb22-382"><a href="#cb22-382" aria-hidden="true" tabindex="-1"></a>            mean_doy <span class="op">=</span> <span class="fu">Int</span>(<span class="fu">median</span>(<span class="bu">Dates</span>.<span class="fu">dayofyear</span>.(selected_dates)))</span>
<span id="cb22-383"><a href="#cb22-383" aria-hidden="true" tabindex="-1"></a>            df[<span class="fu">ismissing</span>.(df.date), <span class="op">:</span>date] <span class="op">.=</span> <span class="bu">Dates</span>.<span class="fu">Date</span>(year) <span class="op">+</span> <span class="bu">Dates</span>.<span class="fu">Day</span>(mean_doy)</span>
<span id="cb22-384"><a href="#cb22-384" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-385"><a href="#cb22-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-386"><a href="#cb22-386" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unique!</span>(df, <span class="op">:</span>plotID)</span>
<span id="cb22-387"><a href="#cb22-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-388"><a href="#cb22-388" aria-hidden="true" tabindex="-1"></a>        <span class="co"># @show length(unique(df.plotID))</span></span>
<span id="cb22-389"><a href="#cb22-389" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(dfs, df)</span>
<span id="cb22-390"><a href="#cb22-390" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-391"><a href="#cb22-391" aria-hidden="true" tabindex="-1"></a>    date_df <span class="op">=</span> <span class="fu">vcat</span>(dfs<span class="op">...</span>)</span>
<span id="cb22-392"><a href="#cb22-392" aria-hidden="true" tabindex="-1"></a>    date_df.year <span class="op">=</span> <span class="bu">Dates</span>.<span class="fu">year</span>.(date_df.date)</span>
<span id="cb22-393"><a href="#cb22-393" aria-hidden="true" tabindex="-1"></a>    date_df.numeric_date <span class="op">=</span> <span class="fu">to_numeric</span>.(date_df.date)</span>
<span id="cb22-394"><a href="#cb22-394" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> date_df</span>
<span id="cb22-395"><a href="#cb22-395" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 46%">
<col style="width: 53%">
</colgroup>
<thead>
<tr class="header">
<th>Description</th>
<th>Data source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Vegetation records</td>
<td>data: <span class="citation" data-cites="explo31389v7">Hinderling and Keller (<a href="#ref-explo31389v7" role="doc-biblioref">2023</a>)</span>, sampling date: <span class="citation" data-cites="explo6340v2">Prati et al. (<a href="#ref-explo6340v2" role="doc-biblioref">2017</a>)</span> <span class="citation" data-cites="explo13486v2">Schmitt et al. (<a href="#ref-explo13486v2" role="doc-biblioref">2017</a>)</span> <span class="citation" data-cites="explo14326v2">Schmitt, Prati, and Fischer (<a href="#ref-explo14326v2" role="doc-biblioref">2018a</a>)</span> <span class="citation" data-cites="explo15588v2">Schmitt and Fischer (<a href="#ref-explo15588v2" role="doc-biblioref">2018</a>)</span> <span class="citation" data-cites="explo16826v4">Schmitt, Prati, and Fischer (<a href="#ref-explo16826v4" role="doc-biblioref">2018b</a>)</span> <span class="citation" data-cites="explo19807v4">Fischer, Hinderling, Schäfer, et al. (<a href="#ref-explo19807v4" role="doc-biblioref">2023a</a>)</span> <span class="citation" data-cites="explo19809v3">Fischer, Hinderling, Schäfer, et al. (<a href="#ref-explo19809v3" role="doc-biblioref">2023b</a>)</span> <span class="citation" data-cites="explo21187v3">Fischer, Schäfer, et al. (<a href="#ref-explo21187v3" role="doc-biblioref">2023</a>)</span> <span class="citation" data-cites="explo23486v4">Schäfer, Prati, and Fischer (<a href="#ref-explo23486v4" role="doc-biblioref">2023</a>)</span> <span class="citation" data-cites="explo24166v4">Bolliger, Hinderling, et al. (<a href="#ref-explo24166v4" role="doc-biblioref">2023</a>)</span> <span class="citation" data-cites="explo26151v4">Fischer, Hinderling, Bolliger, et al. (<a href="#ref-explo26151v4" role="doc-biblioref">2023</a>)</span> <span class="citation" data-cites="explo27426v5">Bolliger, Prati, et al. (<a href="#ref-explo27426v5" role="doc-biblioref">2023</a>)</span> <span class="citation" data-cites="explo31180v22">Prati and Bolliger (<a href="#ref-explo31180v22" role="doc-biblioref">2023</a>)</span> <span class="citation" data-cites="explo31387v10">Prati (<a href="#ref-explo31387v10" role="doc-biblioref">2023</a>)</span></td>
</tr>
<tr class="even">
<td>Specific leaf area [m² g⁻¹]</td>
<td><span class="citation" data-cites="explo24807v2">Prati, Goßner, and Neff (<a href="#ref-explo24807v2" role="doc-biblioref">2021</a>)</span></td>
</tr>
<tr class="odd">
<td>Arbuscular mycorrhizal colonisation [-]</td>
<td><span class="citation" data-cites="explo26546v2">Bergmann and Rillig (<a href="#ref-explo26546v2" role="doc-biblioref">2022</a>)</span></td>
</tr>
<tr class="even">
<td>Root surface area / belowground biomass [m² g⁻¹]</td>
<td><span class="citation" data-cites="explo26546v2">Bergmann and Rillig (<a href="#ref-explo26546v2" role="doc-biblioref">2022</a>)</span></td>
</tr>
<tr class="odd">
<td>Potential plant height [m]</td>
<td><span class="citation" data-cites="LEDA">Kleyer et al. (<a href="#ref-LEDA" role="doc-biblioref">2008</a>)</span></td>
</tr>
<tr class="even">
<td>Leaf nitrogen / leaf mass [mg g⁻¹]</td>
<td><span class="citation" data-cites="trydb">Kattge et al. (<a href="#ref-trydb" role="doc-biblioref">2020</a>)</span></td>
</tr>
<tr class="odd">
<td>Aboveground biomass / total biomass [-]</td>
<td><span class="citation" data-cites="explo26546v2">Bergmann and Rillig (<a href="#ref-explo26546v2" role="doc-biblioref">2022</a>)</span></td>
</tr>
</tbody>
</table>
<p>Vegetation data set with exact dates was joined with species mean trait values to calculate community weighted mean traits for each plot and year.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 34%">
<col style="width: 65%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>CWM_sla[t, plot]</code></td>
<td>Specific leaf area [m² g⁻¹]</td>
</tr>
<tr class="even">
<td><code>CWM_amc[t, plot]</code></td>
<td>Arbuscular mycorrhizal colonisation [-]</td>
</tr>
<tr class="odd">
<td><code>CWM_srsa[t, plot]</code></td>
<td>Root surface area / belowground biomass [m² g⁻¹]</td>
</tr>
<tr class="even">
<td><code>CWM_height[t, plot]</code></td>
<td>Plant height [m]</td>
</tr>
<tr class="odd">
<td><code>CWM_lnc[t, plot]</code></td>
<td>Leaf nitrogen / leaf mass [mg g⁻¹]</td>
</tr>
<tr class="even">
<td><code>CWM_abp[t, plot]</code></td>
<td>Aboveground biomass / total biomass [-]</td>
</tr>
</tbody>
</table>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-explo26546v2" class="csl-entry" role="listitem">
Bergmann, Joana, and Matthias Rillig. 2022. <span>“Fine Root and Mycorrhizal Traits of 82 Grassland Species Measured in a Greenhouse Experiment on Sand, 2018.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/26546?version=2">https://www.bexis.uni-jena.de/ddm/data/Showdata/26546?version=2</a>.
</div>
<div id="ref-explo16209v2" class="csl-entry" role="listitem">
Boch, Steffen, Jörg Mueller, Stephanie Socher, Daniel Prati, and Markus Fischer. 2017. <span>“Measurement of Biomass (2009, All Grassland EPs).”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/16209?version=2">https://www.bexis.uni-jena.de/ddm/data/Showdata/16209?version=2</a>.
</div>
<div id="ref-explo24166v4" class="csl-entry" role="listitem">
Bolliger, Ralph, Judith Hinderling, Daniel Prati, and Judith Hinderling. 2023. <span>“Vegetation Records for 150 Grassland EPs in 2018, Header Data Without Species Identities (Incl. Biomass).”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/24166?version=4">https://www.bexis.uni-jena.de/ddm/data/Showdata/24166?version=4</a>.
</div>
<div id="ref-explo27426v5" class="csl-entry" role="listitem">
Bolliger, Ralph, Daniel Prati, Markus Fischer, and Judith Hinderling. 2023. <span>“Vegetation Records for 150 Grassland EPs in 2020, Header Data Without Species Identities (Incl. Biomass).”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/27426?version=5">https://www.bexis.uni-jena.de/ddm/data/Showdata/27426?version=5</a>.
</div>
<div id="ref-PETdata" class="csl-entry" role="listitem">
DWD Climate Data Center. 2019. <span>“Calculated Daily Values for Different Characteristic Elements of Soil and Crops.”</span> <a href="https://opendata.dwd.de/climate_environment/CDC/derived_germany/soil/daily/historical/">https://opendata.dwd.de/climate_environment/CDC/derived_germany/soil/daily/historical/</a>.
</div>
<div id="ref-explo26151v4" class="csl-entry" role="listitem">
Fischer, Markus, Judith Hinderling, Ralph Bolliger, and Judith Hinderling. 2023. <span>“Vegetation Records for 150 Grassland EPs in 2019, Header Data Without Species Identities (Incl. Biomass).”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/26151?version=4">https://www.bexis.uni-jena.de/ddm/data/Showdata/26151?version=4</a>.
</div>
<div id="ref-explo19807v4" class="csl-entry" role="listitem">
Fischer, Markus, Judith Hinderling, Deborah Schäfer, Valentin Klaus, and Judith Hinderling. 2023a. <span>“Vegetation Records for 150 Grassland EPs in 2014, Header Data Without Species Identities (Incl. Biomass).”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/19807?version=4">https://www.bexis.uni-jena.de/ddm/data/Showdata/19807?version=4</a>.
</div>
<div id="ref-explo19809v3" class="csl-entry" role="listitem">
———. 2023b. <span>“Vegetation Records for 150 Grassland EPs in 2015, Header Data Without Species Identities (Incl. Biomass).”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/19809?version=3">https://www.bexis.uni-jena.de/ddm/data/Showdata/19809?version=3</a>.
</div>
<div id="ref-explo21187v3" class="csl-entry" role="listitem">
Fischer, Markus, Deborah Schäfer, Steffen Boch, and Daniel Prati. 2023. <span>“Vegetation Records for 150 Grassland EPs in 2016, Header Data Without Species Identities (Incl. Biomass).”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/21187?version=3">https://www.bexis.uni-jena.de/ddm/data/Showdata/21187?version=3</a>.
</div>
<div id="ref-Gupta1979" class="csl-entry" role="listitem">
Gupta, S. C., and W. E. Larson. 1979. <span>“Estimating Soil Water Retention Characteristics from Particle Size Distribution, Organic Matter Percent, and Bulk Density.”</span> <em>Water Resources Research</em> 15 (6): 1633–35. <a href="https://doi.org/10.1029/WR015i006p01633">https://doi.org/10.1029/WR015i006p01633</a>.
</div>
<div id="ref-explo4761v3" class="csl-entry" role="listitem">
Herold, Nadine, Ingo Schöning, and Marion Schrumpf. 2021. <span>“Soil Survey 2008 Subplot Description.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/4761?version=3">https://www.bexis.uni-jena.de/ddm/data/Showdata/4761?version=3</a>.
</div>
<div id="ref-explo31389v7" class="csl-entry" role="listitem">
Hinderling, Judith, and Sebastian Keller. 2023. <span>“Vegetation Records for Grassland EPs, 2008 - 2022.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/31389?version=7">https://www.bexis.uni-jena.de/ddm/data/Showdata/31389?version=7</a>.
</div>
<div id="ref-trydb" class="csl-entry" role="listitem">
Kattge, Jens, Gerhard Bönisch, Sandra Díaz, Sandra Lavorel, Iain Colin Prentice, Paul Leadley, Susanne Tautenhahn, et al. 2020. <span>“TRY Plant Trait Database – Enhanced Coverage and Open Access.”</span> <em>Global Change Biology</em> 26 (1): 119–88. <a href="https://doi.org/10.1111/gcb.14904">https://doi.org/10.1111/gcb.14904</a>.
</div>
<div id="ref-LEDA" class="csl-entry" role="listitem">
Kleyer, M., R. M. Bekker, I. C. Knevel, J. P Bakker, K. Thompson, M. Sonnenschein, P. Poschlod, et al. 2008. <span>“The LEDA Traitbase: A Database of Life-History Traits of Northwest European Flora.”</span> <em>Journal of Ecology</em> 96: 1266–74.
</div>
<div id="ref-explo31387v10" class="csl-entry" role="listitem">
Prati, Daniel. 2023. <span>“Vegetation Summary and Biomass Data for 150 Grassland EPs in 2022 Without Species Identities.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/31387?version=10">https://www.bexis.uni-jena.de/ddm/data/Showdata/31387?version=10</a>.
</div>
<div id="ref-explo31180v22" class="csl-entry" role="listitem">
Prati, Daniel, and Ralph Bolliger. 2023. <span>“Vegetation Summary and Biomass Data for 150 Grassland EPs in 2021 Without Species Identities.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/31180?version=22">https://www.bexis.uni-jena.de/ddm/data/Showdata/31180?version=22</a>.
</div>
<div id="ref-explo24807v2" class="csl-entry" role="listitem">
Prati, Daniel, Martin Goßner, and Felix Neff. 2021. <span>“Leaf Traits of Most Abundant Plant Species from All EPs, 2017/2018.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/24807?version=2">https://www.bexis.uni-jena.de/ddm/data/Showdata/24807?version=2</a>.
</div>
<div id="ref-explo6340v2" class="csl-entry" role="listitem">
Prati, Daniel, Stephanie Socher, Steffen Boch, Jörg Mueller, and Markus Fischer. 2017. <span>“Vegetation Records for Grassland EPs in 2009, Header Data Without Species Identities.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/6340?version=2">https://www.bexis.uni-jena.de/ddm/data/Showdata/6340?version=2</a>.
</div>
<div id="ref-explo23486v4" class="csl-entry" role="listitem">
Schäfer, Deborah, Daniel Prati, and Markus Fischer. 2023. <span>“Vegetation Records for 150 Grassland EPs in 2017, Header Data Without Species Identities (Incl. Biomass) - Updated Version Available (Dataset 31466).”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/23486?version=4">https://www.bexis.uni-jena.de/ddm/data/Showdata/23486?version=4</a>.
</div>
<div id="ref-explo15588v2" class="csl-entry" role="listitem">
Schmitt, Barbara, and Markus Fischer. 2018. <span>“Vegetation Records for Grassland EPs in 2012, Header Data Without Species Identities.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/15588?version=2">https://www.bexis.uni-jena.de/ddm/data/Showdata/15588?version=2</a>.
</div>
<div id="ref-explo12706v2" class="csl-entry" role="listitem">
Schmitt, Barbara, Daniel Prati, and Markus Fischer. 2017. <span>“Measurement of Biomass (2010, All Grassland EPs).”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/12706?version=2">https://www.bexis.uni-jena.de/ddm/data/Showdata/12706?version=2</a>.
</div>
<div id="ref-explo14326v2" class="csl-entry" role="listitem">
———. 2018a. <span>“Vegetation Records for Grassland EPs in 2011, Header Data Without Species Identities.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/14326?version=2">https://www.bexis.uni-jena.de/ddm/data/Showdata/14326?version=2</a>.
</div>
<div id="ref-explo16826v4" class="csl-entry" role="listitem">
———. 2018b. <span>“Vegetation Records for Grassland EPs in 2013, Header Data Without Species Identities.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/16826?version=4">https://www.bexis.uni-jena.de/ddm/data/Showdata/16826?version=4</a>.
</div>
<div id="ref-explo13486v2" class="csl-entry" role="listitem">
Schmitt, Barbara, Daniel Prati, Markus Fischer, and Stefan Blaser. 2017. <span>“Vegetation Records for Grassland EPs in 2010, Header Data Without Species Identities.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/13486?version=2">https://www.bexis.uni-jena.de/ddm/data/Showdata/13486?version=2</a>.
</div>
<div id="ref-explo14346v3" class="csl-entry" role="listitem">
Schmitt, Barbara, Daniel Prati, Markus Fischer, and Judith Minker. 2018. <span>“Measurement of Biomass (2011, All Grassland EPs).”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/14346?version=3">https://www.bexis.uni-jena.de/ddm/data/Showdata/14346?version=3</a>.
</div>
<div id="ref-explo_31210_v13" class="csl-entry" role="listitem">
Schöning, Ingo. 2023. <span>“Soil Carbon and Nitrogen Concentrations - Soil Sampling Campaign 2021, All Experimental Plots (EPs), 0-10 Cm.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/31210?version=13">https://www.bexis.uni-jena.de/ddm/data/Showdata/31210?version=13</a>.
</div>
<div id="ref-explo23846v10" class="csl-entry" role="listitem">
Schöning, Ingo, Theresa Klötzing, Antonios Apostolakis, Susan Trumbore, and Marion Schrumpf. 2021. <span>“MinSoil 2017 - Soil Carbon and Nitrogen Concentrations.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/23846?version=10">https://www.bexis.uni-jena.de/ddm/data/Showdata/23846?version=10</a>.
</div>
<div id="ref-explo17086v4" class="csl-entry" role="listitem">
Schöning, Ingo, Emily Solly, Theresa Klötzing, Susan Trumbore, and Marion Schrumpf. 2021a. <span>“MinSoil 2011 - Soil Bulk Density and Carbon and Nitrogen Stocks.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/17086?version=4">https://www.bexis.uni-jena.de/ddm/data/Showdata/17086?version=4</a>.
</div>
<div id="ref-explo14446v19" class="csl-entry" role="listitem">
———. 2021b. <span>“MinSoil 2011 - Soil Carbon and Nitrogen Concentrations.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/14446?version=19">https://www.bexis.uni-jena.de/ddm/data/Showdata/14446?version=19</a>.
</div>
<div id="ref-explo14686v10" class="csl-entry" role="listitem">
———. 2021c. <span>“MinSoil 2011 - Soil Texture.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/14686?version=10">https://www.bexis.uni-jena.de/ddm/data/Showdata/14686?version=10</a>.
</div>
<div id="ref-explo18787v6" class="csl-entry" role="listitem">
Schöning, Ingo, Susan Trumbore, Marion Schrumpf, Theresa Klötzing, and Huei Ying Gan. 2021. <span>“MinSoil 2014 - Soil Carbon and Nitrogen Concentrations.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/18787?version=6">https://www.bexis.uni-jena.de/ddm/data/Showdata/18787?version=6</a>.
</div>
<div id="ref-explo_31715_v9" class="csl-entry" role="listitem">
Vogt, Juliane, Wolfgang Weisser, Manfred Ayasse, Markus Fischer, Uta Schumacher, Christin Schreiber, Ralf Lauterbach, et al. 2024. <span>“Grassland Management Parameter as Input Data for a Computer Model Based on Interview Data of the Biodiversity Exploratories Project.”</span> Dataset. Published. Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/ddm/data/Showdata/31715?version=9">https://www.bexis.uni-jena.de/ddm/data/Showdata/31715?version=9</a>.
</div>
<div id="ref-PARdata" class="csl-entry" role="listitem">
Wang, Dongdong. 2021. <span>“MODIS/Terra+aqua Photosynthetically Active Radiation Daily/3-Hour L3 Global 0.05Deg CMG V061.”</span> <a href="https://doi.org/10.5067/MODIS/MCD18C2.061">https://doi.org/10.5067/MODIS/MCD18C2.061</a>.
</div>
<div id="ref-explo19007v6" class="csl-entry" role="listitem">
Wöllauer, Stephan, Falk Hänsel, Thomas Nauss, and Spaska Forteva. 2023. <span>“Climate Data - Time Series Web Interface.”</span> Biodiversity Exploratories Information System. <a href="https://www.bexis.uni-jena.de/tcd/PublicClimateData/">https://www.bexis.uni-jena.de/tcd/PublicClimateData/</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>